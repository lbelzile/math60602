<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.163">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="MATH 60602 - Analyse multidimensionnelle appliquée, HEC Montréal.">

<title>MATH 60602 - Analyse multidimensionnelle appliquée - 5&nbsp; Régression logistique</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-survie.html" rel="next">
<link href="./04-selectionmodeles.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Régression logistique</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MATH 60602 - Analyse multidimensionnelle appliquée</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/lbelzile/math60602/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="./MATH60602.pdf" title="Download PDF" class="sidebar-tool px-1"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-analyseexploratoire.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Analyse exploratoire</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-analysefactorielle.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Réduction de la dimension</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-selectionmodeles.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Sélection de variables et de modèles</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-reglogistique.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Régression logistique</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-survie.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyse de survie</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-regroupements.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Analyse de regroupements</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-donneesmanquantes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Données manquantes</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table des matières</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">5.1</span>  Introduction</a></li>
  <li><a href="#modèle-de-régression-logistique" id="toc-modèle-de-régression-logistique" class="nav-link" data-scroll-target="#modèle-de-régression-logistique"><span class="toc-section-number">5.2</span>  Modèle de régression logistique</a>
  <ul class="collapse">
  <li><a href="#estimation-et-interprétation-des-paramètres" id="toc-estimation-et-interprétation-des-paramètres" class="nav-link" data-scroll-target="#estimation-et-interprétation-des-paramètres"><span class="toc-section-number">5.2.1</span>  Estimation et interprétation des paramètres</a></li>
  <li><a href="#méthode-du-maximum-de-vraisemblance" id="toc-méthode-du-maximum-de-vraisemblance" class="nav-link" data-scroll-target="#méthode-du-maximum-de-vraisemblance"><span class="toc-section-number">5.2.2</span>  Méthode du maximum de vraisemblance</a></li>
  <li><a href="#sec-cowboy" id="toc-sec-cowboy" class="nav-link" data-scroll-target="#sec-cowboy"><span class="toc-section-number">5.2.3</span>  Exemple du <em>Professional Rodeo Cowboys Association</em></a></li>
  <li><a href="#modèle-avec-une-seule-variable-explicative" id="toc-modèle-avec-une-seule-variable-explicative" class="nav-link" data-scroll-target="#modèle-avec-une-seule-variable-explicative"><span class="toc-section-number">5.2.4</span>  Modèle avec une seule variable explicative</a></li>
  <li><a href="#interprétation-du-paramètre" id="toc-interprétation-du-paramètre" class="nav-link" data-scroll-target="#interprétation-du-paramètre"><span class="toc-section-number">5.2.5</span>  Interprétation du paramètre</a></li>
  <li><a href="#test-du-rapport-de-vraisemblance" id="toc-test-du-rapport-de-vraisemblance" class="nav-link" data-scroll-target="#test-du-rapport-de-vraisemblance"><span class="toc-section-number">5.2.6</span>  Test du rapport de vraisemblance</a></li>
  <li><a href="#multicolinéarité" id="toc-multicolinéarité" class="nav-link" data-scroll-target="#multicolinéarité"><span class="toc-section-number">5.2.7</span>  Multicolinéarité</a></li>
  </ul></li>
  <li><a href="#classification-et-prédiction" id="toc-classification-et-prédiction" class="nav-link" data-scroll-target="#classification-et-prédiction"><span class="toc-section-number">5.3</span>  Classification et prédiction</a>
  <ul class="collapse">
  <li><a href="#fonction-defficacité-du-récepteur" id="toc-fonction-defficacité-du-récepteur" class="nav-link" data-scroll-target="#fonction-defficacité-du-récepteur"><span class="toc-section-number">5.3.1</span>  Fonction d’efficacité du récepteur</a></li>
  <li><a href="#classification-avec-une-matrice-de-gain" id="toc-classification-avec-une-matrice-de-gain" class="nav-link" data-scroll-target="#classification-avec-une-matrice-de-gain"><span class="toc-section-number">5.3.2</span>  Classification avec une matrice de gain</a></li>
  <li><a href="#courbe-lift" id="toc-courbe-lift" class="nav-link" data-scroll-target="#courbe-lift"><span class="toc-section-number">5.3.3</span>  Courbe lift</a></li>
  <li><a href="#calibration-du-modèle-et-détection-du-surajustement" id="toc-calibration-du-modèle-et-détection-du-surajustement" class="nav-link" data-scroll-target="#calibration-du-modèle-et-détection-du-surajustement"><span class="toc-section-number">5.3.4</span>  Calibration du modèle et détection du surajustement</a></li>
  <li><a href="#sélection-de-variables-en-régression-logistique" id="toc-sélection-de-variables-en-régression-logistique" class="nav-link" data-scroll-target="#sélection-de-variables-en-régression-logistique"><span class="toc-section-number">5.3.5</span>  Sélection de variables en régression logistique</a></li>
  <li><a href="#modèle-heckit" id="toc-modèle-heckit" class="nav-link" data-scroll-target="#modèle-heckit"><span class="toc-section-number">5.3.6</span>  Modèle Heckit</a></li>
  <li><a href="#description-du-modèle-heckit" id="toc-description-du-modèle-heckit" class="nav-link" data-scroll-target="#description-du-modèle-heckit">Description du modèle Heckit</a></li>
  </ul></li>
  <li><a href="#modèles-pour-données-multinomiales" id="toc-modèles-pour-données-multinomiales" class="nav-link" data-scroll-target="#modèles-pour-données-multinomiales"><span class="toc-section-number">5.4</span>  Modèles pour données multinomiales</a>
  <ul class="collapse">
  <li><a href="#régression-logistique-multinomiale" id="toc-régression-logistique-multinomiale" class="nav-link" data-scroll-target="#régression-logistique-multinomiale"><span class="toc-section-number">5.4.1</span>  Régression logistique multinomiale</a></li>
  <li><a href="#régression-logistique-cumulative-à-cotes-proportionnelles" id="toc-régression-logistique-cumulative-à-cotes-proportionnelles" class="nav-link" data-scroll-target="#régression-logistique-cumulative-à-cotes-proportionnelles"><span class="toc-section-number">5.4.2</span>  Régression logistique cumulative à cotes proportionnelles</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/lbelzile/math60602/edit/master/05-reglogistique.qmd" class="toc-action">Éditer cette page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="regression-logistique" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Régression logistique</span></span></h1>
</div>

<div>
  <div class="description">
    <p>MATH 60602 - Analyse multidimensionnelle appliquée, HEC Montréal.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="cell" data-hash="05-reglogistique_cache/html/setup5_75dfa19ce5f6d2e353b2294a189cc2a1">

</div>
<section id="introduction" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">5.1</span> Introduction</h2>
<p>En régression linéaire, on cherche à expliquer le comportement d’une variable quantitative <span class="math inline">\(Y\)</span> que l’on peut traiter comme étant continue (elle peut prendre suffisamment de valeurs différentes).</p>
<p>Supposons à présent que l’on veut expliquer le comportement d’une variable <span class="math inline">\(Y\)</span> prenant seulement deux valeurs que l’on va noter 0 et 1.</p>
<p>Exemples :</p>
<ul>
<li>Est-ce qu’un client potentiel va répondre favorablement à une offre promotionnelle?</li>
<li>Est-ce qu’un client est satisfait du service après-vente?</li>
<li>Est-ce qu’un client va faire faillite ou non au cours des trois prochaines années.</li>
</ul>
<p>En général, on cherchera à expliquer le comportement d’une variable binaire <span class="math inline">\(Y\)</span> en utilisant un modèle basé sur <span class="math inline">\(p\)</span> variables explicatives <span class="math inline">\(\mathrm{X}_1, \ldots, \mathrm{X}_p\)</span>.</p>
<p>Notre but sera de faire de l’inférence, de la prédiction, ou les deux à la fois, soit</p>
<ol type="1">
<li><strong>Inférence</strong> : comprendre comment et dans quelles mesures les variables <span class="math inline">\(\mathbf{X}\)</span> influencent <span class="math inline">\(Y\)</span> (ou bien la probabilité que <span class="math inline">\(Y=1\)</span>).</li>
<li><strong>Prédiction</strong> : développer un modèle pour prévoir des valeurs de <span class="math inline">\(Y\)</span> futures à partir des variables <span class="math inline">\(\mathbf{X}\)</span>.</li>
</ol>
</section>
<section id="modèle-de-régression-logistique" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="modèle-de-régression-logistique"><span class="header-section-number">5.2</span> Modèle de régression logistique</h2>
<p>Avec une variable réponse continue, le modèle de régression linéaire, <span class="math display">\[\begin{align*}
Y = \beta_0 + \beta_1\mathrm{X}_1 + \cdots + \beta_p \mathrm{X}_p + \varepsilon,
\end{align*}\]</span> avec <span class="math inline">\(\mathsf{E}(\varepsilon \mid \mathbf{X})=0\)</span> et <span class="math inline">\(\mathsf{Va}(\varepsilon \mid \mathbf{X})=\sigma^2\)</span>, peut être écrit de manière équivalente comme <span class="math inline">\(\mathsf{E}(Y \mid \mathbf{X}) = \beta_0 + \beta_1\mathrm{X}_1 + \cdots + \beta_p\mathrm{X}_p\)</span> et <span class="math inline">\(\mathsf{Va}(Y \mid \mathbf{X})=\sigma^2.\)</span></p>
<p>Si <span class="math inline">\(Y\)</span> est binaire (0/1), on peut facilement vérifier que <span class="math display">\[\begin{align*}
\mathsf{E}(Y \mid \mathbf{X}) = \Pr(Y=1 \mid  \mathbf{X}),
\end{align*}\]</span> soit la probabilité que <span class="math inline">\(Y\)</span> égale 1 étant donné les valeurs des variables explicatives. Pour simplifier la notation, posons la probabilité de succès <span class="math inline">\(p = \Pr(Y=1 \mid \mathbf{X})\)</span> en se rappelant que <span class="math inline">\(p\)</span> est une fonction des variables explicatives.</p>
<p>À première vue, on peut se demander pourquoi ne pas utiliser le même modèle que la régression linéaire, c’est-à-dire <span class="math display">\[\begin{align*}
\eta=\beta_0 + \beta_1\mathrm{X}_1 + \cdots + \beta_p \mathrm{X}_p.
\end{align*}\]</span></p>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-demandecredit_70cce86c1e66acf6aa3ed0ae93e0f2d5">
<div class="cell-output-display">
<div id="fig-demandecredit" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-demandecredit-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.1: Données de la réserve de Boston sur l’approbation de prêts hypothécaires (1990); données tirées de Stock et Watson (2007).</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-demandecredit">Figure&nbsp;<span>5.1</span></a> montre le modèle de régression linéaire (bleu) et le modèle logistique. La pente pour la ligne bleu correspond à l’augmentation (réputée constante) de la probabilité d’approbation de crédit, de l’ordre de 11% par augmentation de 0.1 du rapport paiements hypothécaires sur revenu.</p>
<p>Il y a quelques problèmes avec le modèle linéaire. D’abord, les données binaires ne respectent pas le postulat d’égalité des variances, ce qui rend les tests d’hypothèses caducs. Le problème principal est que <span class="math inline">\(p\)</span> est une probabilité. Par conséquent <span class="math inline">\(p\)</span> prend seulement des valeurs entre 0 et 1 alors que rien n’empêche <span class="math inline">\(\eta\)</span> de prendre des valeurs dans <span class="math inline">\(\mathbb{R}=(-\infty, \infty)\)</span>: par exemple, on voit que la droite de la <a href="#fig-demandecredit">Figure&nbsp;<span>5.1</span></a> retourne des prédictions négatives dès que le ratio paiements/revenus est en dessous de 0.094: on peut évidemment tronquer ces prédictions à zéro, mais cela sous-tend que la probabilité d’acceptation est nulle, alors que certaines personnes dans l’échantillon ont reçu un prêt.</p>
<p>Une façon de résoudre ce problème consiste à appliquer une transformation à <span class="math inline">\(p\)</span> de telle sorte que la quantité transformée puisse prendre toutes les valeurs entre <span class="math inline">\(-\infty\)</span> et <span class="math inline">\(\infty\)</span>. Le modèle de régression logistique est défini à l’aide de la transformation <span class="math inline">\(\textrm{logit}\)</span>, <span class="math display">\[\begin{align*}
\textrm{logit}(p) = \ln\left( \frac{p}{1-p}\right)=\eta=\beta_0 + \beta_1\mathrm{X}_1 + \cdots + \beta_p \mathrm{X}_p,
\end{align*}\]</span> où <span class="math inline">\(\ln\)</span> est le logarithme naturel.</p>
<p>En régression linéaire, on suppose que l’espérance de <span class="math inline">\(Y\)</span> étant donné les valeurs des variables explicatives est une combinaison linéaire de ces dernières. En régression logistique, on suppose que le logit de la probabilité de succès est une combinaison linéaire des variables explicatives.</p>
<p>Une simple manipulation algébrique permet d’exprimer ce modèle en terme de la probabilité <span class="math inline">\(p\)</span>, <span class="math display">\[\begin{align*}
p &amp;= \textrm{expit}(\eta) = \frac{\exp(\eta)}{1+\exp(\eta)}
= \frac{1}{1+\exp(-\eta)}.
\end{align*}\]</span> On peut voir qu’à mesure que le prédicteur linéaire <span class="math inline">\(\eta=\beta_0+\beta_1\mathrm{X}_1 + \cdots + \beta_p\mathrm{X}_p\)</span> augmente, la probabilité augmente. Si le coefficient <span class="math inline">\(\beta_j\)</span> est négatif, <span class="math inline">\(p\)</span> diminuera à mesure que <span class="math inline">\(\mathrm{X}_j\)</span> augmente.</p>
<div class="cell" data-layout-align="center" data-hash="05-reglogistique_cache/html/fig-logitplot_7111a23f232297c0ff3822b9b280146f">
<div class="cell-output-display">
<div id="fig-logitplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-logitplot-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.2: Valeurs ajustées du modèle de régression logistique en fonction du prédicteur linéaire <span class="math inline">\(\eta\)</span>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Pour une variable binaire <span class="math inline">\(Y\)</span>, le rapport <span class="math inline">\(p/(1-p)\)</span> est appelé <strong>cote</strong> et représente le ratio de la probabilité de succès (<span class="math inline">\(Y=1\)</span>) sur la probabilité d’échec (<span class="math inline">\(Y=0\)</span>), <span class="math display">\[\begin{align*}
\mathsf{cote}(p) = \frac{p}{1-p} = \frac{\Pr(Y=1 \mid \mathbf{X})}{\Pr(Y=0 \mid \mathbf{X})}.
\end{align*}\]</span></p>
<p>Par exemple, une cote de 4 veut dire qu’il y a 4 fois plus de chance que <span class="math inline">\(Y\)</span> soit égale à <span class="math inline">\(1\)</span> par rapport à <span class="math inline">\(0\)</span>. Une cote de 0.25 veut dire le contraire, il y a 4 fois moins de chance que <span class="math inline">\(Y=1\)</span> par rapport à <span class="math inline">\(0\)</span> ou bien, de manière équivalente, il y a 4 fois plus de chance que <span class="math inline">\(Y=0\)</span> par rapport à <span class="math inline">\(1\)</span>. Le <a href="#tbl-cotes">Tableau&nbsp;<span>5.1</span></a> donne un aperçu de cotes pour quelques probabilités <span class="math inline">\(p\)</span>.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-cotes_7aabd00834490b7d47f27b129f2605cb">
<div class="cell-output-display">
<div id="tbl-cotes" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.1:  Cote et probabilité de succès </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> \(\Pr(Y=1)\) </th>
   <th style="text-align:center;"> 0.1 </th>
   <th style="text-align:center;"> 0.2 </th>
   <th style="text-align:center;"> 0.3 </th>
   <th style="text-align:center;"> 0.4 </th>
   <th style="text-align:center;"> 0.5 </th>
   <th style="text-align:center;"> 0.6 </th>
   <th style="text-align:center;"> 0.7 </th>
   <th style="text-align:center;"> 0.8 </th>
   <th style="text-align:center;"> 0.9 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> cote </td>
   <td style="text-align:center;"> 0.11 </td>
   <td style="text-align:center;"> 0.25 </td>
   <td style="text-align:center;"> 0.43 </td>
   <td style="text-align:center;"> 0.67 </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 1.5 </td>
   <td style="text-align:center;"> 2.3 </td>
   <td style="text-align:center;"> 4 </td>
   <td style="text-align:center;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> \(\frac{1}{9}\) </td>
   <td style="text-align:center;"> \(\frac{1}{4}\) </td>
   <td style="text-align:center;"> \(\frac{3}{7}\) </td>
   <td style="text-align:center;"> \(\frac{2}{3}\) </td>
   <td style="text-align:center;"> \(1\) </td>
   <td style="text-align:center;"> \(\frac{3}{2}\) </td>
   <td style="text-align:center;"> \(\frac{7}{3}\) </td>
   <td style="text-align:center;"> \(4\) </td>
   <td style="text-align:center;"> \(9\) </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="estimation-et-interprétation-des-paramètres" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="estimation-et-interprétation-des-paramètres"><span class="header-section-number">5.2.1</span> Estimation et interprétation des paramètres</h3>
<p>Supposons qu’on dispose d’un échantillon de taille <span class="math inline">\(n\)</span> sur les variables <span class="math inline">\((Y, \mathrm{X}_1, \ldots, \mathrm{X}_p)\)</span>. À l’aide de ces observations, on peut estimer les paramètres <span class="math inline">\(\boldsymbol{\beta} = (\beta_0, \beta_1 ,\ldots, \beta_p)\)</span> du modèle de régression logistique <span class="math display">\[\begin{align*}
\textrm{logit}(p) = \ln \left( \frac{p}{1-p}\right) = \beta_0 + \beta_1 \mathrm{X}_1 + \cdots + \beta_p\mathrm{X}_p.
\end{align*}\]</span> On obtient ainsi les estimés des paramètres <span class="math inline">\(\widehat{\boldsymbol{\beta}}\)</span>, desquels découle une estimation de <span class="math inline">\(\Pr(Y=1)\)</span> pour les valeurs <span class="math inline">\(\mathrm{X}_1=x_1, \ldots, \mathrm{X}_p=x_p\)</span> d’un individu donné, <span class="math display">\[\begin{align*}
\widehat{p} = \textrm{expit}(\widehat{\beta}_0 + \cdots + \widehat{\beta}_p\mathrm{X}_p).
\end{align*}\]</span></p>
<p>Un modèle ajusté peut ensuite être utilisé pour faire de la classification (prédiction) pour de nouveaux individus pour lesquels la variable réponse <span class="math inline">\(Y\)</span> n’est pas observée. Pour ce faire, on choisit un point de coupure <span class="math inline">\(c\)</span> (souvent <span class="math inline">\(c=0.5\)</span> mais pas toujours) et on classifie les observations en deux groupes:</p>
<ul>
<li>Si <span class="math inline">\(\widehat{p}&lt; c\)</span>, alors <span class="math inline">\(\widehat{Y}=0\)</span> (c’est-à-dire, on assigne cette observation à la catégorie 0 ou échec).</li>
<li>Si <span class="math inline">\(\widehat{p} \geq c\)</span>, alors <span class="math inline">\(\widehat{Y}=1\)</span> (c’est-à-dire, on assigne cette observation à la catégorie 1 ou succès).</li>
</ul>
<p>On reviendra en détail sur cet aspect dans une section suivante.</p>
<p>La méthode d’estimation des paramètres usuelle est la méthode du maximum de vraisemblance. Pour les applications, il est suffisant de savoir manipuler trois quantités importantes: la log-vraisemblance, le <span class="math inline">\(\mathsf{AIC}\)</span> et le <span class="math inline">\(\mathsf{BIC}\)</span>. Les deux critères d’information, que nous avons couvert dans les chapitres précédents, servent à la sélection de modèles tandis que la log-vraisemblance <span class="math inline">\(\ell\)</span> servira à construire un test d’hypothèse.</p>
</section>
<section id="méthode-du-maximum-de-vraisemblance" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="méthode-du-maximum-de-vraisemblance"><span class="header-section-number">5.2.2</span> Méthode du maximum de vraisemblance</h3>
<p>Cette sous-section est facultative. Elle donne plus de détails sur la méthode du maximum de vraisemblance et les quantités en découlant, soit <span class="math inline">\(\mathsf{AIC}\)</span>, <span class="math inline">\(\mathsf{BIC}\)</span> et <span class="math inline">\(\ell(\widehat{\boldsymbol{\beta}})\)</span>.</p>
<p>La méthode du maximum de vraisemblance (<em>maximum likelihood</em>) est possiblement la méthode d’estimation la plus utilisée en statistique. En général, pour un échantillon donné et un modèle avec des paramètres inconnus <span class="math inline">\(\boldsymbol{\theta}\)</span>, on peut calculer la « probabilité » d’avoir obtenu les observations de notre échantillon selon les paramètre. Si on traite cette « probabilité » comme étant une fonction des paramètres du modèle, <span class="math inline">\(\boldsymbol{\theta}\)</span>, on l’appelle alors la vraisemblance (<em>likelihood</em>). La méthode du maximum de vraisemblance consiste à trouver les valeurs des paramètres qui maximisent la vraisemblance. On cherche donc les estimations qui sont les plus vraisemblables étant donné nos observations.</p>
<p>En pratique, il est habituellement plus simple de chercher à maximiser le log de la vraisemblance (ce qui revient au même car le logarithme naturel est une fonction croissante) et on nomme cette fonction la log-vraisemblance (<em>log-likelihood</em>).</p>
<p>Vous connaissez déjà des exemples d’estimateurs du maximum de vraisemblance. La moyenne d’un échantillon est l’estimateur du maximum de vraisemblance pour la moyenne de la population <span class="math inline">\(\mu\)</span> si les observations représentent un échantillon aléatoire simple tiré d’une loi normale.</p>
<p>Dans le cas d’un modèle de régression linéaire multiple de la forme <span class="math inline">\(Y_i \sim \mathsf{No}(\beta_0 + \sum_{j=1}^p \beta_j\mathrm{X}_{ij}, \sigma^2)\)</span> des termes indépendants et de même loi, la log-vraisemblance du modèle pour un échantillon de taille <span class="math inline">\(n\)</span> est <span class="math display">\[\begin{align*}
\ell(\boldsymbol{\beta}, \sigma^2) =- \frac{n}{2} \ln(2\pi\sigma^2) - \frac{1}{2\sigma^2}\sum_{i=1}^n (Y_i- \beta_0 - \beta_1 \mathrm{X}_{1i} - \cdots - \beta_p\mathrm{X}_{ip})^2.
\end{align*}\]</span> Puisque le premier terme ne dépend pas des paramètres <span class="math inline">\(\boldsymbol{\beta}\)</span>, il est clair que maximiser cette fonction de <span class="math inline">\(\boldsymbol{\beta}\)</span> revient à minimiser <span class="math inline">\(\sum_{i=1}^n (Y_i- \beta_0 - \beta_1 \mathrm{X}_{1i} - \cdots - \beta_p\mathrm{X}_{ip})^2\)</span>: ce critère est exactement le même que celui des moindres carrés. Par conséquent, les estimations des paramètres <span class="math inline">\(\boldsymbol{\beta}\)</span> provenant de la méthode des moindres carrés peuvent être vues comme étant des estimateurs du maximum de vraisemblance sous l’hypothèse de normalité et d’homoscédasticité des observations; il est même possible d’obtenir une formule explicite pour le calcul dest estimateurs.</p>
<p>Dans le cas de la régression logistique, la fonction de log-vraisemblance s’écrit <span class="math display">\[\begin{align*}
\ell(\boldsymbol{\beta}) &amp;= \sum_{i=1}^n Y_i ( \beta_0 + \beta_1 \mathrm{X}_{i1} + \cdots + \beta_p \mathrm{X}_{ip}) \\&amp;- \sum_{i=1}^n \ln\left\{1+\exp(\beta_0 + \cdots + \beta_p\mathrm{X}_{ip})\right\}
\end{align*}\]</span></p>
<p>Contrairement au cas de la régression linéaire, on ne peut trouver une solution explicite pour les valeurs des paramètres qui maximisent cette fonction. Des méthodes numériques doivent être utilisées pour l’optimisation. Une fois la maximisation accomplie, on obtient les estimés du maximum de vraisemblance, <span class="math inline">\(\widehat{\boldsymbol{\beta}}\)</span>. On peut alors calculer la valeur maximale (numérique) de la log-vraisemblance, <span class="math inline">\(\ell(\widehat{\boldsymbol{\beta}})\)</span>. Par analogie avec la régression linéaire la valeur de la log-vraisemblance évaluée à <span class="math inline">\(\widehat{\boldsymbol{\beta}}\)</span>, <span class="math inline">\(\ell(\widehat{\boldsymbol{\beta}})\)</span>, augmente toujours lorsqu’on ajoute des régresseurs et c’est pourquoi on ne pourra pas l’utiliser comme outil de sélection de variables.</p>
<p>Les critères d’information sont des fonctions de la log-vraisemblance, mais incluent une pénalité pour le nombre de coefficients <span class="math inline">\(\boldsymbol{\beta}\)</span>, <span class="math display">\[\begin{align*}
\mathsf{AIC} &amp; = -2 \ell(\widehat{\boldsymbol{\beta}}) + 2(p+1)\\
\mathsf{BIC} &amp; = -2 \ell(\widehat{\boldsymbol{\beta}}) + \ln(n)(p+1)
\end{align*}\]</span></p>
<p>Ces définitions sont utilisables dans plusieurs situations lorsque le modèle est ajusté par la méthode du maximum de vraisemblance. Tout comme en régression linéaire et en analyse factorielle, ces deux critères pourront être utilisés pour faire de la sélection de modèles si on calcule les estimateurs du maximum de vraisemblance.</p>
</section>
<section id="sec-cowboy" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="sec-cowboy"><span class="header-section-number">5.2.3</span> Exemple du <em>Professional Rodeo Cowboys Association</em></h3>
<p>L’exemple suivant est inspiré de l’article</p>
<blockquote class="blockquote">
<p>Daneshvary, R. et Schwer, R. K. (2000) The Association Endorsement and Consumers’ Intention to Purchase. <em>Journal of Consumer Marketing</em> <strong>17</strong>, 203-213.</p>
</blockquote>
<p>Dans cet article, les auteurs cherchent à voir si le fait qu’un produit soit recommandé par le <em>Professional Rodeo Cowboys Association</em> (PRCA) a un effet sur les intentions d’achats. On dispose de 500 observations sur les variables suivantes:</p>
<ul>
<li><span class="math inline">\(Y\)</span>: seriez-vous intéressé à acheter un produit recommandé par le PRCA
<ul>
<li><span class="math inline">\(\texttt{0}\)</span>: non</li>
<li><span class="math inline">\(\texttt{1}\)</span>: oui</li>
</ul></li>
<li><span class="math inline">\(\mathrm{X}_1\)</span>: quel genre d’emploi occupez-vous?
<ul>
<li><span class="math inline">\(\texttt{1}\)</span>: à la maison</li>
<li><span class="math inline">\(\texttt{2}\)</span>: employé</li>
<li><span class="math inline">\(\texttt{3}\)</span>: ventes/services</li>
<li><span class="math inline">\(\texttt{4}\)</span>: professionnel</li>
<li><span class="math inline">\(\texttt{5}\)</span>: agriculture/ferme</li>
</ul></li>
<li><span class="math inline">\(\mathrm{X}_2\)</span>: revenu familial annuel
<ul>
<li><span class="math inline">\(\texttt{1}\)</span>: moins de 25 000</li>
<li><span class="math inline">\(\texttt{2}\)</span>: 25 000 à 39 999</li>
<li><span class="math inline">\(\texttt{3}\)</span>: 40 000 à 59 999</li>
<li><span class="math inline">\(\texttt{4}\)</span>: 60 000 à 79 999</li>
<li><span class="math inline">\(\texttt{5}\)</span>: 80 000 et plus</li>
</ul></li>
<li><span class="math inline">\(\mathrm{X}_3\)</span>: sexe
<ul>
<li><span class="math inline">\(\texttt{0}\)</span>: homme</li>
<li><span class="math inline">\(\texttt{1}\)</span>: femme</li>
</ul></li>
<li><span class="math inline">\(\mathrm{X}_4\)</span>: avez-vous déjà fréquenté une université?
<ul>
<li><span class="math inline">\(\texttt{0}\)</span>: non</li>
<li><span class="math inline">\(\texttt{1}\)</span>: oui</li>
</ul></li>
<li><span class="math inline">\(\mathrm{X}_5\)</span>: âge (en années)</li>
<li><span class="math inline">\(\mathrm{X}_6\)</span>: combien de fois avez-vous assisté à un rodéo au cours de la dernière année?
<ul>
<li><span class="math inline">\(\texttt{1}\)</span>: 10 fois ou plus</li>
<li><span class="math inline">\(\texttt{2}\)</span>: entre six et neuf fois</li>
<li><span class="math inline">\(\texttt{3}\)</span>: cinq fois ou moins</li>
</ul></li>
</ul>
<p>Le but est d’examiner les effets de ces variables sur l’intentions d’achat (<span class="math inline">\(Y\)</span>). Les données se trouvent dans la base de données <code>logit1</code>.</p>
</section>
<section id="modèle-avec-une-seule-variable-explicative" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="modèle-avec-une-seule-variable-explicative"><span class="header-section-number">5.2.4</span> Modèle avec une seule variable explicative</h3>
<p>Faisons tout d’abord une analyse en utilisant seulement <span class="math inline">\(\mathrm{X}_5\)</span> (âge) comme variable explicative. L’ajustement du modèle de régression incluant uniquement <span class="math inline">\(\mathrm{X}_5\)</span> sera effectuée en exécutant le programme</p>
<div class="cell" data-hash="05-reglogistique_cache/html/logistique-init_2a7d86a3249cd0b03647d285502ea0dd">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(logit1, <span class="at">package =</span> <span class="st">"hecmulti"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre d'observations par groupe</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(logit1, <span class="fu">table</span>(y))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustement du modèle avec une</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  seule variable explicative</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>modele1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x5,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> logit1)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau résumé avec coefficients</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modele1)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Cote</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>cote <span class="ot">&lt;-</span> <span class="fu">exp</span>(modele1<span class="sc">$</span>coefficients)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalles de confiance profilés</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  pour les paramètres betas</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>confbeta <span class="ot">&lt;-</span> <span class="fu">confint</span>(modele1) </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalles de confiance pour la cote</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(confbeta) </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester la significativité globale </span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  à l'aide du rapport de vraisemblance</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modele1, <span class="at">test =</span> <span class="st">'Chisq'</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Critères d'information</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(modele1))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(logit1)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(modele1) </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># -2*logLik(modele1) + 2*np</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(modele1) </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># -2*logLik(modele1) + log(n)*np</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Par défaut, pour des variables <span class="math inline">\(0/1\)</span>, le modèle décrit la probabilité de succès. On peut transformer la variable réponse en facteur (<code>factor</code>) et changer la catégorie de référence via <code>relevel</code> pour obtenir le modèle <span class="math inline">\(\Pr(Y=0 \mid \mathrm{X}_5)\)</span>.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/categ-dep_949d7c0d5cc58696b9a4d685770d19d3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nlogit1 <span class="ot">&lt;-</span> logit1 <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(y), <span class="st">"1"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x5,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> nlogit1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quelques observations sur l’échantillon et les données:</p>
<ul>
<li>On voit qu’il y a 272 personnes (<span class="math inline">\(\texttt{0}\)</span>) qui ne sont pas intéressées à acheter un produit recommandé par le PRCA et 228 personnes (<span class="math inline">\(\texttt{1}\)</span>) qui le sont.</li>
<li>Les estimés des paramètres sont <span class="math inline">\(\widehat{\beta}_0 = -3.05\)</span> et <span class="math inline">\(\widehat{\beta}_{\texttt{age}}=0.0749\)</span>.</li>
<li>Un intervalle de confiance de niveau 95% pour l’effet de l’âge est [<span class="math inline">\(0.0465; 0.1043\)</span>].</li>
<li>Le modèle ajusté est <span class="math inline">\(\textrm{logit}\{\Pr(Y=1 \mid \mathrm{X}_5=x_5)\} = -3.05 + 0.0749 x_5\)</span>. On peut également exprimer ce modèle directement en terme de la probabilité de succès, <span class="math display">\[\begin{align*}
\Pr(Y=1 \mid \mathrm{X}_5=x_5) &amp;= \textrm{expit}(-3.05 + 0.0749 x_5) \\&amp;= \frac{1}{1+\exp(-3.05 - 0.0749 x_5)}
\end{align*}\]</span> Le graphe de cette fonction pour <span class="math inline">\(\mathrm{X}_5\)</span> allant de 18 à 59 ans, respectivement les valeurs minimales et maximales observées dans l’échantillon, montre que le lien entre l’âge et <span class="math inline">\(p\)</span> est presque linéaire entre 20 et 60 ans. On décèle tout de même la forme sigmoide de la fonction <span class="math inline">\(\textrm{logit}\)</span> aux deux extrémités.</li>
</ul>
<div class="cell" data-layout-align="center" data-hash="05-reglogistique_cache/html/logitplot2_fd109f62c36d007947c663e6442928f5">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/logitplot2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>La valeur-<span class="math inline">\(p\)</span> pour <span class="math inline">\(\widehat{\beta}_{\texttt{age}}\)</span> correspondant au test des hypothèses <span class="math inline">\(\mathscr{H}_0: \beta_{\texttt{age}}=0\)</span> versus <span class="math inline">\(\mathscr{H}_1: \beta_{\texttt{age}} \neq 0\)</span>, est plus petite que <span class="math inline">\(10^{-4}\)</span> et donc l’effet de la variable âge est statistiquement différent de zéro. Plus l’âge augmente, plus la probabilité d’être intéressé à acheter un produit recommandé par le PRCA augmente.</li>
</ul>
</section>
<section id="interprétation-du-paramètre" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="interprétation-du-paramètre"><span class="header-section-number">5.2.5</span> Interprétation du paramètre</h3>
<p>Si une variable est modélisée à l’aide d’un seul paramètre (pas de terme quadratique et pas d’interaction avec d’autre covariables), une valeur positive du paramètre indique une association positive avec <span class="math inline">\(p\)</span> alors qu’une valeur négative indique le contraire.</p>
<p>Ainsi, le signe du paramètre donne le sens de l’association. Si le coefficient <span class="math inline">\(\beta_j\)</span> de la variable <span class="math inline">\(\mathrm{X}_j\)</span> est positif, alors plus la variable augmente, plus <span class="math inline">\(\Pr(Y=1)\)</span> augmente. Inversement, si le coefficient <span class="math inline">\(\beta_j\)</span> est négatif, plus la variable augmente, plus <span class="math inline">\(\Pr(Y=1)\)</span> diminue.</p>
<p>En régression linéaire, l’interprétation de coefficient <span class="math inline">\(\beta_j\)</span> est simple: lorsque la variable <span class="math inline">\(\mathrm{X}_j\)</span> augmente de un, la variable <span class="math inline">\(Y\)</span> augmente en moyenne de <span class="math inline">\(\beta_j\)</span>, toute chose étant égale par ailleurs. Cette interprétation ne dépend pas de la valeur de <span class="math inline">\(\mathrm{X}_j\)</span>. En régression logistique, comme le modèle est nonlinéaire en fonction de <span class="math inline">\(\Pr(Y=1)\)</span> (courbe sigmoide), l’augmentation ou la dimininution de <span class="math inline">\(\Pr(Y=1\mid \mathbf{X})\)</span> pour un changement d’une unité de <span class="math inline">\(\mathrm{X}_j\)</span> dépend de la valeur de cette dernière. C’est pourquoi il est parfois plus utile d’utiliser la cote pour interpréter globalement l’effet d’une variable.</p>
<p>Dans notre exemple, on peut exprimer le modèle ajusté en termes de cote, <span class="math display">\[\begin{align*}
\frac{\Pr(Y=1 \mid \mathrm{X}_5=x_5)}{\Pr(Y=0 \mid \mathrm{X}_5=x_5)} = \exp(-3.05)\exp(0.0749x_5).
\end{align*}\]</span> Ainsi, lorsque <span class="math inline">\(\mathrm{X}_5\)</span> augmente d’une année, la cote est multipliée par <span class="math inline">\(\exp(0.0749) = 1.078\)</span> peut importe la valeur de <span class="math inline">\(x_5\)</span>. Pour deux personnes dont la différence d’âge est un an, la cote de la personne plus âgée est 7.8% plus élevée. On peut aussi quantifier l’effet d’une augmentation d’un nombre d’unités quelconque. Par exemple, pour chaque augmentation de 10 ans de <span class="math inline">\(\mathrm{X}_5\)</span>, la cote est multiplié par <span class="math inline">\(1.078^{10} = 2.12\)</span>, soit une augmentation de 112%.</p>
<p>L’interprétation des coefficients du modèle logistique se fait au niveau du rapport de cote, à savoir <span class="math inline">\(\exp(\beta)\)</span>.</p>
<p>Un des avantages d’utiliser la vraisemblance comme fonction objective est que les intervalles de confiance et les estimateurs basés sur la vraisemblance (profilée) sont invariant aux reparamétrisations: l’intervalle de confiance à niveau 95% pour <span class="math inline">\(\exp(\beta_{\texttt{age}})\)</span> est obtenu en prenant l’exponentielle des bornes de l’intervalle pour <span class="math inline">\(\beta_{\texttt{age}}\)</span>, [<span class="math inline">\(\exp(0.0465); \exp(0.1043)\)</span>], soit [<span class="math inline">\(1.048; 1.110\)</span>] tel que rapporté dans la sortie. Ce n’est <strong>pas</strong> le cas des intervalles usuels de Wald qui ont la forme <span class="math inline">\(\widehat{\beta} \pm 1.96 \mathrm{se}(\widehat{\beta})\)</span>.</p>
<p>Comme l’exponentielle est une transformation monotone croissante, on a <span class="math inline">\(\beta&gt;0\)</span> si et seulement si <span class="math inline">\(\exp(\beta)&gt;1\)</span>, etc. On peut ainsi utiliser les intervalles de confiance pour tester l’hypothèse <span class="math inline">\(\mathscr{H}_0: \beta_j=0\)</span> ou de façon équivalente <span class="math inline">\(\mathscr{H}_0: \exp(\beta_j)=1\)</span> à niveau 95%.</p>
<p>Ajustons à présent le modèle avec toutes les variables explicatives. Rappelez-vous que la variable <span class="math inline">\(\mathrm{X}_1\)</span> (quel genre d’emploi occupez-vous) a cinq catégories, <span class="math inline">\(\mathrm{X}_2\)</span> (revenu familial annuel) a cinq catégories, et <span class="math inline">\(\mathrm{X}_6\)</span> (combien de fois avez-vous assisté à un rodéo au cours de la dernière année) a trois catégories. Notez qu’on pourrait aussi traiter <span class="math inline">\(\mathrm{X}_2\)</span> comme continue car elle est ordinale et possède tout de même cinq modalités, mais on la traitera comme variable nominale.</p>
<p>Les variables de type <code>factor</code> sont modélisées par défaut à l’aide d’un ensemble de variables indicatrices, la catégorie de référence étant celle qui apparaît en dernier en ordre alphabétique.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/logistic-complet_2b753b14ee556987c7e075663cc51035">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(logit1)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>modele2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> logit1,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modele2)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">&lt;-</span> <span class="fu">confint</span>(modele2)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Tests de rapport de vraisemblance</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(modele2, <span class="at">type =</span> <span class="st">"3"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell tbl-cap-location-bottom" data-hash="05-reglogistique_cache/html/tbl-logit1-complet_cae0f2958f2c03e8d8453fb5ae2eb97f">
<div class="cell-output-display">
<div id="tbl-logit1-complet" class="anchored">

<div id="mwlefoodfi" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#mwlefoodfi) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#mwlefoodfi) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#mwlefoodfi) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#mwlefoodfi) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#mwlefoodfi) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#mwlefoodfi) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#mwlefoodfi) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#mwlefoodfi) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

:where(#mwlefoodfi) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#mwlefoodfi) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#mwlefoodfi) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#mwlefoodfi) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#mwlefoodfi) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwlefoodfi) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#mwlefoodfi) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#mwlefoodfi) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwlefoodfi) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#mwlefoodfi) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwlefoodfi) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#mwlefoodfi) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwlefoodfi) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#mwlefoodfi) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwlefoodfi) .gt_left {
  text-align: left;
}

:where(#mwlefoodfi) .gt_center {
  text-align: center;
}

:where(#mwlefoodfi) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#mwlefoodfi) .gt_font_normal {
  font-weight: normal;
}

:where(#mwlefoodfi) .gt_font_bold {
  font-weight: bold;
}

:where(#mwlefoodfi) .gt_font_italic {
  font-style: italic;
}

:where(#mwlefoodfi) .gt_super {
  font-size: 65%;
}

:where(#mwlefoodfi) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#mwlefoodfi) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#mwlefoodfi) .gt_indent_1 {
  text-indent: 5px;
}

:where(#mwlefoodfi) .gt_indent_2 {
  text-indent: 10px;
}

:where(#mwlefoodfi) .gt_indent_3 {
  text-indent: 15px;
}

:where(#mwlefoodfi) .gt_indent_4 {
  text-indent: 20px;
}

:where(#mwlefoodfi) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table"><caption>Tableau&nbsp;5.2:  Coefficients (cote), intervalles de confiance profilée de 95 pourcent et valeurs-p pour le test de rapport de vraisemblance pour le modèle logistique avec toutes les variables catégorielles. </caption>
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">variables</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">cote<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">IC 95%<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">valeur-p</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-weight: bold;">x1</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.4</td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;2</td>
<td class="gt_row gt_center">0.44</td>
<td class="gt_row gt_center">0.18, 1.06</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;3</td>
<td class="gt_row gt_center">0.51</td>
<td class="gt_row gt_center">0.21, 1.21</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;4</td>
<td class="gt_row gt_center">0.51</td>
<td class="gt_row gt_center">0.21, 1.25</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;5</td>
<td class="gt_row gt_center">0.70</td>
<td class="gt_row gt_center">0.27, 1.80</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">x2</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;2</td>
<td class="gt_row gt_center">0.83</td>
<td class="gt_row gt_center">0.38, 1.82</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;3</td>
<td class="gt_row gt_center">0.57</td>
<td class="gt_row gt_center">0.25, 1.31</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;4</td>
<td class="gt_row gt_center">0.09</td>
<td class="gt_row gt_center">0.03, 0.25</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;5</td>
<td class="gt_row gt_center">0.26</td>
<td class="gt_row gt_center">0.08, 0.84</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">x3</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;0</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1</td>
<td class="gt_row gt_center">3.85</td>
<td class="gt_row gt_center">2.34, 6.50</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">x4</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;0</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1</td>
<td class="gt_row gt_center">6.24</td>
<td class="gt_row gt_center">3.53, 11.4</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">x5</td>
<td class="gt_row gt_center">1.12</td>
<td class="gt_row gt_center">1.08, 1.16</td>
<td class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">x6</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;2</td>
<td class="gt_row gt_center">0.25</td>
<td class="gt_row gt_center">0.13, 0.49</td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;3</td>
<td class="gt_row gt_center">0.09</td>
<td class="gt_row gt_center">0.04, 0.18</td>
<td class="gt_row gt_center"></td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> cote = rapport de cote, IC = intervalle de confiance</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</div>
<div class="cell" data-fit-height="4" data-hash="05-reglogistique_cache/html/fig-confint-modele2-logist_77b60027dbac9b6e4f76ac4f05ac24a1">
<div class="cell-output-display">
<div id="fig-confint-modele2-logist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-confint-modele2-logist-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.3: Intervalles de confiance profilés de niveau 95% pour les coefficients du modèle logistique (échelle exponentielle).</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-gof-logist1_99b1192db060be4407d087af8845df5a">
<div class="cell-output-display">
<div id="tbl-gof-logist1" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.3:  Mesures d’ajustement du modèle avec toutes les variables explicatives, et du modèle nul (pour lequelle la probabilité de succès est la proportion de 1). </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> AIC </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> log.vrais. </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> modèle ajusté </td>
   <td style="text-align:right;"> 544.20 </td>
   <td style="text-align:right;"> 603.20 </td>
   <td style="text-align:right;"> -258.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> modèle nul </td>
   <td style="text-align:right;"> 691.27 </td>
   <td style="text-align:right;"> 695.48 </td>
   <td style="text-align:right;"> -258.1 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>L’interprétation se fait comme en régression linéaire multiple puisqu’il n’y a pas ni terme quadratique, ni interaction. Les paramètres estimés représentent donc l’effet de la variable correspondante sur le logit une fois que les autres variables sont dans le modèle, et demeurent fixes.</p>
<p>Prenons le coefficient associé à l’âge (<span class="math inline">\(\mathrm{X}_5\)</span>) comme exemple. Le paramètre estimé est <span class="math inline">\(\widehat{\beta}_{\texttt{age}}=0.109\)</span> et il est significativement différent de zéro. Ainsi, plus l’âge augmente, plus <span class="math inline">\(\Pr(Y=1\mid \mathbf{X})\)</span> augmente, toutes autres choses étant égales par ailleurs. Pour chaque augmentation d’un an de <span class="math inline">\(\mathrm{X}_5\)</span>, la cote est multipliée par <span class="math inline">\(\exp(0.109)=1.116\)</span>, lorsque les autres variables demeurent fixes.</p>
<p>N’oubliez pas la nuance suivante concernant l’interprétation d’un test lorsque plusieurs variables explicatives font partie du modèle. Si un paramètre n’est pas significativement différent de zéro, cela ne veut pas dire qu’il n’y a pas de lien entre la variable correspondante et <span class="math inline">\(Y\)</span>. Cela veut seulement dire qu’il n’y a pas de lien significatif une fois que les autres variables sont dans le modèle.</p>
<p>L’interprétation des variables catégorielles est analogue à celle faite en régression linéaire. On peut aussi interpréter individuellement les paramètres des indicatrices: pour <span class="math inline">\(\mathrm{I}(\mathrm{X}_6=2)\)</span>, lorsque les autres variables demeurent fixes, les personnes ayant assisté entre six et 10 fois à un rodéo au cours de la dernière année voient leur cote multipliée par <span class="math inline">\(\exp(-1.370)=0.255\)</span> par rapport aux personnes ayant assisté plus de di fois. Ce paramètre est significativement différent de zéro car sa valeur-<span class="math inline">\(p\)</span> est négligeable; l’intervalle de confiance à 95% pour le rapport de cotes, basé sur la vraisemblance profilée, est [0.13; 0.49] et la valeur 1 (qui correspond à un rapport de cote constant) n’est pas dans l’intervalle. Ainsi, il y a une différence significative entre les gens qui ont assisté à 10 rodéos ou plus et les gens qui ont assisté à 5 rodéos ou moins, pour ce qui est de l’intérêt à acheter un produit recommandé par le PRCA.</p>
<p>Si on désire comparer les deux modalités <span class="math inline">\(\mathrm{X}_6=2\)</span> et <span class="math inline">\(\mathrm{X}_6=3\)</span>, il suffit de changer la modalité de référence de <code>x6</code> et d’exécuter le modèle à nouveau. Une alternative est de calculer le rapport de cotes pour ces deux modalités.</p>
</section>
<section id="test-du-rapport-de-vraisemblance" class="level3" data-number="5.2.6">
<h3 data-number="5.2.6" class="anchored" data-anchor-id="test-du-rapport-de-vraisemblance"><span class="header-section-number">5.2.6</span> Test du rapport de vraisemblance</h3>
<p>Les tests rapportés d’ordinaire dans le tableau avec les coefficients (et correspondants aux valeurs-<span class="math inline">\(p\)</span>) sont des tests de Wald, à savoir <span class="math inline">\(W = \widehat{\beta}/\widehat{\mathsf{se}}(\widehat{\beta})\)</span>. Ces tests feront l’affaire dans la plupart des applications. Par contre, il existe un autre test qui est généralement plus puissant, c’est-à-dire qu’il sera meilleur pour détecter que <span class="math inline">\(\mathscr{H}_0\)</span> n’est pas vraie lorsque c’est effectivement le cas. Ce test est le test du rapport de vraisemblance (<em>likelihood ratio test</em>). Il découle de la méthode d’estimation du maximum de vraisemblance et est donc généralement applicable lorsqu’on estime les paramètres avec cette méthode. Il est basé sur la quantité <span class="math inline">\(\ell\)</span> que nous avons vue plus tôt.</p>
<p>La procédure consiste à ajuster deux modèles <strong>emboîtés</strong>:</p>
<ul>
<li>Le premier modèle, le modèle complet, contient tous les paramètres et l’estimateur du maximum de vraisemblance <span class="math inline">\(\widehat{\boldsymbol{\beta}})\)</span>.</li>
<li>Le deuxième modèle correspondant à l’hypothèse nulle <span class="math inline">\(\mathscr{H}_0\)</span>, le modèle réduit, contient tous les paramètres avec les restrictions imposées sous <span class="math inline">\(\mathscr{H}_0\)</span>; on dénote l’estimateur du maximum de vraisemblance <span class="math inline">\(\widehat{\boldsymbol{\beta}}_0\)</span></li>
</ul>
<p>Le test est basé sur la statistique <span class="math display">\[\begin{align*}
D = -2\{\ell(\widehat{\boldsymbol{\beta}}_0)-\ell(\widehat{\boldsymbol{\beta}})\}.
\end{align*}\]</span> Cette différence <span class="math inline">\(D\)</span>, lorsque l’hypothèse <span class="math inline">\(\mathscr{H}_0\)</span> est vraie suit approximativement une loi khi-deux avec un nombre de degrés de liberté égal au nombre de paramètre testé (le nombre de restrictions sous <span class="math inline">\(\mathscr{H}_0\)</span>). On peut donc calculer la valeur-<span class="math inline">\(p\)</span> en utilisant la distribution du khi-deux.</p>
<p>Prenons comme exemple le test de la significativité de <span class="math inline">\(\mathrm{X}_6\)</span>, qui est modélisée à l’aide deux variables binaires et dont les paramètres correspondants sont <span class="math inline">\(\beta_{6_{\texttt{2}}}\)</span> et <span class="math inline">\(\beta_{6_{\texttt{3}}}\)</span>. Pour effectuer le test du rapport de vraisemblance, il suffit de retirer la variable <span class="math inline">\(\mathrm{X}_6\)</span> et de réajuster le modèle à nouveau avec toutes les autres variables.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/test-rapport-vraisemblance_a9fa6d5f50c3f6ff64db952de98d4696">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuster modèle sous H0 (sans X6)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>modeleH0 <span class="ot">&lt;-</span> <span class="fu">update</span>(modele2, <span class="at">formula. =</span>  <span class="st">". ~ . - x6"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modeleH0, modele2, <span class="at">test =</span> <span class="st">"LRT"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Le modèle 'modeleH0' est équivalent à </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># glm(y ~ x1 + x2 + x3 + x4 + x5,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  data = logit1, </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  family = binomial(link = "logit"))</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculer statistique du test manuellement</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance = -2*log vraisemblance</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>rvrais <span class="ot">&lt;-</span> modeleH0<span class="sc">$</span>deviance <span class="sc">-</span> modele2<span class="sc">$</span>deviance</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeur-p</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(rvrais, <span class="at">df =</span> <span class="dv">2</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Considérons maintenant la variable <span class="math inline">\(\mathrm{X}_6\)</span>, qui représente le nombre de fois où l’individu a assisté à un rodéo au cours de la dernière année. Cette variable est modélisée à l’aide de deux variables indicatrices, <span class="math inline">\(\mathrm{I}(\mathrm{X}_6=2)\)</span> égale à un si <span class="math inline">\(\mathrm{X}_6=2\)</span> et zéro autrement, et <span class="math inline">\(\mathrm{I}(\mathrm{X}_6=3)\)</span> égale à un si <span class="math inline">\(\mathrm{X}_6=3\)</span> et zéro sinon. La catégorie de référence est <span class="math inline">\(\mathrm{X}_6=1\)</span>, c’est-à-dire les personnes ayant assisté plus de 10 fois à un rodéo au cours de la dernière année. Pour tester la significativité globale d’une variable catégorielle qui est modélisée avec plusieurs indicatrices, il faut utiliser un test qui compare l’ajustement du modèle avec ou sans toutes les variables binaires associées à <span class="math inline">\(\mathrm{X}_6\)</span>; l’hypothèse nulle <span class="math inline">\(\mathscr{H}_0: \beta_{6_{\texttt{2}}}=\beta_{6_{\texttt{3}}}=0\)</span> versus l’alternative qu’au moins un de ces deux paramètres est différent de zéro. La statistique du test de rapport de vraisemblance <span class="math inline">\(D\)</span> de 50.251 et la valeur-<span class="math inline">\(p\)</span> peut-être obtenue de la loi du khi-deux avec 2 degrés de liberté via le code suivant permet d’imprimer la valeur-<span class="math inline">\(p\)</span>, qui est <span class="math inline">\(1.22 \times 10^{-11}\)</span>.</p>
</section>
<section id="multicolinéarité" class="level3" data-number="5.2.7">
<h3 data-number="5.2.7" class="anchored" data-anchor-id="multicolinéarité"><span class="header-section-number">5.2.7</span> Multicolinéarité</h3>
<p>Rappelez-vous que le terme multicolinéarité fait référence à la situation où les variables explicatives sont très corrélées entre elles ou bien, plus généralement, à la situation où une (ou plusieurs) variable(s) explicative(s) est (sont) très corrélée(s) à une combinaison linéaire des autres variables explicatives.</p>
<p>L’effet potentiellement néfaste de la multicolinéarité est le même qu’en régression linéaire, c’est-à-dire, elle peut réduire la précision des estimations des paramètres (augmenter leurs écarts-types estimés).</p>
<p>En pratique, le problème est qu’il devient difficile de départager l’effet individuel d’une variable explicative lorsqu’elle est fortement corrélée avec d’autres variables explicatives.</p>
<p>Comme la multicolinéarité est une propriété des variables explicatives (le <span class="math inline">\(Y\)</span> n’intervient pas) on peut utiliser les mêmes outils qu’en régression linéaire pour tenter de la détecter, par exemple, le facteur d’inflation de la variance (<em>variance inflation factor</em>), accessible via <code>car::vif</code> pour un modèle de régression. Cette quantité ne dépend que des variables explicatives <span class="math inline">\(\mathbf{X}\)</span>, pas du modèle ou de la variable réponse.</p>
<p>La multicolinéarité est surtout un problème lorsque vient le temps d’interpréter et tester l’effet des paramètres individuels. Si le but est seulement de faire de la classification (prédiction) et que l’interprétation des paramètres individuels n’est pas cruciale alors il n’y a pas lieu de se soucier de la multicolinéarité. Il faut alors plutôt comparer correctement la performance de classification des modèles en utilisant des méthodes permettant d’obtenir un bon modèle tout en se protégeant contre le surajustement. Certaines de ces méthodes (division de l’échantillon, validation croisée) ont déjà été présentées.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
En résumé
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Une régression logistique sert à modéliser la moyenne de <strong>variables catégorielles</strong>, typiquement binaires.</li>
<li>C’est un cas particulier d’un modèle de régression linéaire généralisée.</li>
<li>Le modèle est interprétable à l’échelle de la cote, qui donne dans le cas binaire le rapport probabilité de réussite (1) sur probabilité d’échec (0)</li>
<li>En l’absence d’interactions, on interprète les coefficients en terme de pourcentage d’augmentation si <span class="math inline">\(\exp(\widehat{\beta}) &gt; 1\)</span>, avec <span class="math inline">\(\exp(\widehat{\beta})-1\)</span> ou en terme de pourcentage de diminution si <span class="math inline">\(\exp(\widehat{\beta}) &lt; 1\)</span>, avec <span class="math inline">\(1-\exp(\widehat{\beta})\)</span></li>
<li>L’estimation est faite par maximum de vraisemblance: on a accès aux critères d’information et aux tests d’hypothèses omnibus pour comparer des modèles emboîtés.</li>
<li>Les intervalles de confiance de vraisemblance profilée rapportés sont invariants aux reparamétrisations.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="classification-et-prédiction" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="classification-et-prédiction"><span class="header-section-number">5.3</span> Classification et prédiction</h2>
<p>La finalité du modèle de régression logistique est fréquemment l’obtention de prédictions. Une fois qu’on a ajusté un modèle, on peut l’utiliser pour prévoir la valeur de <span class="math inline">\(Y\)</span> pour de nouvelles observations. Ceci consiste à assigner une classe (<span class="math inline">\(0\)</span> ou <span class="math inline">\(1\)</span>) à ces observations (pour lesquels <span class="math inline">\(Y\)</span> est inconnue) à partir des valeurs prises par <span class="math inline">\(\mathrm{X}_1, \ldots, \mathrm{X}_p\)</span>.</p>
<p>Le modèle ajusté nous fournit une estimation de <span class="math inline">\(\Pr(Y=1 \mid \mathbf{X}=\boldsymbol{x})\)</span> pour des valeurs <span class="math inline">\(\mathrm{X}_1=x_1, \ldots, \mathrm{X}_p=x_p\)</span> données. Cet estimé est <span class="math display">\[\begin{align*}
\widehat{p} = \frac{1}{1+ \exp\{- ( \widehat{\beta}_0 + \widehat{\beta}_1x_1 + \cdots + \widehat{\beta}_p x_p)\}}.
\end{align*}\]</span></p>
<p>Classification de base: pour classifier des observations, il suffit de choisir un point de coupure <span class="math inline">\(c\)</span>, souvent <span class="math inline">\(c=0.5\)</span>, et de classifier une observation de la manière suivante:</p>
<ul>
<li>Si <span class="math inline">\(\widehat{p} &lt; c\)</span>, on assigne cette observation à la catégorie zéro et <span class="math inline">\(\widehat{Y}=0\)</span>.</li>
<li>Si <span class="math inline">\(\widehat{p} \geq c\)</span>, on assigne cette observation à la catégorie un et <span class="math inline">\(\widehat{Y}=1\)</span>.</li>
</ul>
<p>Si on prend <span class="math inline">\(c=0.5\)</span> comme point de coupure, cela revient à assigner l’observation à la classe (catégorie) la plus probable, un choix fort raisonnable. Nous verrons dans une section suivante que, lorsque les conséquences de faussement classifier une observation (succès, mais échec prédit et vice-versa) ne sont pas les mêmes, il peut être avantageux d’utiliser un autre point de coupure.</p>
<p>Dans un cadre de prédiction, il nous faudra un critère pour juger de la qualité de l’ajustement du modèle. Rappelez-vous que pour une réponse continue, nous avons utilisé l’erreur quadratique moyenne, <span class="math inline">\(\mathsf{EQM} = \mathsf{E}\{(Y-\widehat{Y})^2\}\)</span>, où <span class="math inline">\(\widehat{Y} = \mathsf{E}(Y \mid \mathbf{X})\)</span>, pour juger de la performance d’un modèle. Comme la réponse <span class="math inline">\(Y\)</span> est binaire ici, nous allons utiliser des critères différents.</p>
<p>Voyons d’abord un premier critère pour juger de la qualité d’un modèle de prédiction. Soit <span class="math inline">\(Y\)</span> la vraie valeur de la réponse binaire et <span class="math inline">\(\widehat{Y}\)</span> (soit 0 ou 1) la valeur de <span class="math inline">\(Y\)</span> prédite par un modèle pour une observation choisie au hasard dans la population. Un premier critère pour juger de la performance d’un modèle est le <strong>taux de mauvaise classification</strong>, un estimé de la probabilité de mal classifier une observation choisie au hasard dans la population, <span class="math inline">\(\Pr(Y \neq\widehat{Y})\)</span>. Plus <span class="math inline">\(\Pr(Y \neq\widehat{Y})\)</span> est petite, meilleure est la capacité prédictive du modèle.</p>
<p>Tout comme l’erreur quadratique moyenne, on ne peut qu’estimer <span class="math inline">\(\Pr(Y \neq\widehat{Y})\)</span>. Pour les raisons vues au chapitre précédent, l’estimer en calculant le taux de mauvaise classification des observations ayant servi à l’ajustement du modèle sans aucune correction n’est pas une bonne approche. Les approches couvertes dans le dernier chapitre pour l’estimation de l’erreur quadratique moyenne, telles la validation-croisée et la division de l’échantillon, peuvent être utilisées pour estimer le taux de mauvaise classification <span class="math inline">\(\Pr(Y \neq \widehat{Y})\)</span>.</p>
<p>Cette utilisation d’un modèle de régression logistique sera illustrée avec l’exemple que nous avons traité au chapitre précédent: notre objectif final est de construire un modèle avec les 1000 clients de l’échantillon d’apprentissage et cibler ensuite lesquels des 100 000 clients restants seront choisis pour recevoir le catalogue. Les variables cibles sont:</p>
<ul>
<li><code>yachat</code>: variable binaire égale à un si le client a acheté quelque chose dans le catalogue et zéro sinon.</li>
<li><code>ymontant</code>: le montant de l’achat si le client a acheté quelque chose</li>
</ul>
<p>Les 10 variables suivantes sont disponibles pour tous les clients et serviront de variables explicatives,</p>
<ul>
<li><code>x1</code>: sexe de l’individu, soit homme (0) ou femme (1);</li>
<li><code>x2</code>: l’âge (en année);</li>
<li><code>x3</code>: variable catégorielle indiquant le revenu, soit moins de 35 000$ (1), entre 35 000$ et 75 000$ (2) ou plus de 75 000$ (3);</li>
<li><code>x4</code>: variable catégorielle indiquant la région où habite le client (de 1 à 5);</li>
<li><code>x5</code>: conjoint : le client a-t-il un conjoint, soit oui (1) ou non (0);</li>
<li><code>x6</code>: nombre d’année depuis que le client est avec la compagnie;</li>
<li><code>x7</code>: nombre de semaines depuis le dernier achat;</li>
<li><code>x8</code>: montant (en dollars) du dernier achat;</li>
<li><code>x9</code>: montant total (en dollars) dépensé depuis un an;</li>
<li><code>x10</code>: nombre d’achats différents depuis un an.</li>
</ul>
<p>Dans le chapitre précédent, nous avons cherché à développer un modèle pour prévoir <code>ymontant</code>, le montant dépensé, étant donné que le client achète quelque chose. Cette fois-ci, nous allons travailler avec la variable <code>yachat</code>, qui est binaire, à l’aide de la régression logistique.</p>
<p>Afin d’introduire différentes notions, nous allons, dans un premier temps, utiliser les 10 variables de base. À partir de la section suivante, nous chercherons à optimiser le modèle en considérant les interactions d’ordre deux.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/score_51992de933875485192a9bb0cddb7116">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(dbm, <span class="at">package =</span> <span class="st">"hecmulti"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="st">"yachat ~ x1 + x2 + x3 +</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">                x4 + x5 + x6 + x7 + x8 + x9 + x10"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>dbm_class <span class="ot">&lt;-</span> dbm <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(test <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">yachat =</span> <span class="fu">factor</span>(yachat))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">202209</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>predprob <span class="ot">&lt;-</span> hecmulti<span class="sc">::</span><span class="fu">predvc</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">modele =</span> <span class="fu">glm</span>(<span class="at">formula =</span> formule, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dbm_class, </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">10</span>, <span class="co">#nombre de plis</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrep =</span> <span class="dv">1</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>classif <span class="ot">&lt;-</span> <span class="fu">with</span>(dbm, yachat[test <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau de la performance</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>hecmulti<span class="sc">::</span><span class="fu">perfo_logistique</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> predprob,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp =</span> classif)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le modèle utilise seulement les 10 variables de base. Des prévisions pour les clients restants seront exportées dans le fichier. La méthode <code>predict</code> permet d’obtenir les prédictions des probabilités et la fonction maison <code>hecmulti::perfo_logistique</code> retourne un tableau de classification. Tel que nous l’avons vu au chapitre précédent, il y a 210 clients qui ont acheté quelque chose parmi les 1000.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-classification0_d158374277f2b1d2211ffb158d20ecfc">
<div class="cell-output-display">
<div id="fig-classification0" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-classification0-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.4: Répartition des probabilités de succès prédites par validation croisée à <span class="math inline">\(n\)</span> groupes.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-classification-loocv_d2e438b4b6cd4666f6699788a33d17ee">
<div class="cell-output-display">
<div id="tbl-classification-loocv" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.4:  Tableau de classification avec le nombre de vrais positifs (VP), vrais négatifs (VN), faux positifs (FP) et faux négatifs (FN), le taux de bonne classification, la sensibilité, la spécificité, le taux de vrais positifs (TVP) et le taux de vrais négatifs (TVN). </caption>
 <thead>
  <tr>
   <th style="text-align:right;"> coupe </th>
   <th style="text-align:right;"> VP </th>
   <th style="text-align:right;"> VN </th>
   <th style="text-align:right;"> FP </th>
   <th style="text-align:right;"> FN </th>
   <th style="text-align:right;"> correct (%) </th>
   <th style="text-align:right;"> sensibilité (%) </th>
   <th style="text-align:right;"> spécificité (%) </th>
   <th style="text-align:right;"> TVP </th>
   <th style="text-align:right;"> TVN </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 210 </td>
   <td style="text-align:right;"> 209 </td>
   <td style="text-align:right;"> 581 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 41.9 </td>
   <td style="text-align:right;"> 100.0 </td>
   <td style="text-align:right;"> 26.5 </td>
   <td style="text-align:right;"> 26.5 </td>
   <td style="text-align:right;"> 100.0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 207 </td>
   <td style="text-align:right;"> 320 </td>
   <td style="text-align:right;"> 470 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 52.7 </td>
   <td style="text-align:right;"> 98.6 </td>
   <td style="text-align:right;"> 40.5 </td>
   <td style="text-align:right;"> 30.6 </td>
   <td style="text-align:right;"> 99.1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 201 </td>
   <td style="text-align:right;"> 398 </td>
   <td style="text-align:right;"> 392 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 59.9 </td>
   <td style="text-align:right;"> 95.7 </td>
   <td style="text-align:right;"> 50.4 </td>
   <td style="text-align:right;"> 33.9 </td>
   <td style="text-align:right;"> 97.8 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 199 </td>
   <td style="text-align:right;"> 451 </td>
   <td style="text-align:right;"> 339 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 65.0 </td>
   <td style="text-align:right;"> 94.8 </td>
   <td style="text-align:right;"> 57.1 </td>
   <td style="text-align:right;"> 37.0 </td>
   <td style="text-align:right;"> 97.6 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.10 </td>
   <td style="text-align:right;"> 193 </td>
   <td style="text-align:right;"> 480 </td>
   <td style="text-align:right;"> 310 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;"> 67.3 </td>
   <td style="text-align:right;"> 91.9 </td>
   <td style="text-align:right;"> 60.8 </td>
   <td style="text-align:right;"> 38.4 </td>
   <td style="text-align:right;"> 96.6 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.12 </td>
   <td style="text-align:right;"> 191 </td>
   <td style="text-align:right;"> 512 </td>
   <td style="text-align:right;"> 278 </td>
   <td style="text-align:right;"> 19 </td>
   <td style="text-align:right;"> 70.3 </td>
   <td style="text-align:right;"> 91.0 </td>
   <td style="text-align:right;"> 64.8 </td>
   <td style="text-align:right;"> 40.7 </td>
   <td style="text-align:right;"> 96.4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.14 </td>
   <td style="text-align:right;"> 184 </td>
   <td style="text-align:right;"> 547 </td>
   <td style="text-align:right;"> 243 </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:right;"> 73.1 </td>
   <td style="text-align:right;"> 87.6 </td>
   <td style="text-align:right;"> 69.2 </td>
   <td style="text-align:right;"> 43.1 </td>
   <td style="text-align:right;"> 95.5 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 176 </td>
   <td style="text-align:right;"> 572 </td>
   <td style="text-align:right;"> 218 </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 74.8 </td>
   <td style="text-align:right;"> 83.8 </td>
   <td style="text-align:right;"> 72.4 </td>
   <td style="text-align:right;"> 44.7 </td>
   <td style="text-align:right;"> 94.4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 172 </td>
   <td style="text-align:right;"> 598 </td>
   <td style="text-align:right;"> 192 </td>
   <td style="text-align:right;"> 38 </td>
   <td style="text-align:right;"> 77.0 </td>
   <td style="text-align:right;"> 81.9 </td>
   <td style="text-align:right;"> 75.7 </td>
   <td style="text-align:right;"> 47.3 </td>
   <td style="text-align:right;"> 94.0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.20 </td>
   <td style="text-align:right;"> 164 </td>
   <td style="text-align:right;"> 611 </td>
   <td style="text-align:right;"> 179 </td>
   <td style="text-align:right;"> 46 </td>
   <td style="text-align:right;"> 77.5 </td>
   <td style="text-align:right;"> 78.1 </td>
   <td style="text-align:right;"> 77.3 </td>
   <td style="text-align:right;"> 47.8 </td>
   <td style="text-align:right;"> 93.0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.22 </td>
   <td style="text-align:right;"> 162 </td>
   <td style="text-align:right;"> 626 </td>
   <td style="text-align:right;"> 164 </td>
   <td style="text-align:right;"> 48 </td>
   <td style="text-align:right;"> 78.8 </td>
   <td style="text-align:right;"> 77.1 </td>
   <td style="text-align:right;"> 79.2 </td>
   <td style="text-align:right;"> 49.7 </td>
   <td style="text-align:right;"> 92.9 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.24 </td>
   <td style="text-align:right;"> 158 </td>
   <td style="text-align:right;"> 639 </td>
   <td style="text-align:right;"> 151 </td>
   <td style="text-align:right;"> 52 </td>
   <td style="text-align:right;"> 79.7 </td>
   <td style="text-align:right;"> 75.2 </td>
   <td style="text-align:right;"> 80.9 </td>
   <td style="text-align:right;"> 51.1 </td>
   <td style="text-align:right;"> 92.5 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.26 </td>
   <td style="text-align:right;"> 153 </td>
   <td style="text-align:right;"> 645 </td>
   <td style="text-align:right;"> 145 </td>
   <td style="text-align:right;"> 57 </td>
   <td style="text-align:right;"> 79.8 </td>
   <td style="text-align:right;"> 72.9 </td>
   <td style="text-align:right;"> 81.6 </td>
   <td style="text-align:right;"> 51.3 </td>
   <td style="text-align:right;"> 91.9 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 150 </td>
   <td style="text-align:right;"> 657 </td>
   <td style="text-align:right;"> 133 </td>
   <td style="text-align:right;"> 60 </td>
   <td style="text-align:right;"> 80.7 </td>
   <td style="text-align:right;"> 71.4 </td>
   <td style="text-align:right;"> 83.2 </td>
   <td style="text-align:right;"> 53.0 </td>
   <td style="text-align:right;"> 91.6 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.30 </td>
   <td style="text-align:right;"> 143 </td>
   <td style="text-align:right;"> 667 </td>
   <td style="text-align:right;"> 123 </td>
   <td style="text-align:right;"> 67 </td>
   <td style="text-align:right;"> 81.0 </td>
   <td style="text-align:right;"> 68.1 </td>
   <td style="text-align:right;"> 84.4 </td>
   <td style="text-align:right;"> 53.8 </td>
   <td style="text-align:right;"> 90.9 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.32 </td>
   <td style="text-align:right;"> 138 </td>
   <td style="text-align:right;"> 679 </td>
   <td style="text-align:right;"> 111 </td>
   <td style="text-align:right;"> 72 </td>
   <td style="text-align:right;"> 81.7 </td>
   <td style="text-align:right;"> 65.7 </td>
   <td style="text-align:right;"> 85.9 </td>
   <td style="text-align:right;"> 55.4 </td>
   <td style="text-align:right;"> 90.4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.34 </td>
   <td style="text-align:right;"> 134 </td>
   <td style="text-align:right;"> 695 </td>
   <td style="text-align:right;"> 95 </td>
   <td style="text-align:right;"> 76 </td>
   <td style="text-align:right;"> 82.9 </td>
   <td style="text-align:right;"> 63.8 </td>
   <td style="text-align:right;"> 88.0 </td>
   <td style="text-align:right;"> 58.5 </td>
   <td style="text-align:right;"> 90.1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.36 </td>
   <td style="text-align:right;"> 130 </td>
   <td style="text-align:right;"> 699 </td>
   <td style="text-align:right;"> 91 </td>
   <td style="text-align:right;"> 80 </td>
   <td style="text-align:right;"> 82.9 </td>
   <td style="text-align:right;"> 61.9 </td>
   <td style="text-align:right;"> 88.5 </td>
   <td style="text-align:right;"> 58.8 </td>
   <td style="text-align:right;"> 89.7 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.38 </td>
   <td style="text-align:right;"> 126 </td>
   <td style="text-align:right;"> 708 </td>
   <td style="text-align:right;"> 82 </td>
   <td style="text-align:right;"> 84 </td>
   <td style="text-align:right;"> 83.4 </td>
   <td style="text-align:right;"> 60.0 </td>
   <td style="text-align:right;"> 89.6 </td>
   <td style="text-align:right;"> 60.6 </td>
   <td style="text-align:right;"> 89.4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.40 </td>
   <td style="text-align:right;"> 120 </td>
   <td style="text-align:right;"> 715 </td>
   <td style="text-align:right;"> 75 </td>
   <td style="text-align:right;"> 90 </td>
   <td style="text-align:right;"> 83.5 </td>
   <td style="text-align:right;"> 57.1 </td>
   <td style="text-align:right;"> 90.5 </td>
   <td style="text-align:right;"> 61.5 </td>
   <td style="text-align:right;"> 88.8 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.42 </td>
   <td style="text-align:right;"> 115 </td>
   <td style="text-align:right;"> 723 </td>
   <td style="text-align:right;"> 67 </td>
   <td style="text-align:right;"> 95 </td>
   <td style="text-align:right;"> 83.8 </td>
   <td style="text-align:right;"> 54.8 </td>
   <td style="text-align:right;"> 91.5 </td>
   <td style="text-align:right;"> 63.2 </td>
   <td style="text-align:right;"> 88.4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.44 </td>
   <td style="text-align:right;"> 112 </td>
   <td style="text-align:right;"> 731 </td>
   <td style="text-align:right;"> 59 </td>
   <td style="text-align:right;"> 98 </td>
   <td style="text-align:right;"> 84.3 </td>
   <td style="text-align:right;"> 53.3 </td>
   <td style="text-align:right;"> 92.5 </td>
   <td style="text-align:right;"> 65.5 </td>
   <td style="text-align:right;"> 88.2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.46 </td>
   <td style="text-align:right;"> 109 </td>
   <td style="text-align:right;"> 736 </td>
   <td style="text-align:right;"> 54 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 84.5 </td>
   <td style="text-align:right;"> 51.9 </td>
   <td style="text-align:right;"> 93.2 </td>
   <td style="text-align:right;"> 66.9 </td>
   <td style="text-align:right;"> 87.9 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.48 </td>
   <td style="text-align:right;"> 106 </td>
   <td style="text-align:right;"> 739 </td>
   <td style="text-align:right;"> 51 </td>
   <td style="text-align:right;"> 104 </td>
   <td style="text-align:right;"> 84.5 </td>
   <td style="text-align:right;"> 50.5 </td>
   <td style="text-align:right;"> 93.5 </td>
   <td style="text-align:right;"> 67.5 </td>
   <td style="text-align:right;"> 87.7 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.50 </td>
   <td style="text-align:right;"> 100 </td>
   <td style="text-align:right;"> 744 </td>
   <td style="text-align:right;"> 46 </td>
   <td style="text-align:right;"> 110 </td>
   <td style="text-align:right;"> 84.4 </td>
   <td style="text-align:right;"> 47.6 </td>
   <td style="text-align:right;"> 94.2 </td>
   <td style="text-align:right;"> 68.5 </td>
   <td style="text-align:right;"> 87.1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.52 </td>
   <td style="text-align:right;"> 98 </td>
   <td style="text-align:right;"> 748 </td>
   <td style="text-align:right;"> 42 </td>
   <td style="text-align:right;"> 112 </td>
   <td style="text-align:right;"> 84.6 </td>
   <td style="text-align:right;"> 46.7 </td>
   <td style="text-align:right;"> 94.7 </td>
   <td style="text-align:right;"> 70.0 </td>
   <td style="text-align:right;"> 87.0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.54 </td>
   <td style="text-align:right;"> 92 </td>
   <td style="text-align:right;"> 750 </td>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:right;"> 118 </td>
   <td style="text-align:right;"> 84.2 </td>
   <td style="text-align:right;"> 43.8 </td>
   <td style="text-align:right;"> 94.9 </td>
   <td style="text-align:right;"> 69.7 </td>
   <td style="text-align:right;"> 86.4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.56 </td>
   <td style="text-align:right;"> 87 </td>
   <td style="text-align:right;"> 753 </td>
   <td style="text-align:right;"> 37 </td>
   <td style="text-align:right;"> 123 </td>
   <td style="text-align:right;"> 84.0 </td>
   <td style="text-align:right;"> 41.4 </td>
   <td style="text-align:right;"> 95.3 </td>
   <td style="text-align:right;"> 70.2 </td>
   <td style="text-align:right;"> 86.0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.58 </td>
   <td style="text-align:right;"> 83 </td>
   <td style="text-align:right;"> 761 </td>
   <td style="text-align:right;"> 29 </td>
   <td style="text-align:right;"> 127 </td>
   <td style="text-align:right;"> 84.4 </td>
   <td style="text-align:right;"> 39.5 </td>
   <td style="text-align:right;"> 96.3 </td>
   <td style="text-align:right;"> 74.1 </td>
   <td style="text-align:right;"> 85.7 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.60 </td>
   <td style="text-align:right;"> 80 </td>
   <td style="text-align:right;"> 766 </td>
   <td style="text-align:right;"> 24 </td>
   <td style="text-align:right;"> 130 </td>
   <td style="text-align:right;"> 84.6 </td>
   <td style="text-align:right;"> 38.1 </td>
   <td style="text-align:right;"> 97.0 </td>
   <td style="text-align:right;"> 76.9 </td>
   <td style="text-align:right;"> 85.5 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.62 </td>
   <td style="text-align:right;"> 77 </td>
   <td style="text-align:right;"> 769 </td>
   <td style="text-align:right;"> 21 </td>
   <td style="text-align:right;"> 133 </td>
   <td style="text-align:right;"> 84.6 </td>
   <td style="text-align:right;"> 36.7 </td>
   <td style="text-align:right;"> 97.3 </td>
   <td style="text-align:right;"> 78.6 </td>
   <td style="text-align:right;"> 85.3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.64 </td>
   <td style="text-align:right;"> 74 </td>
   <td style="text-align:right;"> 771 </td>
   <td style="text-align:right;"> 19 </td>
   <td style="text-align:right;"> 136 </td>
   <td style="text-align:right;"> 84.5 </td>
   <td style="text-align:right;"> 35.2 </td>
   <td style="text-align:right;"> 97.6 </td>
   <td style="text-align:right;"> 79.6 </td>
   <td style="text-align:right;"> 85.0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.66 </td>
   <td style="text-align:right;"> 68 </td>
   <td style="text-align:right;"> 772 </td>
   <td style="text-align:right;"> 18 </td>
   <td style="text-align:right;"> 142 </td>
   <td style="text-align:right;"> 84.0 </td>
   <td style="text-align:right;"> 32.4 </td>
   <td style="text-align:right;"> 97.7 </td>
   <td style="text-align:right;"> 79.1 </td>
   <td style="text-align:right;"> 84.5 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.68 </td>
   <td style="text-align:right;"> 62 </td>
   <td style="text-align:right;"> 774 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 148 </td>
   <td style="text-align:right;"> 83.6 </td>
   <td style="text-align:right;"> 29.5 </td>
   <td style="text-align:right;"> 98.0 </td>
   <td style="text-align:right;"> 79.5 </td>
   <td style="text-align:right;"> 83.9 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.70 </td>
   <td style="text-align:right;"> 54 </td>
   <td style="text-align:right;"> 775 </td>
   <td style="text-align:right;"> 15 </td>
   <td style="text-align:right;"> 156 </td>
   <td style="text-align:right;"> 82.9 </td>
   <td style="text-align:right;"> 25.7 </td>
   <td style="text-align:right;"> 98.1 </td>
   <td style="text-align:right;"> 78.3 </td>
   <td style="text-align:right;"> 83.2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.72 </td>
   <td style="text-align:right;"> 51 </td>
   <td style="text-align:right;"> 777 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 159 </td>
   <td style="text-align:right;"> 82.8 </td>
   <td style="text-align:right;"> 24.3 </td>
   <td style="text-align:right;"> 98.4 </td>
   <td style="text-align:right;"> 79.7 </td>
   <td style="text-align:right;"> 83.0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 49 </td>
   <td style="text-align:right;"> 778 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 161 </td>
   <td style="text-align:right;"> 82.7 </td>
   <td style="text-align:right;"> 23.3 </td>
   <td style="text-align:right;"> 98.5 </td>
   <td style="text-align:right;"> 80.3 </td>
   <td style="text-align:right;"> 82.9 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> 46 </td>
   <td style="text-align:right;"> 778 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 164 </td>
   <td style="text-align:right;"> 82.4 </td>
   <td style="text-align:right;"> 21.9 </td>
   <td style="text-align:right;"> 98.5 </td>
   <td style="text-align:right;"> 79.3 </td>
   <td style="text-align:right;"> 82.6 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> 41 </td>
   <td style="text-align:right;"> 781 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 169 </td>
   <td style="text-align:right;"> 82.2 </td>
   <td style="text-align:right;"> 19.5 </td>
   <td style="text-align:right;"> 98.9 </td>
   <td style="text-align:right;"> 82.0 </td>
   <td style="text-align:right;"> 82.2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> 35 </td>
   <td style="text-align:right;"> 783 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 175 </td>
   <td style="text-align:right;"> 81.8 </td>
   <td style="text-align:right;"> 16.7 </td>
   <td style="text-align:right;"> 99.1 </td>
   <td style="text-align:right;"> 83.3 </td>
   <td style="text-align:right;"> 81.7 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> 33 </td>
   <td style="text-align:right;"> 783 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 177 </td>
   <td style="text-align:right;"> 81.6 </td>
   <td style="text-align:right;"> 15.7 </td>
   <td style="text-align:right;"> 99.1 </td>
   <td style="text-align:right;"> 82.5 </td>
   <td style="text-align:right;"> 81.6 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> 32 </td>
   <td style="text-align:right;"> 783 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 178 </td>
   <td style="text-align:right;"> 81.5 </td>
   <td style="text-align:right;"> 15.2 </td>
   <td style="text-align:right;"> 99.1 </td>
   <td style="text-align:right;"> 82.1 </td>
   <td style="text-align:right;"> 81.5 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> 28 </td>
   <td style="text-align:right;"> 784 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 182 </td>
   <td style="text-align:right;"> 81.2 </td>
   <td style="text-align:right;"> 13.3 </td>
   <td style="text-align:right;"> 99.2 </td>
   <td style="text-align:right;"> 82.4 </td>
   <td style="text-align:right;"> 81.2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.88 </td>
   <td style="text-align:right;"> 25 </td>
   <td style="text-align:right;"> 786 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 185 </td>
   <td style="text-align:right;"> 81.1 </td>
   <td style="text-align:right;"> 11.9 </td>
   <td style="text-align:right;"> 99.5 </td>
   <td style="text-align:right;"> 86.2 </td>
   <td style="text-align:right;"> 80.9 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> 21 </td>
   <td style="text-align:right;"> 787 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 189 </td>
   <td style="text-align:right;"> 80.8 </td>
   <td style="text-align:right;"> 10.0 </td>
   <td style="text-align:right;"> 99.6 </td>
   <td style="text-align:right;"> 87.5 </td>
   <td style="text-align:right;"> 80.6 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.92 </td>
   <td style="text-align:right;"> 18 </td>
   <td style="text-align:right;"> 787 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 192 </td>
   <td style="text-align:right;"> 80.5 </td>
   <td style="text-align:right;"> 8.6 </td>
   <td style="text-align:right;"> 99.6 </td>
   <td style="text-align:right;"> 85.7 </td>
   <td style="text-align:right;"> 80.4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.94 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 788 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 196 </td>
   <td style="text-align:right;"> 80.2 </td>
   <td style="text-align:right;"> 6.7 </td>
   <td style="text-align:right;"> 99.7 </td>
   <td style="text-align:right;"> 87.5 </td>
   <td style="text-align:right;"> 80.1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.96 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 788 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 204 </td>
   <td style="text-align:right;"> 79.4 </td>
   <td style="text-align:right;"> 2.9 </td>
   <td style="text-align:right;"> 99.7 </td>
   <td style="text-align:right;"> 75.0 </td>
   <td style="text-align:right;"> 79.4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 790 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 208 </td>
   <td style="text-align:right;"> 79.2 </td>
   <td style="text-align:right;"> 1.0 </td>
   <td style="text-align:right;"> 100.0 </td>
   <td style="text-align:right;"> 100.0 </td>
   <td style="text-align:right;"> 79.2 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Le <a href="#tbl-classification-loocv">Tableau&nbsp;<span>5.4</span></a> contient des estimations de plusieurs quantités intéressantes rattachées à la classification, en faisant varier le point de coupure. Pour chaque point de coupure, ces estimations ont été obtenues par validation croisée à <span class="math inline">\(n\)</span> groupes (en anglais, <em>leave-one-out cross-validation</em>, ou LOOCV). Ainsi, ces estimations sont meilleures que les estimés sans ajustement aucun car elles ne sont pas obtenues en utilisant les mêmes observations que celles qui ont servi à estimer le modèle.</p>
<p>La colonne <code>Correct</code> donne le taux de bonne classification, <span class="math inline">\(\Pr(Y = \widehat{Y})\)</span>: avec un point de coupure de <span class="math inline">\(0\)</span>, on classifie toutes les observations à la classe achat (<span class="math inline">\(1\)</span>), car <span class="math inline">\(\widehat{p}\)</span> est forcément plus grande que zéro. Le taux de bonne classification dans ce cas de figure sera de <span class="math inline">\(21\)</span>%, puisque 210 individus ont acheté un produit dans le catalogue dans l’échantillon d’apprentissage. L’autre extrême, avec un point de coupure <span class="math inline">\(c=1\)</span>, donne un taux de bonne classification de <span class="math inline">\(79\)</span>%.</p>
<p>On peut chercher dans le tableau les points de coupure qui donnent le meilleur taux de bonne classification. Ce dernier, à savoir 84.6%, est atteint par trois points de coupure, soit 0.52, soit 0.6, soit 0.62. Une recherche plus fine donne 0.465 comme point de coupure optimal, avec un taux de mauvaise classification de 15.3%.</p>
<p>Avec une variable réponse binaire, il y a deux classifications possibles et le tableau de confusion contient, en partant du coin supérieur gauche et dans le sens des aiguilles d’une montre, le nombre de vrai positif (<span class="math inline">\(Y=1\)</span>, <span class="math inline">\(\widehat{Y}=1\)</span>), de faux positif (<span class="math inline">\(Y=0\)</span>, <span class="math inline">\(\widehat{Y}=1\)</span>), de vrai négatif (<span class="math inline">\(Y=0\)</span>, <span class="math inline">\(\widehat{Y}=0\)</span>) et finalement de faux négatif (<span class="math inline">\(Y=1\)</span>, <span class="math inline">\(\widehat{Y}=0\)</span>). La <strong>matrice de confusion</strong>, qui compare les vraies valeurs avec les prédictions, peut être construite à partir des colonnes <code>VP</code>, <code>VN</code>, <code>FP</code> et <code>FN</code>. Ces nombres proviennent de la validation croisée à <span class="math inline">\(n\)</span> groupes et ne sont pas ceux qu’on obtiendrait si on appliquait directement le modèle ajusté à notre échantillon. Le taux de mauvaise classification est <span class="math inline">\((\mathsf{FP}+\mathsf{FN})/n\)</span>; une estimation plus fiable serait obtenue en utilisant la validation croisée à 10 groupes.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-confumat_6993f2c6aabd3aef3e0670be253249fe">
<div class="cell-output-display">
<div id="tbl-confumat" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.5:  Matrice de confusion avec point de coupure 0.465. </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> \(Y=1\) </th>
   <th style="text-align:right;"> \(Y=0\) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> \(\widehat{Y}=1\) </td>
   <td style="text-align:right;"> 109 </td>
   <td style="text-align:right;"> 52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(\widehat{Y}=0\) </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 738 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Quatre autres quantités, dérivées à partir de la matrice de confusion, sont parfois utilisées:</p>
<ul>
<li>la <strong>sensibilité</strong> (<em>sensitivity</em>), <span class="math inline">\(\Pr(\widehat{Y}=1 \mid Y=1)\)</span>, ou <span class="math inline">\(\mathsf{VP}/(\mathsf{VP}+\mathsf{FN})\)</span>;</li>
<li>la <strong>spécificité</strong> (<em>specificity</em>), <span class="math inline">\(\Pr(\widehat{Y}=0 \mid Y=0)\)</span>, ou <span class="math inline">\(\mathsf{VN}/(\mathsf{VN}+\mathsf{FP})\)</span>;</li>
<li>le <strong>taux de vrais positifs</strong>, <span class="math inline">\(\Pr(Y=1 \mid \widehat{Y}=1)\)</span>, ou <span class="math inline">\(\mathsf{VP}/(\mathsf{VP}+\mathsf{FP})\)</span>;</li>
<li>le <strong>taux de vrais négatifs</strong>, <span class="math inline">\(\Pr(Y=0 \mid \widehat{Y}=0)\)</span>, ou <span class="math inline">\(\mathsf{VN}/(\mathsf{VN}+\mathsf{FN})\)</span>.</li>
</ul>
<p>Les estimés empiriques sont simplement obtenus en calculant les rapports du nombre d’observations dans chaque classe.</p>
<p>La sensibilité mesure à quel point notre modèle est performant pour détecter un vrai positif (classe 1). La spécificité mesure à quel point notre modèle est performant pour détecter un résultat négatif (classe 0). Plus le point de coupure augmente, plus la sensibilité et le taux de faux positifs diminuent mais plus la spécificité et le taux de faux négatifs augmentent.</p>
<section id="fonction-defficacité-du-récepteur" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="fonction-defficacité-du-récepteur"><span class="header-section-number">5.3.1</span> Fonction d’efficacité du récepteur</h3>
<p>La <strong>fonction d’efficacité du récepteur</strong>, parfois appelée courbe ROC (<em>receiver operating characteristic</em>) est parfois utilisée pour représenter globalement la performance du modèle. Il s’agit du graphe de la sensibilité en fonction de un moins la spécificité, en faisant varier le point de coupure. Un modèle parfait aurait une sensibilité et une spécificité égales à 1 (correspondant au coin supérieur gauche de la fonction d’efficacité du récepteur). Ainsi, plus le couple (<span class="math inline">\(1-\)</span>spécificité, sensibilité) est près de (<span class="math inline">\(0\)</span>, <span class="math inline">\(1\)</span>), meilleur est le modèle. Par conséquent, plus la courbe ROC tend vers (<span class="math inline">\(0\)</span>, <span class="math inline">\(1\)</span>) meilleur est le pouvoir prévisionnel des variables. L’<strong>aire sous la courbe</strong> (<em>area under the curve</em>, ou AUC) est souvent utilisée en parallèle comme mesure de la qualité: comme son nom l’indique, c’est l’aire sous la courbe de la fonction d’efficacité du récepteur.</p>
<p>La fonction <code>courbe_roc</code> permet de tracer la courbe et de calculer l’aire sous la courbe. Plus cette valeur est près de 1, mieux c’est: une probabilité de 0.5 correspond à une allocation aléatoire, représentée sur la fonction d’efficacité du récepteur par la ligne diagonale.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-roccurve_d9f58bce4be5ca336cd0a5b0b34b2b05">
<div class="cell-output-display">
<div id="fig-roccurve" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-roccurve-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.5: Fonction d’efficacité du récepteur avec probabilités de succès issues de la validation croisée à <span class="math inline">\(n\)</span> groupes.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="05-reglogistique_cache/html/courbe-roc-code_5681f05d44a11538d2ae2851e06df512">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction d'efficacité du récepteur</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>roc <span class="ot">&lt;-</span> hecmulti<span class="sc">::</span><span class="fu">courbe_roc</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp =</span> classif,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> predprob,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(roc)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Pour extraire l'aire sous la courbe, </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># roc$aire</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="classification-avec-une-matrice-de-gain" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="classification-avec-une-matrice-de-gain"><span class="header-section-number">5.3.2</span> Classification avec une matrice de gain</h3>
<p>Utiliser le taux de mauvaise classification <span class="math inline">\(\Pr(Y \neq \widehat{Y})\)</span>, comme critère de performance, revient au même que d’utiliser le taux de bonne classification <span class="math inline">\(\Pr(Y=\widehat{Y})\)</span>, car <span class="math inline">\(\Pr(Y \neq \widehat{Y}) = 1-\Pr(Y=\widehat{Y})\)</span>. On veut un modèle avec un haut taux de bonne classification (ou un faible taux de mauvaise classification).</p>
<p>Lorsqu’on utilise <span class="math inline">\(\Pr(Y \neq \widehat{Y})\)</span> comme critère pour juger de la qualité d’un modèle prévisionnel, on fait l’hypothèse que le gain associé à bien classifier une observation dans la catégorie 0 lorsqu’elle est réellement dans la catégorie 0 est le même que celui associé à classifier une observation dans la catégorie 1 lorsqu’elle est réellement dans la catégorie 1: cela correspond à la matrice de gain.</p>
<div id="tbl-03-gain1" class="anchored">
<table class="table">
<caption>Tableau&nbsp;5.6: Matrice de gain correspondant au taux de bonne classification</caption>
<thead>
<tr class="header">
<th></th>
<th></th>
<th style="text-align: right;">observation</th>
<th style="text-align: right;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>gain</td>
<td style="text-align: right;"><span class="math inline">\(Y=1\)</span></td>
<td style="text-align: right;"><span class="math inline">\(Y=0\)</span></td>
</tr>
<tr class="even">
<td>prédiction</td>
<td><span class="math inline">\(\widehat{Y}=1\)</span></td>
<td style="text-align: right;"><span class="math inline">\(1\)</span></td>
<td style="text-align: right;"><span class="math inline">\(0\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(\widehat{Y}=0\)</span></td>
<td style="text-align: right;"><span class="math inline">\(0\)</span></td>
<td style="text-align: right;"><span class="math inline">\(1\)</span></td>
</tr>
</tbody>
</table>
</div>
<p>Le gain vaut 1 lorsque la prévision est bonne (les deux cas sur la diagonale) et 0 lorsque le modèle se trompe (les deux autres cas). L’unité de mesure du gain n’est pas importante pour l’instant. Le gain total est</p>
<p><span class="math display">\[\begin{align*}
\text{gain} &amp;= 1 \Pr(\widehat{Y}=1, Y=1) + 1 \Pr(\widehat{Y}=0, Y=0)
\\ &amp;\quad + 0 \Pr(\widehat{Y}=1, Y=0)  + 0 \Pr(\widehat{Y}=0, Y=1)
\\&amp; = \Pr(Y = \widehat{Y}).
\end{align*}\]</span> Maximiser le gain total revient donc à maximiser le taux de bonne classification.</p>
<p>Dans certaines situations, les gains (ou la perte si le gain est négatif) associés aux bonnes décisions et aux erreurs ne sont pas équivalents.</p>
<p>Supposons que le gain de classer une observation à <span class="math inline">\(i\)</span> (<span class="math inline">\(i \in \{0,1\}\)</span>) lorsqu’elle vaut <span class="math inline">\(j\)</span> (<span class="math inline">\(j \in \{0,1\}\)</span>) en réalité est de <span class="math inline">\(c_{ij}\)</span>. La matrice de gain est alors</p>
<div id="tbl-03-gain2" class="anchored">
<table class="table">
<caption>Tableau&nbsp;5.7: Matrice de gain pondérée en fonction d’un coût</caption>
<thead>
<tr class="header">
<th></th>
<th></th>
<th style="text-align: right;">observation</th>
<th style="text-align: right;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>gain</td>
<td style="text-align: right;"><span class="math inline">\(Y=1\)</span></td>
<td style="text-align: right;"><span class="math inline">\(Y=0\)</span></td>
</tr>
<tr class="even">
<td>prédiction</td>
<td><span class="math inline">\(\widehat{Y}=1\)</span></td>
<td style="text-align: right;"><span class="math inline">\(c_{11}\)</span></td>
<td style="text-align: right;"><span class="math inline">\(c_{10}\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(\widehat{Y}=0\)</span></td>
<td style="text-align: right;"><span class="math inline">\(c_{01}\)</span></td>
<td style="text-align: right;"><span class="math inline">\(c_{00}\)</span></td>
</tr>
</tbody>
</table>
</div>
<p>En pratique, l’une de ces quatre quantités peut être fixée à 1 car seulement les poids relatifs (les ratios) des gains sont importants. Dans ce cas, le gain moyen est <span class="math display">\[\begin{align*}
\text{gain} &amp;= c_{11} \Pr(\widehat{Y}=1, Y=1) + c_{00}\Pr(\widehat{Y}=0, Y=0)
\\ &amp;\quad + c_{10} \Pr(\widehat{Y}=1, Y=0)  + c_{01} \Pr(\widehat{Y}=0, Y=1)
\end{align*}\]</span></p>
<p>Le meilleur modèle est alors celui qui maximise le gain moyen.</p>
<p>Nous allons encore une fois seulement utiliser les 10 variables de base. Mais nous allons intégrer des revenus et coûts afin de trouver le meilleur point de coupure. Rappelez-vous que le coût de l’envoi d’un catalogue est de 10$. Le tableau des variables descriptives qui suit montre que, pour les 210 clients qui ont acheté quelque chose, le revenu moyen est de 67.29$ (moyenne de la variable <code>ymontant</code>).</p>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-dbm-ymontant-apprentissage_8a84b82471db299e56dba5f4b43a38c1">
<div class="cell-output-display">
<div id="tbl-dbm-ymontant-apprentissage" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.8:  Statistiques descriptives des montants d’achats pour la base de données marketing (échantillon d’apprentissage). </caption>
 <thead>
  <tr>
   <th style="text-align:right;"> n </th>
   <th style="text-align:right;"> moyenne </th>
   <th style="text-align:right;"> écart-type </th>
   <th style="text-align:right;"> minimum </th>
   <th style="text-align:right;"> maximum </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 210 </td>
   <td style="text-align:right;"> 67.29 </td>
   <td style="text-align:right;"> 13.24 </td>
   <td style="text-align:right;"> 25 </td>
   <td style="text-align:right;"> 109 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Nous allons travailler en termes de revenu net. Nous pouvons donc spécifier la matrice de gain du <a href="#tbl-03-gain3">Tableau&nbsp;<span>5.9</span></a> pour notre problème. Si on n’envoie pas de catalogue, notre gain est nul. Si on envoie le catalogue à un client qui n’achète pas, on perd 10$ (le coût de l’envoi). En revanche, notre revenu net est de 57$ (revenu moyen moins coût de l’envoi).</p>
<div id="tbl-03-gain3" class="anchored">
<table class="table">
<caption>Tableau&nbsp;5.9: Matrice de gain pour l’envoi de catalogue</caption>
<thead>
<tr class="header">
<th></th>
<th></th>
<th style="text-align: right;">observation</th>
<th style="text-align: right;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>gain</td>
<td style="text-align: right;"><span class="math inline">\(Y=1\)</span></td>
<td style="text-align: right;"><span class="math inline">\(Y=0\)</span></td>
</tr>
<tr class="even">
<td>prédiction</td>
<td><span class="math inline">\(\widehat{Y}=1\)</span></td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">-10</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(\widehat{Y}=0\)</span></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<p>On peut calculer la performance du modèle et le gain moyen en faisant varier le point de coupure. Pour avoir une mesure fidèle, on utilise la validation croisée à <span class="math inline">\(K=10\)</span> groupes (la mesure affichée correspondant à la moyenne de 10 réplications)</p>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-coupure-pondere_07cf50ae18bc31683b510b0252910d41">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(dbm, <span class="at">package =</span> <span class="st">"hecmulti"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>donnees <span class="ot">&lt;-</span> dbm <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(test <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">=</span> <span class="fu">formula</span>(yachat <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                    x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6 <span class="sc">+</span> x7 <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                    x8 <span class="sc">+</span> x9 <span class="sc">+</span> x10)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>modele <span class="ot">&lt;-</span> <span class="fu">glm</span>(formule, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> binomial, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> donnees)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>coupe <span class="ot">&lt;-</span> hecmulti<span class="sc">::</span><span class="fu">select_pcoupe</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">modele =</span> modele, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">c00 =</span> <span class="dv">0</span>, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">c01 =</span> <span class="dv">0</span>, </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">c10 =</span> <span class="sc">-</span><span class="dv">10</span>, </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">c11 =</span> <span class="dv">57</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>coupe</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Point de coupure optimal: 0.01 </code></pre>
</div>
<div class="cell-output-display">
<div id="fig-coupure-pondere" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-coupure-pondere-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.6: Estimation du gain moyen en fonction du point de coupure pour l’exemple de base de données marketing.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La fonction <code>select_pcoupe</code> donne l’estimation du gain moyen (<code>gain</code>) pour différents points de coupures (<code>pcoupe</code>). Cette estimation provient d’une validation-croisée avec <span class="math inline">\(K\)</span> groupes (<code>ncv</code>) dans la fonction), répétée <code>nrep</code> fois. On a effectué ici la validation croisée avec 10 groupes et fait la moyenne des 10 répétitions afin d’avoir plus de précision.</p>
<p>On voit dans la <a href="#fig-coupure-pondere">Figure&nbsp;<span>5.6</span></a> que le meilleur point de coupure, celui qui maximise le gain est 0.01. Avec ce point de coupure, et selon le <a href="#tbl-classification-loocv">Tableau&nbsp;<span>5.4</span></a>, on estime que le taux de bonne classification est de 70.3 et que la sensibilité est de 90.95. Ainsi, on estime qu’on va détecter environ 91% des clients qui achètent.</p>
<p>Comme il est très coûteux de rater un client qui aurait acheté quelque chose, il est préférable d’envoyer le catalogue à plus de clients, quitte à ce que plusieurs d’entre eux n’achètent rien. Bien que le point de coupure de 0.5 donne un meilleur taux de bonne classification, il correspond à un gain moyen plus faible car on rate trop de clients qui achètent (la sensibilité est de seulement 47.62%). Travailler avec la matrice de gain permet de trouver le point de coupure optimal en incorporant des notions de coûts et profits.</p>
</section>
<section id="courbe-lift" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="courbe-lift"><span class="header-section-number">5.3.3</span> Courbe lift</h3>
<p>Un autre type de graphe qui est souvent utilisé dans des contextes de gestion est la courbe lift (sic) (en anglais, <em>lift chart</em>). Cette courbe est obtenue en ordonnant les probabilités de succès estimées par le modèle, <span class="math inline">\(\widehat{p}\)</span>, en ordre croissant et en regardant quelle pourcentage de ces derniers seraient bien classifiés (le nombre de vrais positifs sur le nombre de succès).</p>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-courbe-lift_473e024fddb03d8e45b4ece2a8e55fde">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tab_lift <span class="ot">&lt;-</span> hecmulti<span class="sc">::</span><span class="fu">courbe_lift</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> predprob, <span class="co"># probabilité de succès (Y=1)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp =</span> classif, <span class="co"># variable binaire réponse 0/1</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>tab_lift</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-lift_276a4f7fa868c8c3d0c2e6ee89e8144f">
<div class="cell-output-display">
<div id="fig-lift" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-lift-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.7: Courbe lift</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-lift_001518663f301fd96db87d901238c097">
<div class="cell-output-display">
<div id="tbl-lift" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.10:  Tableau du lift (déciles). </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> pourcent </th>
   <th style="text-align:right;"> hasard </th>
   <th style="text-align:right;"> modele </th>
   <th style="text-align:right;"> lift </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 10% </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 21 </td>
   <td style="text-align:right;"> 78 </td>
   <td style="text-align:right;"> 3.714286 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 20% </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 42 </td>
   <td style="text-align:right;"> 120 </td>
   <td style="text-align:right;"> 2.857143 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 30% </td>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:right;"> 63 </td>
   <td style="text-align:right;"> 157 </td>
   <td style="text-align:right;"> 2.492063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 40% </td>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:right;"> 84 </td>
   <td style="text-align:right;"> 180 </td>
   <td style="text-align:right;"> 2.142857 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 50% </td>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:right;"> 105 </td>
   <td style="text-align:right;"> 195 </td>
   <td style="text-align:right;"> 1.857143 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 60% </td>
   <td style="text-align:right;"> 60 </td>
   <td style="text-align:right;"> 126 </td>
   <td style="text-align:right;"> 201 </td>
   <td style="text-align:right;"> 1.595238 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 70% </td>
   <td style="text-align:right;"> 70 </td>
   <td style="text-align:right;"> 147 </td>
   <td style="text-align:right;"> 208 </td>
   <td style="text-align:right;"> 1.414966 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 80% </td>
   <td style="text-align:right;"> 80 </td>
   <td style="text-align:right;"> 168 </td>
   <td style="text-align:right;"> 210 </td>
   <td style="text-align:right;"> 1.250000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 90% </td>
   <td style="text-align:right;"> 90 </td>
   <td style="text-align:right;"> 189 </td>
   <td style="text-align:right;"> 210 </td>
   <td style="text-align:right;"> 1.111111 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Le <a href="#tbl-lift">Tableau&nbsp;<span>5.10</span></a> présente les 10 déciles. Si on classifiait comme acheteurs les 10% qui ont la plus forte probabilité estimée d’achat, on détecterait 81 des 210 clients (37.6%). En comparaison, on s’attend que 21 clients soient sélectionnés en moyenne si on prend un échantillon aléatoire de 100 personnes. Le ratio 81/21 (dernière colonne) est le <em>lift</em> du modèle: il permet de détecter 3.86 fois plus de succès que le hasard.</p>
<p>La <a href="#fig-lift">Figure&nbsp;<span>5.7</span></a> présente le pourcentage d’observations bien classées parmi les variables (pourcentage des probabilités prédites qui correspondent à un succès parmi les <span class="math inline">\(k\)</span> plus susceptibles selon le modèle). La référence est la ligne diagonale, qui correspond à une détection aléatoire.</p>
</section>
<section id="calibration-du-modèle-et-détection-du-surajustement" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="calibration-du-modèle-et-détection-du-surajustement"><span class="header-section-number">5.3.4</span> Calibration du modèle et détection du surajustement</h3>
<p>Il peut être intéressant de vérifier la <strong>calibration</strong> de notre modèle, et une statistique simple proposée par <a href="https://doi.org/10.1002/sim.4780050506">Spiegelhalter (1986)</a> peut être utile à cette fin. Pour une variable binaire <span class="math inline">\(Y \in \{0,1\}\)</span>, l’erreur quadratique moyenne s’écrit <span class="math display">\[\begin{align*}
\overline{B} &amp;= \frac{1}{n} \sum_{i=1}^n (Y_i-p_i)^2
=\frac{1}{n} \sum_{i=1}^n(Y_i-p_i)(1-2p_i) + \frac{1}{n} \sum_{i=1}^n p_i(1-p_i).
\end{align*}\]</span> Le premier terme représente le manque de calibration du modèle, tandis que le deuxième correspond à la séparation entre variables. Si notre modèle était parfaitement calibré, alors <span class="math inline">\(\mathsf{E}_0(Y_i)=p_i\)</span> et <span class="math inline">\(\mathsf{Va}_0(Y_i) = p_i(1-p_i)\)</span>. On peut utiliser ce fait pour construire une statistique de test de la forme <span class="math inline">\(Z = \{\overline{B} - \mathsf{E}_0(\overline{B})\}/\sqrt{\mathsf{Va}_0(\overline{B})}\)</span>, où <span class="math display">\[\begin{align*}
\mathsf{E}_0(\overline{B})&amp;= \frac{1}{n} \sum_{i=1}^n p_i(1-p_i) \\
\mathsf{Va}_0(\overline{B})&amp;= \frac{1}{n^2} \sum_{i=1}^n p_i(1-p_i)(1-2p_i)^2
\end{align*}\]</span></p>
<div class="cell" data-hash="05-reglogistique_cache/html/calibration_e75f6aa7f61ad5589f41cec5a8c7955c">

</div>
<p>Sous l’hypothèse nulle de calibration parfaite, <span class="math inline">\(Z \sim \mathsf{No}(0,1)\)</span> en grand échantillon. Pour le modèle simple avec toutes les covariables, la valeur-<span class="math inline">\(p\)</span> approximative calculée avec les probabilités de succès obtenues par validation-croisée et les données de l’échantillon d’apprentissage est 0.22 et il n’y a pas de preuve ici que le modèle est mal calibré. Cette technique est utile pour vérifier s’il n’y a pas de surajustement (auquel cas le modèle tend à retourner des probabilités très près de 0/1, mais qui ne correspondent pas à la réalité).</p>
<p>Ici, nous avons ajusté un seul modèle, celui contenant uniquement les 10 variables de base et nous nous sommes attardés au choix du point de coupure pour l’assignation aux classes. Il est possible qu’un autre modèle, contenant par exemple des termes d’interactions, des termes quadratiques ou d’autres transformations des variables, soit supérieur à celui-ci. Le choix du modèle de prévision se fait donc souvent en deux étapes:</p>
<ol type="1">
<li>choisir les variables explicatives</li>
<li>sélectionner un point de coupure.</li>
</ol>
<p>Nous avons déjà vu des méthodes de sélections de variables au chapitre précédent. La section suivante reviendra sur ces méthodes dans le contexte de la régression logistique.</p>
</section>
<section id="sélection-de-variables-en-régression-logistique" class="level3" data-number="5.3.5">
<h3 data-number="5.3.5" class="anchored" data-anchor-id="sélection-de-variables-en-régression-logistique"><span class="header-section-number">5.3.5</span> Sélection de variables en régression logistique</h3>
<p>Les principes généraux, concernant la sélection de variables et de modèles, que nous avons vus au chapitre précédent sont toujours valides. Les critères <span class="math inline">\(\mathsf{AIC}\)</span> et <span class="math inline">\(\mathsf{BIC}\)</span> sont toujours disponibles puisqu’on estime le modèle par maximum de vraisemblance et les techniques générales de division de l’échantillon et de validation-croisée sont toujours valides. La principale différence est le coût d’estimation numérique des différents modèles: parce qu’il n’y a pas de solution explicite pour les estimateurs du maximum de vraisemblance du modèle logistique, ajuster chacun de ces modèles est coûteux.</p>
<p>À la section précédente, nous avons inclus les 10 variables de base dans notre exemple d’envoi ciblé. Nous allons ici faire une recherche de type exhaustive parmi ces variables. La fonction <code>glmbb</code> du paquet éponyme fait une recherche à l’aide de l’algorithme de recherche arborescente dite par méthode de séparation et d’évaluation, qui ne nécessite pas de tester tous les modèles emboîtés. La sortie inclut les modèles qui sont à distance au plus <code>cutoff</code> du modèle optimal en ordre décroissant du critère d’information, avec une pondération associée qui peut servir comme succédané au mélange de modèle. La fonction permet de choisir entre les critères <span class="math inline">\(\mathsf{AIC}\)</span> et <span class="math inline">\(\mathsf{BIC}\)</span> et inclut toutes les modalités des variables explicatives pour les facteurs.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/select-bic-branchandbound_c2b5e16c782c508556fab1adb34dbbf9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(dbm, <span class="at">package =</span> <span class="st">"hecmulti"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>donnees <span class="ot">&lt;-</span> dbm <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(test <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="fu">formula</span>(yachat <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>               x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6 <span class="sc">+</span> x7 <span class="sc">+</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>               x8 <span class="sc">+</span> x9 <span class="sc">+</span> x10)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>select_BIC <span class="ot">&lt;-</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  glmbb<span class="sc">::</span><span class="fu">glmbb</span>(formule, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> donnees,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">criterion =</span> <span class="st">"BIC"</span>, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>resultat_BIC <span class="ot">&lt;-</span> <span class="fu">summary</span>(select_BIC)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Formule du meilleur modèle</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>resultat_BIC<span class="sc">$</span>results<span class="sc">$</span>formula</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeurs de BIC des modèles</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>resultat_BIC<span class="sc">$</span>results<span class="sc">$</span>criterion</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ceci n’est qu’un exemple de stratégie de sélection de modèle parmi tant d’autre: le code qui suit explorera d’autres alternatives. Nous allons évaluer la performance de ces différentes stratégies avec comme critère de performance le revenu net de la stratégie si elle était appliquée aux 100 000 clients restants. Pour chacun des 100 000 clients à catégoriser, nous allons calculer la quantité suivante :</p>
<ul>
<li>Si le client n’est pas ciblé pour l’envoi d’un catalogue par le modèle, alors le revenu est nul.</li>
<li>Si le client est ciblé pour l’envoi d’un catalogue par le modèle et qu’il n’achète rien, le revenu est de <span class="math inline">\(-10\)</span>$ (le coût de l’envoi).</li>
<li>Si le client est ciblé pour l’envoi d’un catalogue par le modèle et qu’il achète quelque chose, le revenu est de (<code>ymontant</code><span class="math inline">\(-10\)</span>)$, c’est-à-dire, le montant qu’il dépense moins le <span class="math inline">\(10\)</span>$ du coût de l’envoi.</li>
</ul>
<p>Pour une stratégie donnée, chaque individu n’appartient qu’à une seule des catégories. Le revenu net de la stratégie est la somme des revenus pour les 100 000 clients. Parmi ces derniers, 23 179 auraient acheté si on leur avait envoyé le catalogue et ces clients auraient généré des revenus de 1 601 212$. Si on enlève le coût des envois (100 000 X 10$ = 1 000 000$), on obtient que la stratégie de référence permet un revenu net de 601 212$.</p>
<p>Dans ce cas, nous allons estimer la probabilité d’achat avec un modèle de régression logistique. Nous allons ensuite trouver le meilleur point de coupure, avec une matrice de gain adéquatement choisie, afin d’avoir une règle d’assignation optimale. Nous avons déterminé des modèles potentiels à la section précédente. De plus, nous avons déjà vu comment trouver le meilleur point de coupure en spécifiant une matrice de gain, afin de maximiser le gain moyen à partir de la matrice de gain du <a href="#tbl-03-gain3">Tableau&nbsp;<span>5.9</span></a>. Nous allons donc trouver le meilleur point de coupure pour quelques-uns des modèles choisis à la section précédente, pour ensuite évaluer le revenu net de ces modèles.</p>
<p>Il faut encore une fois bien comprendre qu’en pratique, on ne pourrait pas faire cette comparaison, car on ne sait pas d’avance si les clients futurs vont acheter ou non. Mais dans cet exemple, les variables <code>yachat</code> et <code>ymontant</code> sont fournies pour ces 100 000 clients afin qu’on puisse voir ce qui se serait passé avec les différentes stratégies.</p>
<p>La stratégie de référence est celle qui consiste à envoyer le catalogue aux 100 000 clients sans les sélectionner. Le tableau qui suit montre des statistiques pour les variables <code>ymontant</code> et <code>yachat</code> pour les 100 000 clients à scorer. Le <a href="#tbl-03-summarylog">Tableau&nbsp;<span>5.11</span></a> résume la performance des différentes stratégies basées exclusivement sur le modèle logistique.</p>
<p>En résumé, la procédure numérique à réaliser est la suivante:</p>
<ul>
<li>Choisir les variables à essayer (interactions, etc.)</li>
<li>Choisir l’algorithme ou la méthode de sélection</li>
<li>Obtenir un modèle final et calculer le point de coupure optimal selon notre matrice de coût.</li>
<li>Pour obtenir la performance finale, on obtient les prédictions pour les 100 000 clients de l’échantillon de validation et on classifie pour prédire la classe de <code>yachat</code> pour les données de validation à l’aide du point de coupure optimal choisi.</li>
<li>On calcule ensuite le revenu en soustrayant 10$ pour chaque envoi et en additionnant les montants d’achats des personnes qui ont reçu le catalogue.</li>
</ul>
<p>Quelques commentaires sur des raccourcis syntaxiques propres à <strong>R</strong>: dans une formule, spécifier <code>~.</code> indique que l’on ajoute au modèle de régression toutes les variables explicatives de la base de données, moins la variable réponse. On peut aussi utiliser <code>.^2</code> ou de manière équivalent <code>.*.</code> pour spécifier tous ces termes, ainsi que leurs interactions. Si on veut ajouter un terme quadratique pour une variable <code>x</code>, il faudra spécifier la transformation à l’intérieur de <code>I()</code>, par exemple <code>I(x^2)</code>.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/selection-variable-logistique-dbm_b1414ffe33af59951adea99c66f07b12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diviser les bases de données </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># en échantillons d'apprentissage</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># et de validation</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(dbm, <span class="at">package =</span> <span class="st">"hecmulti"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>valid <span class="ot">&lt;-</span> dbm[dbm<span class="sc">$</span>test <span class="sc">==</span> <span class="dv">1</span>,] <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span> <span class="fu">c</span>(ymontant, test))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>appr <span class="ot">&lt;-</span> dbm[dbm<span class="sc">$</span>test <span class="sc">==</span> <span class="dv">0</span>, ] <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span> <span class="fu">c</span>(ymontant, test))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Formule du modèle avec toutes les interactions </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># d'ordre 2 (.^2) et les termes quadratiques I(x^2)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="fu">formula</span>(yachat <span class="sc">~</span> .<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x6<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">I</span>(x7<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x8<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">I</span>(x9<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x10<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Nouvelles bases de données avec toutes ces variables</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># On retire la première colonne (1, ordonnée à l'origine)</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>appr_c <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">model.matrix</span>(formule, <span class="at">data =</span> appr)[,<span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">as.integer</span>(appr<span class="sc">$</span>yachat))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>valid_c <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">model.matrix</span>(formule, <span class="at">data =</span> valid)[,<span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">as.integer</span>(valid<span class="sc">$</span>yachat))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>valid_ymontant <span class="ot">&lt;-</span> <span class="fu">with</span>(dbm, ymontant[test <span class="sc">==</span> 1L])</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustement des différents modèles</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Modèle avec toutes les variables principales</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">glm</span>(yachat <span class="sc">~</span> ., </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> appr, </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> binomial)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul du point de coupe optimal</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co">#  (par validation croisée)</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>base_coupe <span class="ot">&lt;-</span> hecmulti<span class="sc">::</span><span class="fu">select_pcoupe</span>(</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">modele =</span> base, </span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">c00 =</span> <span class="dv">0</span>, </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">c01 =</span> <span class="dv">0</span>, </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">c10 =</span> <span class="sc">-</span><span class="dv">10</span>, </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">c11 =</span> <span class="dv">57</span>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance sur données de validation</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>base_pred <span class="ot">&lt;-</span> </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">object =</span> base, </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> valid, </span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> base_coupe<span class="sc">$</span>optim</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>base_perfo <span class="ot">&lt;-</span> </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">10</span><span class="sc">*</span><span class="fu">sum</span>(base_pred) <span class="sc">+</span> </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(valid_ymontant[base_pred], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Modèle avec toutes les variables + interactions</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustement</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>complet <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> formule, </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> appr, </span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Sélection du point de coupure</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>complet_coupe <span class="ot">&lt;-</span> hecmulti<span class="sc">::</span><span class="fu">select_pcoupe</span>(</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">modele =</span> complet, <span class="at">c00 =</span> <span class="dv">0</span>, </span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">c01 =</span> <span class="dv">0</span>, <span class="at">c10 =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">c11 =</span> <span class="dv">57</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance sur données de validation</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>complet_pred <span class="ot">&lt;-</span> </span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">object =</span> complet, </span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> valid, </span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> complet_coupe<span class="sc">$</span>optim</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Revenu</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>complet_perfo <span class="ot">&lt;-</span> </span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">10</span><span class="sc">*</span><span class="fu">sum</span>(complet_pred) <span class="sc">+</span> </span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(valid_ymontant[complet_pred], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Sélection de modèle avec algorithme glouton</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Recherche séquentielle (AIC)</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>seqAIC <span class="ot">&lt;-</span> <span class="fu">step</span>(<span class="at">object =</span> complet, </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>                <span class="at">direction =</span> <span class="st">"both"</span>, <span class="co"># séquentielle</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>                <span class="at">k =</span> <span class="dv">2</span>, <span class="co"># AIC </span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>                <span class="at">trace =</span> <span class="dv">0</span>) </span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>seqAIC_coupe <span class="ot">&lt;-</span> </span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>  hecmulti<span class="sc">::</span><span class="fu">select_pcoupe</span>(</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">modele =</span> seqAIC, <span class="at">c00 =</span> <span class="dv">0</span>, </span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">c01 =</span> <span class="dv">0</span>, <span class="at">c10 =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">c11 =</span> <span class="dv">57</span>)</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>seqAIC_pred <span class="ot">&lt;-</span> </span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict.glm</span>(<span class="at">object =</span> seqAIC, </span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>              <span class="at">newdata =</span> valid, </span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>              <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> </span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>  seqAIC_coupe<span class="sc">$</span>optim</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>seqAIC_perfo <span class="ot">&lt;-</span> </span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">10</span><span class="sc">*</span><span class="fu">sum</span>(seqAIC_pred) <span class="sc">+</span> </span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(valid_ymontant[seqAIC_pred], </span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Recherche séquentielle (BIC)</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>seqBIC <span class="ot">&lt;-</span> <span class="fu">step</span>(<span class="at">object =</span> complet,</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>                <span class="at">direction =</span> <span class="st">"both"</span>, <span class="co"># séquentielle</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>                <span class="at">k =</span> <span class="fu">log</span>(<span class="fu">nobs</span>(complet)), <span class="co">#BIC</span></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>                <span class="at">trace =</span> <span class="dv">0</span>)  </span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>seqBIC_coupe <span class="ot">&lt;-</span> hecmulti<span class="sc">::</span><span class="fu">select_pcoupe</span>(</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">modele =</span> seqBIC, <span class="at">c00 =</span> <span class="dv">0</span>,</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">c01 =</span> <span class="dv">0</span>, <span class="at">c10 =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">c11 =</span> <span class="dv">57</span>)</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>seqBIC_pred <span class="ot">&lt;-</span> </span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict.glm</span>(<span class="at">object =</span> seqBIC, </span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>              <span class="at">newdata =</span> valid, </span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>              <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> </span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>  seqBIC_coupe<span class="sc">$</span>optim</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>seqBIC_perfo <span class="ot">&lt;-</span> </span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">10</span><span class="sc">*</span><span class="fu">sum</span>(seqBIC_pred) <span class="sc">+</span> </span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(valid_ymontant[seqBIC_pred], </span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Recherche exhaustive par algorithm génétique</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a><span class="co"># avec moins de variables</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>appr_r <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">model.matrix</span>(seqAIC)[,<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> appr<span class="sc">$</span>yachat))</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>valid_r <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.matrix</span>(<span class="fu">formula</span>(seqAIC), </span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> valid)[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmulti)</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>exgen <span class="ot">&lt;-</span> glmulti<span class="sc">::</span><span class="fu">glmulti</span>(</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y <span class="sc">~</span> .,</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nombre de variables limitées</span></span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> appr_r,  </span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> <span class="dv">1</span>,           <span class="co"># sans interaction</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"g"</span>,        <span class="co"># recherche génétique</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">crit =</span> <span class="st">"bic"</span>,            <span class="co"># critère (AIC, BIC, ...)</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">confsetsize =</span> <span class="dv">1</span>,         <span class="co"># meilleur modèle uniquement</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">plotty =</span> <span class="cn">FALSE</span>, </span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">report =</span> <span class="cn">FALSE</span>,  <span class="co"># sans graphique ou rapport</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">fitfunction =</span> <span class="st">"glm"</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TASK: Genetic algorithm in the candidate set.
Initialization...
Algorithm started...
Improvements in best and average IC have bebingo en below the specified goals.
Algorithm is declared to have converged.
Completed.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Redéfinir le modèle via "glm"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>exgen_modele <span class="ot">&lt;-</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(exgen<span class="sc">@</span>objects[[<span class="dv">1</span>]]<span class="sc">$</span>formula,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> appr_r,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>exgen_coupe <span class="ot">&lt;-</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  hecmulti<span class="sc">::</span><span class="fu">select_pcoupe</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">modele =</span> exgen_modele, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">c00 =</span> <span class="dv">0</span>, <span class="at">c01 =</span> <span class="dv">0</span>, <span class="at">c10 =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">c11 =</span> <span class="dv">57</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>exgen_pred <span class="ot">&lt;-</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(exgen_modele, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata =</span> valid_r, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> exgen_coupe<span class="sc">$</span>optim</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>exgen_perfo <span class="ot">&lt;-</span>  </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">10</span><span class="sc">*</span><span class="fu">sum</span>(exgen_pred) <span class="sc">+</span> </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(valid_ymontant[exgen_pred], </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># LASSO</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Trouver le paramètre de pénalisation par</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># validation croisée (10 groupes)</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>cvfit <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">as.matrix</span>(appr_c[, <span class="sc">-</span><span class="fu">ncol</span>(appr_c)]), </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> appr_c<span class="sc">$</span>y, </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>, </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">type.measure =</span> <span class="st">"auc"</span>) <span class="co"># aire sous courbe</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Le critère par défaut est la déviance (-2ll)</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuster modèle avec pénalisation </span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">glmnet</span>(</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">as.matrix</span>(appr_c[,<span class="sc">-</span><span class="fu">ncol</span>(appr_c)]), </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> appr_c<span class="sc">$</span>y, </span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>, </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda =</span> cvfit<span class="sc">$</span>lambda<span class="fl">.1</span>se)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer performance selon les points de coupure</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>probs_lasso <span class="ot">&lt;-</span> </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lasso, </span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">newx =</span> <span class="fu">as.matrix</span>(appr_c[,<span class="sc">-</span><span class="fu">ncol</span>(appr_c)]), </span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"resp"</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>lasso_coupe <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  hecmulti<span class="sc">::</span><span class="fu">perfo_logistique</span>(</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>     <span class="at">prob =</span> probs_lasso,</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">resp =</span> appr_c<span class="sc">$</span>y),</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  coupe[<span class="fu">which.max</span>(VP<span class="sc">*</span><span class="dv">57</span> <span class="sc">-</span> FN<span class="sc">*</span><span class="dv">10</span>)])</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>lasso_pred <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(lasso, </span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">newx =</span> <span class="fu">as.matrix</span>(valid_c[,<span class="sc">-</span><span class="fu">ncol</span>(valid_c)]), </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"resp"</span>)) <span class="sc">&gt;</span> lasso_coupe</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>lasso_perfo <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">10</span><span class="sc">*</span><span class="fu">sum</span>(lasso_pred) <span class="sc">+</span> </span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(valid_ymontant[lasso_pred], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Table:</p>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-03-summarylog_81e07a220939403df3aec0785e760583">
<div class="cell-output-display">
<div id="tbl-03-summarylog" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.11:  Résumé des caractéristiques des modèles logistiques avec (a) référence, soit l’envoi sans sélection à tous les clients; (b) 10 variables de base sans sélection; (c) toutes les variables, incluant les termes quadratiques et les interactions d’ordre 2; (d) sélection séquentielle avec AIC (e) sélection séquentielle avec BIC (f) recherche exhaustive avec variables de la procédure séquentielle AIC (sélection selon BIC) (g) LASSO avec pénalité optimale selon le critère de l’aire sous la courbe. Les points de coupure optimaux ont été déterminés par validation-croisée sur l’échantillon d’apprentissage (sauf LASSO), tandis que la performance du modèle (sensibilité et taux de bonne classification) ont été calculés à partir de l’échantillon test de 100 000 individus. </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> modèle </th>
   <th style="text-align:right;"> no. variables </th>
   <th style="text-align:right;"> pt. coupure </th>
   <th style="text-align:right;">  sensibilité </th>
   <th style="text-align:right;"> taux bonne classif. </th>
   <th style="text-align:right;"> profit </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (a) </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.232 </td>
   <td style="text-align:right;"> 601212 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (b) </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.2674 </td>
   <td style="text-align:right;"> 0.366 </td>
   <td style="text-align:right;"> 732102 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (c) </td>
   <td style="text-align:right;"> 104 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.3605 </td>
   <td style="text-align:right;"> 0.595 </td>
   <td style="text-align:right;"> 918055 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (d) </td>
   <td style="text-align:right;"> 28 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.3245 </td>
   <td style="text-align:right;"> 0.52 </td>
   <td style="text-align:right;"> 878598 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (e) </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.2924 </td>
   <td style="text-align:right;"> 0.44 </td>
   <td style="text-align:right;"> 804737 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (f) </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.3009 </td>
   <td style="text-align:right;"> 0.463 </td>
   <td style="text-align:right;"> 826323 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (g) </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.237 </td>
   <td style="text-align:right;"> 0.254 </td>
   <td style="text-align:right;"> 623345 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Nous avons vu plus tôt, qu’avec les 10 variables de base, le meilleur point de coupure est de 0.11. En utilisant cette stratégie sur les 100 000 clients, le revenu net aurait été de 732102 dollars. C’est une énorme amélioration, de plus de 56%, par rapport à la stratégie de référence qui consiste à envoyer le catalogue à tout le monde (revenu net de 601 212$). Si on inclut tous les termes quadratiques et les termes les interactions d’ordre deux (104 variables en tout), le revenu net est inférieur avec une valeur de 918055$. Ici, le modèle est trop complexe et surajusté. Si on fait une sélection de variables (quasi méthodes sont présentées), suivie de la détermination du meilleur point de coupure, on fait alors toujours mieux qu’avec le modèle incluant les 10 variables de base seulement. L’approche la plus rentable parmi celles essayées aurait généré un profit de 918055 avec 104 variables explicatives: il s’agit d’un gain de 25.4% par rapport au modèle avec les 10 variables de base.</p>
</section>
<section id="modèle-heckit" class="level3" data-number="5.3.6">
<h3 data-number="5.3.6" class="anchored" data-anchor-id="modèle-heckit"><span class="header-section-number">5.3.6</span> Modèle Heckit</h3>
<p>Nous venons tout juste d’étudier des stratégies qui consistent essentiellement, à estimer <span class="math inline">\(\Pr(\texttt{yachat}=1)\)</span> et un point de coupure afin de décider à qui envoyer le catalogue en partant du postulat que tous les clients dépensent le même montant; le tout est basé uniquement sur la régression logistique. Le revenu moyen peut être estimé à partir de l’équation <span class="math display">\[\begin{align*}
\mathsf{E}(\texttt{ymontant}) = \mathsf{E}(\texttt{ymontant} \mid \texttt{yachat}=1) \Pr(\texttt{yachat
}=1),
\end{align*}\]</span> c’est-à-dire, la moyenne du montant dépensé est égale à la moyenne du montant dépensé étant donné qu’il y a eu achat, fois la probabilité qu’il ait eu achat. Une autre stratégie possible consiste donc à développer deux modèles : un pour <span class="math inline">\(\mathsf{E}(\texttt{ymontant} \mid \texttt{yachat}=1)\)</span> et un autre pour <span class="math inline">\(\Pr(\texttt{yachat}=1)\)</span> et à les combiner afin d’obtenir des prévisions du montant dépensé.</p>
</section>
<section id="description-du-modèle-heckit" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="description-du-modèle-heckit">Description du modèle Heckit</h3>
<p>Le paragraphe qui suit est plus technique et peut être omis. Il ne serait pas justifié d’ajuster séparément les deux modèles pour <span class="math inline">\(\mathsf{E}(\texttt{ymontant} \mid \texttt{yachat}=1)\)</span> et <span class="math inline">\(\Pr(\texttt{yachat}=1)\)</span> et de calculer les prévisions en prenant le produit: <span class="math inline">\(\mathsf{E}(\texttt{ymontant} \mid \texttt{yachat}=1)\Pr(\texttt{yachat}=1)\)</span>. Cela provient du fait que le modèle pour <span class="math inline">\(\mathsf{E}(\texttt{ymontant} \mid \texttt{yachat}=1)\)</span> aurait été estimé seulement avec les clients qui ont acheté quelque chose et qu’ensuite on l‘appliquerait (au moment de calculer les prévisions) à la fois aux clients qui vont acheter et à ceux qui ne vont pas acheter. Il y a donc un biais de sélection dans l’échantillon qui a servi à ajuster le modèle au départ. Une manière de contourner ce problème est d’ajuster conjointement les deux modèles avec un modèle de Tobit de type 2. Ce dernier est basé sur l’hypothèse que les deux variables observées (<span class="math inline">\(Y_1\)</span> et <span class="math inline">\(Y_2\)</span>) proviennent de deux variables latentes non observées (<span class="math inline">\(Y_1^{\star}\)</span> et <span class="math inline">\(Y_2^{\star}\)</span>), où <span class="math display">\[\begin{align*}
Y_1 = \begin{cases}
1 &amp; \text{ si } Y_1^{\star} \ge 0, \\
0 &amp; \text{ si } Y_1^{\star} &lt; 0,
\end{cases}
\qquad \qquad
Y_2 = \begin{cases}
Y_2^{\star} &amp; \text{ si } Y_1^{\star} \ge 0, \\
0 &amp; \text{ si } Y_1^{\star} &lt; 0.
\end{cases}
\end{align*}\]</span> Dans notre exemple, <span class="math inline">\(Y_1\)</span> correspond à <span class="math inline">\(\texttt{yachat}\)</span> et <span class="math inline">\(Y_2\)</span> à <span class="math inline">\(\texttt{ymontant}\)</span>. Ce qui lie les deux équations est le fait qu’on suppose que les variables sont binormales: les deux termes d’erreur sont de loi normale et sont corrélés, <span class="math inline">\(\boldsymbol{\varepsilon} \sim \mathsf{No}_2(\boldsymbol{0}_2, \boldsymbol{\Sigma})\)</span>. Les variables dépendantes observées sont : <span class="math display">\[\begin{align*}
Y_{1}^{\star} &amp;= \beta_{01} + \beta_{11} \mathrm{X}_{11} + \cdots + \beta_{1p}\mathrm{X}_{p1} + \varepsilon_{1}\\
Y_{2}^{\star} &amp;= \beta_{02} + \beta_{12} \mathrm{X}_{12} + \cdots + \beta_{1p}\mathrm{X}_{q2} + \varepsilon_{2}
\end{align*}\]</span> Notez que les variables explicatives ne sont pas nécessairement les mêmes dans les deux équations. En estimant conjointement les deux équations, on élimine le biais de sélection mentionné plus haut. Le choix des variables doit être fait avant avec les méthodes qu’on a vues. Le modèle Tobit ajuste un modèle probit et non logistique à la variable binaire (la fonction de liaison).</p>
<p>Nous avons déjà développé des modèles de régression linéaire pour <span class="math inline">\(\mathsf{E}(\texttt{ymontant} \mid \texttt{yachat}=1)\)</span> au chapitre précédent et nous venons de développer des modèles de régression logistique pour <span class="math inline">\(\Pr(\texttt{yachat}=1)\)</span> dans ce chapitre. Nous avons donc tous les ingrédients pour implanter cette stratégie.</p>
<p>Nous allons cibler les clients dont la prévision du montant dépensé est plus grande que 10$ (le coût de l’envoi du catalogue).</p>
<p>On pourrait faire une sélection de variables pour chaque modèle: pour faire simple, nous allons sélectionner les variables de la procédure séquentielle et choisir les variables qui donnent le modèle avec le plus petit BIC pour la partie de régression linéaire et la régression logistique.</p>
<p>Pour obtenir les prévisions, nous allons estimer conjointement les modèles pour <span class="math inline">\(\mathsf{E}(\texttt{ymontant} \mid \texttt{yachat}=1)\)</span> et pour <span class="math inline">\(\Pr(\texttt{yachat}=1)\)</span> avec un modèle Tobit de type 2 (aussi appelé modèle Heckit), dont une brève description est donnée à la fin de la section.</p>
<p>L’avantage de l’estimation simultanée est que l’on a pas à sélectionner le point de coupure, puisque l’on enverra le catalogue uniquement si le montant prédit pour <span class="math inline">\(\mathsf{E}(\texttt{ymontant})\)</span> (non-conditionnel) est supérieur à 10$.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/tobit-model_56d1aa70691d3fa2fe937446e932becd">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampleSelection)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>formule_complet <span class="ot">&lt;-</span> <span class="fu">formula</span>(ymontant <span class="sc">~</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>          (x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>             x6 <span class="sc">+</span> x7 <span class="sc">+</span> x8 <span class="sc">+</span> x9 <span class="sc">+</span> x10)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x6<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x7<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">I</span>(x8<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x9<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x10<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>select_modlin <span class="ot">&lt;-</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  MASS<span class="sc">::</span><span class="fu">stepAIC</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> <span class="fu">lm</span>(formule_complet,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> dbm[dbm<span class="sc">$</span>test <span class="sc">==</span> <span class="dv">0</span>,]),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">scope =</span> <span class="fu">formula</span>(ymontant <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="fu">log</span>(<span class="fu">sum</span>(dbm<span class="sc">$</span>test <span class="sc">==</span> <span class="dv">0</span>)),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>fachat <span class="ot">&lt;-</span> <span class="fu">formula</span>(seqBIC)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>fmontant <span class="ot">&lt;-</span> <span class="fu">formula</span>(select_modlin)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>heckit.ml <span class="ot">&lt;-</span> sampleSelection<span class="sc">::</span><span class="fu">heckit</span>(</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">selection =</span> fachat,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> fmontant, </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ml"</span>, </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dbm[dbm<span class="sc">$</span>test <span class="sc">==</span> <span class="dv">0</span>,])</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>sortie_heckit <span class="ot">&lt;-</span> <span class="fu">summary</span>(heckit.ml)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>pred_achat <span class="ot">&lt;-</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(heckit.ml, </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">part =</span> <span class="st">"selection"</span>, </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> dbm[dbm<span class="sc">$</span>test <span class="sc">==</span> <span class="dv">1</span>,], </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">*</span> </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">object =</span> heckit.ml,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">part =</span> <span class="st">"outcome"</span>, </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> dbm[dbm<span class="sc">$</span>test <span class="sc">==</span> <span class="dv">1</span>,])</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Remplacer valeurs manquantes par zéros</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>valid_ymontant[<span class="fu">is.na</span>(valid_ymontant)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># On envoie le catalogue seulement si le montant d'achat prédit est supérieur à 10$</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Revenu total avec cette stratégie</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>heckit_perfo <span class="ot">&lt;-</span> </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(valid_ymontant[<span class="fu">which</span>(pred_achat <span class="sc">&gt;</span> <span class="dv">10</span>)] <span class="sc">-</span> <span class="dv">10</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-03-tobit" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Matrice de gain pour l'envoi de catalogue avec des modèle Tobit de type II: sensibilité, taux de faux positifs et de bonne classification et gain net de la stratégie." data-hash="05-reglogistique_cache/html/tbl-03-tobit_b52e552c6da3e90176b7a3c603c43733">

</div>
<p>Le modèle Heckit aurait produit un revenu net de 10007980$, un montant supérieur au revenu net de 918055$, qui était le meilleur trouvé à la sous-section précédente.</p>
<p>Pour conclure cet exemple, il s’avère donc que la régression logistique permet d’effectuer un bon ciblage des clients potentiels afin de maximiser les revenus. L’approche générale consistant à obtenir des prévisions pour <span class="math inline">\(\Pr(\texttt{yachat}=1)\)</span> et ensuite trouver le meilleur point de coupure est très générale. D’autres types de modèles (arbre de classification, forêt aléatoire, réseau de neurones) pourraient être utilisés à la place de la régression logistique.</p>
<p>Nous reviendrons une dernière fois sur cet exemple dans le chapitre traitant des données manquantes. Nous verrons alors comment procéder si des valeurs manquantes sont présentes dans les variables explicatives.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
En résumé
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>La classification est une forme d’apprentissage supervisée.</li>
<li>On peut assigner l’observation à la classe la plus plausible, ou déterminer un point de coupure.</li>
<li>Si on a un objectif particulier (fonction de gain), on peut optimiser les profits en assignant une importance différente à chaque scénario.</li>
<li>On peut catégoriser les observations dans une matrice de confusion et on peut calculer le taux de bonne classification comme mesure d’adéquation.</li>
<li>Dans le cas binaire, on s’intéresse généralement à
<ul>
<li>la spécificité (proportion d’échecs correctement classifiés)</li>
<li>la sensibilité (proportion de succès correctement classifiés)</li>
<li>le taux de faux positifs ou faux négatifs</li>
</ul></li>
<li>L’aire sous la courbe de la fonction d’efficacité du récepteur (courbe ROC) et le lift donnent une mesure de la qualité des prédictions.</li>
<li>L’erreur quadratique moyenne se réduit à calculer le taux de mauvaise classification, qu’on cherche à minimiser. On peut aussi utiliser la vraisemblance comme fonction objective.</li>
<li>Les outils pour la sélection de variables couverts précédemment (critères d’information, LASSO, estimation de l’erreur par validation externe ou croisée) sont toujours applicables.</li>
<li>Les modèles sont plus coûteux à estimer.</li>
<li>Il y a moins d’information disponible avec une variable cible binaire, d’où une incertitude plus prononcée.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="modèles-pour-données-multinomiales" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="modèles-pour-données-multinomiales"><span class="header-section-number">5.4</span> Modèles pour données multinomiales</h2>
<p>Supposons que la variable <span class="math inline">\(Y\)</span> que vous cherchez à modéliser est une variable catégorielle pouvant prendre trois valeurs ou plus. Voici quelques exemples :</p>
<ul>
<li>Destination de vacances l’année dernière (Québec, États-Unis, ailleurs).</li>
<li>Si les élections avaient lieu aujourd’hui au Québec, pour quel parti voteriez-vous (PLQ, PQ, CAQ, QS).</li>
<li>Combien de fois êtes-vous allé au cinéma l’année dernière: moins de cinq fois (<span class="math inline">\(\texttt{1}\)</span>), entre cinq et 10 fois (<span class="math inline">\(\texttt{2}\)</span>), ou plus de 10 fois (<span class="math inline">\(\texttt{3}\)</span>).</li>
<li>Quelle importance accordez-vous au service après-vente? Un parmi « pas important » (<span class="math inline">\(\texttt{1}\)</span>), « peu important »(<span class="math inline">\(\texttt{2}\)</span>), « moyennement important » (<span class="math inline">\(\texttt{3}\)</span>), « assez important » (<span class="math inline">\(\texttt{4}\)</span>), « très important » (<span class="math inline">\(\texttt{5}\)</span>).</li>
</ul>
<p>Dans les deux premiers exemples, la variable réponse <span class="math inline">\(Y\)</span> est nominale (elle n’a pas d’ordre) alors qu’elle est ordinale dans les deux derniers. Pour une variable ordinale, le modèle logit multinomial peut être utilisé mais il existe d’autres possibilités comme le modèle logit cumulé. Nous couvrirons ces deux modèles.</p>
<section id="régression-logistique-multinomiale" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="régression-logistique-multinomiale"><span class="header-section-number">5.4.1</span> Régression logistique multinomiale</h3>
<p>En régression logistique, <span class="math inline">\(Y\)</span> est une variable binaire qui vaut soit 0, soit 1 et la probabilité de succès est <span class="math display">\[\begin{align*}
\ln\left(\frac{p_i}{1-p_i}\right) &amp;= \beta_0 + \beta_1 \mathrm{X}_{i1} + \cdots + \beta_p\mathrm{X}_{ip},\\p_i &amp;= \Pr(Y_i=1 \mid \mathrm{X}_i) = \textrm{expit}(\eta_i).
\end{align*}\]</span> Dans ce modèle logistique, <span class="math display">\[\begin{align*}\ln\left(\frac{p_i}{1-p_i}\right) = \ln\{\Pr(Y_i=1 \mid \mathrm{X}_i)\} -  \ln\{\Pr(Y_i=0 \mid \mathrm{X}_i)\}
\end{align*}\]</span> peut être vu comme étant le logit de la catégorie 1 en utilisant 0 comme catégorie de référence. Le modèle logistique multinomial procède de même en fixant une catégorie de référence et en modélisant le logit de chacune des autres catégories par rapport à la catégorie de référence. Avec <span class="math inline">\(K\)</span> catégories (<span class="math inline">\(k = 1, \ldots, K\)</span>) et en choisissant la catégorie 1 comme référence, le modèle devient <span class="math display">\[\begin{align*}
\ln\left(\frac{p_{ij}}{p_{i1}}\right) = \eta_{ij} = \beta_{0j} + \beta_{1j} \mathrm{X}_{i1} + \cdots + \beta_{pj}\mathrm{X}_{ip}, \quad (j=2, \ldots, K)
\end{align*}\]</span> où <span class="math inline">\(p_{ik} = \Pr(Y_i=k \mid \mathrm{X}_i)\)</span> <span class="math inline">\((k=1, \ldots, K)\)</span>. Comme en régression logistique, on peut facilement exprimer ce modèle en termes des différentes probabilités, <span class="math display">\[\begin{align*}
p_{i1} &amp;= \Pr(Y_i=1 \mid \mathrm{X}_i) = \frac{1}{1+ \sum_{j=2}^K\exp(\eta_{ij})}\\
p_{ik} &amp;= \Pr(Y_i=k \mid \mathrm{X}_i) = \frac{\exp(\eta_{ik})}{1+ \sum_{j=2}^K\exp(\eta_{ij})}, \qquad k=2, \ldots, K.
\end{align*}\]</span> On voit facilement que la somme des probabilités égale 1, c’est-à-dire <span class="math inline">\(p_{i1} + \cdots + p_{iK} = 1\)</span>, ce qui fait que connaître la probabilité de <span class="math inline">\(K-1\)</span> des catégories nous permet de déduire la dernière. En fait, le modèle logit multinomial ne fait que combiner plusieurs logit dans un seul modèle. L’interprétation des paramètres se fait comme en régression logistique sauf qu’il faut y aller équation par équation.</p>
<p>L’exemple qui suit traite du taux de participation lors des élections américaines et des facteurs expliquant qu’un électeur ou une électrice se prévaut de son droit de vote, ainsi que la fréquence de participation. Les <a href="https://github.com/fivethirtyeight/data/tree/master/non-voters">données</a> sont tirées d’un sondage Ipsos réalisé pour le site de nouvelles <em>FiveThirtyEight</em>. Les données sont accompagnées de pondérations provenant du recensement permettant de corriger la représentativité du sondage et de refléter l’électorat américain dans sa globalité.</p>
<p>La base de données <code>vote</code> contient 5837 observations obtenues par voie de sondage. Nous allons modéliser l’intention de vote, <code>catvote</code> à l’aide d’une régression logistique multinomiale.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-multinom_means-Ipsos_1cf9d9a63c6649b3fddd21bfe761804a">
<div class="cell-output-display">
<div id="fig-multinom_means-Ipsos" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-multinom_means-Ipsos-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.8: Proportion des modalités des variables sociodémographiques des données de participation électorale.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>On voit que les personnes plus fortunées, plus éduquées, plus âgées et celles qui s’associent à un parti politique principal (Républicains et Démocrates), votent davantage. L’écart selon l’âge est particulièrement édifiant, avec près de 50% des jeunes qui n’ont pas participé. Il faut garder en tête que le revenu, l’âge et le niveau d’éducation sont fortement associés et que les personnes plus jeunes ont eu moins d’occasions de voter (ce qui pourrait expliquer la plus grande propension pour les catégories de vote).</p>
<p>Une étude plus attentive révèle que la distribution conditionnelle de ceux qui votent toujours est bimodale. La <a href="#fig-vote-age">Figure&nbsp;<span>5.9</span></a> montre clairement que les très jeunes et les personnes âgées en font partie. Ainsi, le modèle est potentiellement mal spécifié car le vrai effet de l’âge n’est visiblement pas linéaire au niveau du log de la cote. Cela dit, les primovotant(e)s n’ont souvent eu qu’une seule occasion de voter, ce qui peut expliquer le comportement sur le graphique et l’absence de réponses pour occasionnellement. Pour éviter cet artefact, on considère les personnes de plus de 30 ans uniquement.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-vote-age_102742c6f3fa6bb37736fd1d86cfe3e0">
<div class="cell-output-display">
<div id="fig-vote-age" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-vote-age-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.9: Fréquence de vote selon l’âge.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Pour le modèle logit multinomial, nous allons prendre <code>rarement/jamais</code> comme catégorie de référence pour la variable réponse <code>catvote</code>. Notez qu’il est d’usage et préférable, pour réduire le risque de problèmes numériques et accélérer l’optimisation, de centrer et réduire les variables explicatives.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/mullogit_6150129a5c5584bb01ae3a0560550052">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(vote, <span class="at">package =</span> <span class="st">"hecmulti"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Modèle multinomial</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>multi1 <span class="ot">&lt;-</span> nnet<span class="sc">::</span><span class="fu">multinom</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  catvote <span class="sc">~</span> <span class="fu">scale</span>(age, <span class="at">scale =</span> <span class="cn">FALSE</span>), <span class="co"># centrer</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vote, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> age <span class="sc">&gt;</span> <span class="dv">30</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> poids,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hess =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">FALSE</span>) </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau résumé de l'ajustement</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(multi1)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimations des coefficients</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(multi1)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalles de confiance (Wald)</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(multi1)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Critères d'information</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(multi1)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(multi1)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Prédictions: probabilité de chaque scénario</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(multi1, <span class="at">type =</span> <span class="st">"probs"</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Prédictions: classe la plus susceptible</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(multi1, <span class="at">type =</span> <span class="st">"class"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-multinom-coefs" class="cell tbl-parent quarto-layout-panel anchored" data-hash="05-reglogistique_cache/html/tbl-multinom-coefs_5f9ed6b4a1d09cb3808a9a577b54ea2c">
<div class="panel-caption table-caption">
<p>Tableau&nbsp;5.12: Estimation des coefficients et intervalles de confiance à 95 pourcent pour le modèle multinomial logistique avec les données de vote.</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-multinom-coefs-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-multinom-coefs" style="flex-basis: 100.0%;justify-content: center;">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>(a)  catégorie rarement/jamais vs toujours</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> coefficient </th>
   <th style="text-align:right;"> IC (2.5%) </th>
   <th style="text-align:right;"> IC (97.5%) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> cst </td>
   <td style="text-align:right;"> 0.783 </td>
   <td style="text-align:right;"> 0.709 </td>
   <td style="text-align:right;"> 0.858 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age </td>
   <td style="text-align:right;"> 0.031 </td>
   <td style="text-align:right;"> 0.025 </td>
   <td style="text-align:right;"> 0.036 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-multinom-coefs-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-multinom-coefs" style="flex-basis: 100.0%;justify-content: center;">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>(b) catégorie occasionnellement vs toujours</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> coefficient </th>
   <th style="text-align:right;"> IC (2.5%) </th>
   <th style="text-align:right;"> IC (97.5%) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> cst </td>
   <td style="text-align:right;"> -0.128 </td>
   <td style="text-align:right;"> -0.224 </td>
   <td style="text-align:right;"> -0.032 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age </td>
   <td style="text-align:right;"> 0.082 </td>
   <td style="text-align:right;"> 0.075 </td>
   <td style="text-align:right;"> 0.089 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Comme il y a trois catégories pour la variable dépendante, il y a deux équations pour le modèle ajusté. En regardant les coefficients dans le <a href="#tbl-multinom-coefs">Tableau&nbsp;<span>5.12</span></a>, on obtient: <span class="math display">\[\begin{align*}
\ln \left\{\frac{\Pr(\texttt{catvote}_{1i}= \texttt{occasionnellement}\mid \texttt{age}_i)}{\Pr(\texttt{catvote}_{1i} = \texttt{rarement/jamais} \mid \texttt{age}_i)} \right\} &amp;=
0.783 +
0.031 \texttt{age}_i, \\
\ln \left\{\frac{\Pr(\texttt{catvote}_{1i}= \texttt{toujours}\mid \texttt{age}_i)}{\Pr(\texttt{catvote}_{1i}= \texttt{rarement/jamais}  \mid \texttt{age}_i)} \right\} &amp;=
-0.128 + 0.082\texttt{age}_i.
\end{align*}\]</span></p>
<p>Plus l’âge du répondant augmente, plus la probabilité que la personne votre toujours augmente. Ainsi, la cote moyenne pour toujours versus la référence rarement/jamais est multipliée par <span class="math inline">\(1.031=\exp(0.031)\)</span> pour chaque année de plus. Pour faire simple, on a employé une seule variable explicative, mais il est clair au vu de l’analyse exploratoire que d’autres variables sont utiles pour comprendre le comportement des électeurs et électrices. Qui est plus, la taille de la base de données nous permettrait de mesurer d’autres effets.</p>
<p>On peut comparer les modèles emboîtés à l’aide de tests de rapport de vraisemblance.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/lrt-test_698e5ccd212d00a1ff9bb941ad29631d">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuster modèle sous H0: les</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># prédictions correspondent à la</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion empirique de chaque catégorie</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>multi0 <span class="ot">&lt;-</span> nnet<span class="sc">::</span><span class="fu">multinom</span>(catvote <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">weights =</span> poids,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> vote,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">subset =</span> age <span class="sc">&gt;</span> <span class="dv">30</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de rapport de vraisemblance</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(multi0, multi1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-anova-multinom_3976e4e30bd8a345bf16f247e2b079de">
<div class="cell-output-display">
<div id="tbl-anova-multinom" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.13:  Analyse de déviance: test du rapport de vraisemblance pour la variable explicative dans le modèle multinomial logistique. </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> modèle </th>
   <th style="text-align:right;"> DL </th>
   <th style="text-align:right;"> déviance </th>
   <th style="text-align:right;"> DL </th>
   <th style="text-align:right;"> rapport vrais. </th>
   <th style="text-align:left;"> valeur-p </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> cst </td>
   <td style="text-align:right;"> 9692 </td>
   <td style="text-align:right;"> 9781.07 </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age </td>
   <td style="text-align:right;"> 9690 </td>
   <td style="text-align:right;"> 9077.63 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 703.44 </td>
   <td style="text-align:left;"> &lt; 0.0001 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Cette valeur est donnée dans la dernière colonne du tableau. De plus, cet effet est significatif car la valeur-<span class="math inline">\(p\)</span> est inférieure à <span class="math inline">\(10^{-4}\)</span>.</p>
<p>Pour une comparaison directe entre les deux autres catégories, <code>rarement/jamais</code> et <code>occasionnellement</code>, il suffit de changer la catégorie de référence.</p>
</section>
<section id="régression-logistique-cumulative-à-cotes-proportionnelles" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="régression-logistique-cumulative-à-cotes-proportionnelles"><span class="header-section-number">5.4.2</span> Régression logistique cumulative à cotes proportionnelles</h3>
<p>Si les modalités de la réponse sont ordinales, la régression logistique multinomiale est toujours appropriée. Il peut néanmoins être préférable d’utiliser un modèle qui utilise l’ordre des modalités pour obtenir un modèle plus facile à interpréter et plus parcimonieux. Le modèle de régression logistique cumulative à cotes proportionnelles <span class="citation" data-cites="McCullagh:1980">(<a href="#ref-McCullagh:1980" role="doc-biblioref">McCullagh 1980</a>)</span> est une simplification du modèle multinomial sous l’hypothèse que les rapports de cotes sont les mêmes peut importe la catégorie.</p>
<p>Supposons que les <span class="math inline">\(K\)</span> modalités de la variable <strong>ordinale</strong> <span class="math inline">\(Y\)</span> sont en ordre croissant (<span class="math inline">\(1 \leq \cdots \leq K\)</span>) et que l’on dispose de <span class="math inline">\(p\)</span> variables explicatives <span class="math inline">\(\mathrm{X}_1, \ldots, \mathrm{X}_p\)</span> pour chaque observation.</p>
<p>Soit <span class="math inline">\(p_{ik}=\Pr(Y_i=k \mid \mathbf{X}_{i})\)</span> (<span class="math inline">\(k=1, \ldots, K\)</span>) la probabilité que <span class="math inline">\(Y_{i}\)</span> prenne la valeur <span class="math inline">\(k\)</span>. On dénote <span class="math display">\[\begin{align*}
S_{ij}=\sum_{k=j}^K p_{ik}= \Pr(Y_{i} &gt; j - 1 \mid \mathbf{X}_{i}), \qquad j=2, \ldots, K.
\end{align*}\]</span> La quantité <span class="math inline">\(S_{ij}\)</span> est la probabilité que <span class="math inline">\(Y_i\)</span> soit plus grand ou égal à <span class="math inline">\(j\)</span>; <span class="math inline">\(S_{i1}\)</span> est égal à 1 et <span class="math inline">\(S_{iK} = \Pr(Y_i=K \mid \mathbf{X}_{i})=p_{iK}\)</span>.</p>
<p>Le modèle logistique cumulé spécifie que <span class="math display">\[\begin{align*}
\ln \left( \frac{S_{ij}}{1-S_{ij}}\right) = \beta_{0j} + \beta_1 \mathrm{X}_{i1} + \cdots + \beta_p \mathrm{X}_{ip}, \qquad \qquad  j=2, \ldots, K.
\end{align*}\]</span></p>
<p>Comme pour le modèle multinomial logistique, il y a <span class="math inline">\(K-1\)</span> équations pour le rapport de cote. En revanche, si l’ordonnée à l’origine change d’une équation à l’autre, les paramètres quantifiant les effets des variables explicatives, <span class="math inline">\(\beta_1, \ldots, \beta_p\)</span> sont les mêmes pour chacune des cotes. Par conséquent, pour modéliser une variable ordinale <span class="math inline">\(Y\)</span> ayant <span class="math inline">\(K\)</span> valeurs possibles et avec <span class="math inline">\(p\)</span> variables explicatives, le modèle cumulatif logistique utilise <span class="math inline">\(p + K - 1\)</span> paramètres. Le modèle logit multinomial, qui peut également être utilisé pour les données ordinales, utilise plutôt <span class="math inline">\((K-1) \cdot(p+1)\)</span> paramètres. Le modèle logistique cumulatif à cotes proportionnelles est donc plus parcimonieux et, pour autant qu’il soit approprié, mènera à des estimations des paramètres plus précises qu’avec le modèle de régression logistique multinomiale. Les deux modèles sont identiques au modèle de régression logistique si la variable ordinale a uniquement deux modalités (variable binaire).</p>
<p>La cote <span class="math inline">\(S_{ij}/(1-S_{ij})\)</span> mesure à quel point il est plus probable que <span class="math inline">\(Y_i\)</span> prenne une valeur plus grande ou égale à <span class="math inline">\(j\)</span> par rapport à une valeur plus petite que <span class="math inline">\(j\)</span>, viz. <span class="math display">\[\begin{align*}
\frac{S_{ij}}{1-S_{ij}} = \exp( \beta_{0j} + \beta_1\mathrm{X}_{i1} + \cdots + \beta_p \mathrm{X}_{ip}).
\end{align*}\]</span> Dans cet exemple, nous n’avons aucune transformation des variables explicatives, ni aucune interaction dans le modèle; l’interprétation des paramètres est donc simplifiée. Si le paramètre <span class="math inline">\(\beta_j\)</span> est positif, cela indique que plus <span class="math inline">\(\mathrm{X}_j\)</span> prend une valeur élevée, plus la variable <span class="math inline">\(Y\)</span> a tendance à prendre aussi une valeur élevée. Inversement, si le paramètre <span class="math inline">\(\beta_j\)</span> est négatif, cela indique que plus <span class="math inline">\(\mathrm{X}_j\)</span> prend une valeur élevée, plus la variable <span class="math inline">\(Y\)</span> a tendance à prendre une valeur basse. Plus précisément, pour chaque augmentation d’une unité de <span class="math inline">\(\mathrm{X}_j\)</span>, la cote <span class="math inline">\(S_k\)</span> versus <span class="math inline">\((1-S_k)\)</span> est multipliée par <span class="math inline">\(\exp(\beta_j)\)</span>, peu importe la valeur de <span class="math inline">\(Y\)</span>. En terme de probabilités cumulées d’excéder <span class="math inline">\(k\)</span>, <span class="math display">\[\begin{align*}
S_{ik} &amp;= \Pr(Y_i \geq k \mid \mathbf{X}_{i})
\\&amp; = \textrm{expit}(\beta_{0k} + \beta_1 \mathrm{X}_{i1} + \cdots + \beta_p \mathrm{X}_{ip}), \qquad j =2, \ldots, K.
\end{align*}\]</span> En utilisant ces expressions, on peut obtenir la probabilité de chaque catégorie, <span class="math display">\[\begin{align*}
&amp;\Pr(Y_i = k \mid \mathbf{X}_{i}) \\&amp;\quad=\Pr(Y_i \geq k \mid \mathbf{X}_{i}) -\Pr(Y_i \geq k+1 \mid \mathbf{X}_{i}) \\&amp;\quad= S_{k} - S_{k+1}.
\end{align*}\]</span></p>
<p>On peut répéter le même modèle que précédemment, même s’il est peu susceptible que l’hypothèse de cotes proportionnelles soit valide. La variable réponse doit être de classe <code>ordered</code>, une forme particulière de facteur dont les niveaux sont ordonnés en ordre croissant. On ajuste un modèle, cette fois avec sexe pour nous permettre de pratiquer l’interprétation d’une variable catégorielle.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/ordinal-logistique_8507a074d061c3f08c42f17aa9ecc821">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modèle de régression logistique </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># multinomiale ordinale à cote proportionnelle</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(vote, <span class="fu">is.ordered</span>(catvote))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>multi2a <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">polr</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  catvote <span class="sc">~</span> sexe, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vote, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> age <span class="sc">&gt;</span> <span class="dv">30</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> poids,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"logistic"</span>, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hess =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>multi2b <span class="ot">&lt;-</span> nnet<span class="sc">::</span><span class="fu">multinom</span>(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  catvote <span class="sc">~</span> sexe, </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vote,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> age <span class="sc">&gt;</span> <span class="dv">30</span>, </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> poids,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hess =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Le modèle est paramétré en terme</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  du rapport de cote, ascendant</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(multi2a)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Test du rapport de vraisemblance pour </span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># modèle à cote proportionnelle</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># deviance = -2*ll</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="fu">deviance</span>(multi2a) <span class="sc">-</span> <span class="fu">deviance</span>(multi2b),</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">df =</span> <span class="fu">length</span>(<span class="fu">coef</span>(multi2a)), </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalles de confiance pour beta_x</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co">#  - vraisemblance profilée</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(multi2a)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Critères d'information</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(multi2a)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(multi2a)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau des coefficients </span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordonnées à l'origine:</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>multi2a<span class="sc">$</span>zeta</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Uniquement pour variables explicatives</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co"># exp(beta) avec l'IC de vraisemblance profilée</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">c</span>(<span class="fu">coef</span>(multi2a), <span class="fu">confint</span>(multi2a)))</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut obtenir les intervalles de Wald </span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co"># avec confint.default</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Test d'adéquation </span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="co"># (rapport de vraisemblance, comparaison avec modèle saturé)</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="at">q =</span> <span class="fu">deviance</span>(multi2a),</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">df =</span> <span class="fu">df.residual</span>(multi2a),</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Petite valeur-p = modèle inadéquat</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="05-reglogistique_cache/html/tbl-ordered-logistic_c2c9914d58658e3273a6cdac058ebb1d">
<div class="cell-output-display">
<div id="tbl-ordered-logistic" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau&nbsp;5.14:  Tableau des estimations des coefficients du modèle pour réponses ordinales pour la régression logistique à cotes proportionnelles avec sexe. </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> effet </th>
   <th style="text-align:right;"> coefficient </th>
   <th style="text-align:right;"> erreur-type </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> sexe [homme] </td>
   <td style="text-align:right;"> -0.166 </td>
   <td style="text-align:right;"> 0.055 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cst [rarement/jamais|occasionnellement] </td>
   <td style="text-align:right;"> -1.297 </td>
   <td style="text-align:right;"> 0.044 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> cst [occasionnellement|toujours] </td>
   <td style="text-align:right;"> 0.865 </td>
   <td style="text-align:right;"> 0.041 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Ici, l’effet estimé d’être un homme plutôt qu’une femme (<code>sexe</code>) est <span class="math inline">\(-0.166\)</span> et ce paramètre est significativement différent de zéro (valeur-<span class="math inline">\(p\)</span> de <span class="math inline">\(0.003\)</span> obtenue en faisant un test de rapport de vraisemblance).</p>
<p>Ainsi, les hommes sont moins susceptibles de voter fréquemment que les femmes. Plus précisément, la cote d’être dans une catégorie plus élevée de <code>catvote</code>, par rapport à une catégorie plus basse, est multipliée par <span class="math inline">\(\exp(-0.166 = 0.847\)</span>, ce qui correspond à une diminution de la cote des femmes <span class="math inline">\(15\)</span>% (et donc la probabilité d’être dans une catégorie plus élevée est plus faible).</p>
<p>Avant toute chose, il faut s’assurer que le modèle est approprié. Rappelez-vous que l’une des hypothèses de ce modèle est que les effets des variables explicatives sont les mêmes pour chaque équation.</p>
<ul>
<li><span class="math inline">\(\mathscr{H}_0\)</span> : l’effet de chaque variable est le même pour les <span class="math inline">\(K\)</span> logit du modèle multinomial logistique, soit <span class="math inline">\(\beta_{11} = \cdots =\beta_{1K}\)</span>, <span class="math inline">\(\ldots\)</span>, <span class="math inline">\(\beta_{p1} = \cdots =\beta_{pK}\)</span>.</li>
</ul>
<p>Une très petite valeur-<span class="math inline">\(p\)</span> (rejet de <span class="math inline">\(\mathscr{H}_0\)</span>) pour ce test serait une indication que le modèle de régression multinomiale ordinale n’est pas approprié et que le modèle multinomial logistique serait préférable. Comme la valeur-<span class="math inline">\(p\)</span> est négligeable, on rejette pas <span class="math inline">\(\mathscr{H}_0\)</span> et l’hypothèse de cote proportionnelle ne tient pas la route.</p>
<div class="cell" data-hash="05-reglogistique_cache/html/fig-predmultinom_f1380e6aabfaefb042096522ec261bde">
<div class="cell-output-display">
<div id="fig-predmultinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="05-reglogistique_files/figure-html/fig-predmultinom-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.10: Probabilités prédites pour chaque modalité selon le modèle de régression multinomiale logistique et le modèle de régression ordinales à cotes proportionnelles selon l’âge.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>On a précédemment utilisé un test du rapport de vraisemblance pour valider l’hypothèse des cotes proportionnelles: il n’y avait aucune indication que la simplification n’était pas adéquate. Ce n’est pas le cas pour le modèle qui ne contient que la variable <code>age</code> ou plusieurs variables explicatives: la <a href="#fig-predmultinom">Figure&nbsp;<span>5.10</span></a> montre les différences de probabilités ajustées pour les deux modèles qui incluent uniquement l’âge comme variable explicative. Règle générale, on n’ajustera jamais un modèle avec une seule des variables: un test du rapport de vraisemblance indique que <strong>toutes</strong> les variables explicatives sont utiles pour expliquer le comportement.</p>
<p>On peut également vérifier si le modèle est adéquat pour décrire les données en comparant le modèle pour les données ordinales avec un modèle saturé (qui contient autant de paramètres que d’observations/niveaux): la valeur-<span class="math inline">\(p\)</span>, infime, indique que le modèle plus complexe, soit le modèle saturé, est préférable. Cela nous indique que le modèle a un piètre pouvoir explicatif.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
En résumé
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>La régression multinomiale logistique pour une variable catégorielle à <span class="math inline">\(K\)</span> niveaux est une extension directe de la régression logistique pour données binaires: il y a <span class="math inline">\(K-1\)</span> équations de cote en termes des variables explicatives (puisque la somme des probabilités vaut 1), donc le nombre de paramètres croît rapidement.</li>
<li>Le modèle est multiplicatif: la cote de catégorie <span class="math inline">\(k\)</span> vs référence est multipliée par <span class="math inline">\(\exp(\beta_{jk})\)</span> pour chaque augmentation de <span class="math inline">\(\mathrm{X}_j\)</span> d’une unité.</li>
<li>Les coefficients manquants de la sortie du tableau peuvent être déduits par des manipulations algébriques.</li>
<li>Le modèle cumulatif à cote proportionnelle est une simplification du modèle multinomial pour des données ordinales.</li>
<li>On suppose que l’effet des variables est le même pour la cote de la survie de chaque modalité</li>
<li>Le modèle à cotes proportionnelles a moins de paramètres, mais le postulat de cotes proportionnelles doit être vérifié (via un test de rapport de vraisemblance ou un test du score).</li>
</ul>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-McCullagh:1980" class="csl-entry" role="doc-biblioentry">
McCullagh, Peter. 1980. <span>“Regression Models for Ordinal Data.”</span> <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 42 (2): 109–27. <a href="https://doi.org/10.1111/j.2517-6161.1980.tb01109.x">https://doi.org/10.1111/j.2517-6161.1980.tb01109.x</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04-selectionmodeles.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Sélection de variables et de modèles</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-survie.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyse de survie</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Tous droits réservés (Denis Larocque, Léo Belzile)</div>
  </div>
</footer>



</body></html>