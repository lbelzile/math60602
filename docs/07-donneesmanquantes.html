<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="MATH 60602 - Analyse multidimensionnelle appliquée, HEC Montréal.">

<title>MATH 60602 - Analyse multidimensionnelle appliquée - 7&nbsp; Données manquantes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-survie.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Données manquantes</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MATH 60602 - Analyse multidimensionnelle appliquée</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/lbelzile/math60602/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./MATH-60602---Analyse-multidimensionnelle-appliquée.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./MATH-60602---Analyse-multidimensionnelle-appliquée.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-analyseexploratoire.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Analyse exploratoire</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-analysefactorielle.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Réduction de la dimension</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-selectionmodeles.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Sélection de variables et de modèles</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-reglogistique.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Régression logistique</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-survie.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyse de survie</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-donneesmanquantes.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Données manquantes</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table des matières</h2>
   
  <ul>
  <li><a href="#principes-de-base" id="toc-principes-de-base" class="nav-link active" data-scroll-target="#principes-de-base"> <span class="header-section-number">7.1</span> Principes de base</a></li>
  <li><a href="#méthodes-dimputation" id="toc-méthodes-dimputation" class="nav-link" data-scroll-target="#méthodes-dimputation"> <span class="header-section-number">7.2</span> Méthodes d’imputation</a>
  <ul class="collapse">
  <li><a href="#cas-complets" id="toc-cas-complets" class="nav-link" data-scroll-target="#cas-complets"> <span class="header-section-number">7.2.1</span> Cas complets</a></li>
  <li><a href="#imputation-simple" id="toc-imputation-simple" class="nav-link" data-scroll-target="#imputation-simple"> <span class="header-section-number">7.2.2</span> Imputation simple</a></li>
  <li><a href="#imputation-multiple" id="toc-imputation-multiple" class="nav-link" data-scroll-target="#imputation-multiple"> <span class="header-section-number">7.2.3</span> Imputation multiple</a></li>
  </ul></li>
  <li><a href="#example-dapplication-de-limputation" id="toc-example-dapplication-de-limputation" class="nav-link" data-scroll-target="#example-dapplication-de-limputation"> <span class="header-section-number">7.3</span> Example d’application de l’imputation</a></li>
  <li><a href="#valeurs-manquantes-dans-un-contexte-de-prédiction" id="toc-valeurs-manquantes-dans-un-contexte-de-prédiction" class="nav-link" data-scroll-target="#valeurs-manquantes-dans-un-contexte-de-prédiction"> <span class="header-section-number">7.4</span> Valeurs manquantes dans un contexte de prédiction</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/lbelzile/math60602/edit/master/07-donneesmanquantes.qmd" class="toc-action">Éditer cette page</a></p></div></div></nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="donnees-manquantes" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Données manquantes</span></span></h1>
</div>

<div>
  <div class="description">
    <p>MATH 60602 - Analyse multidimensionnelle appliquée, HEC Montréal.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Il arrive fréquemment d’avoir des valeurs manquantes dans notre échantillon. Ces valeurs peuvent être manquantes pour diverses raisons. Si on prélève nous-mêmes nos données, un répondant peut refuser de répondre à certaines questions. Si on acquiert nos données d’une source externe, les valeurs de certaines variables peuvent être manquantes directement dans le fichier obtenu. Si on ne prend pas en compte le méchanisme générant les valeurs manquantes, ces dernières peuvent également biaiser nos analyses. Le but de ce chapitre est de faire un bref survol de ce sujet.</p>
<section id="principes-de-base" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="principes-de-base"><span class="header-section-number">7.1</span> Principes de base</h2>
<p>Soit <span class="math inline">\(X\)</span> une variable pour laquelle des données sont manquantes. Voici la définition de trois processus de génération de données manquantes.</p>
<ol type="1">
<li>Les données manquantes de <span class="math inline">\(X\)</span> sont dites <strong>manquantes de façon complètement aléatoire</strong> (MCAR, de l’anglais <em>missing completely at random</em>) si la probabilité que la valeur de <span class="math inline">\(X\)</span> soit manquante ne dépend ni de la valeur de <span class="math inline">\(X\)</span> (qui n’est pas observée), ni des valeurs des autres variables.</li>
</ol>
<p>Le fait qu’une variable est manquante peut être relié au fait qu’une autre soit manquante. Des gens peuvent refuser systématiquement de répondre à deux questions dans un sondage. Dans ce cas, si la probabilité qu’une personne ne réponde pas ne dépend pas des valeurs de ces variables (et de toutes les autres), nous sommes encore dans le cas MCAR. Si par contre, la probabilité que les gens ne répondent pas à une question sur leur revenu augmente avec la valeur de ce revenu, alors nous ne sommes plus dans le cas MCAR.</p>
<p>Le cas MCAR peut se présenter par exemple si des questionnaires, ou des pages ont été égarés ou détruits par inadvertance (effacées du disque rigide, etc.) Si les questionnaires manquants constituent un sous-ensemble choisi au hasard de tous les questionnaires, alors le processus est MCAR. L’hypothèse que les données manquantes sont complètement aléatoires est en général considérée comme trop restrictive.</p>
<ol start="2" type="1">
<li>Les données manquantes de <span class="math inline">\(X\)</span> sont dites <strong>données manquantes de façon aléatoire</strong> (MAR, de l’anglais <em>missing at random</em>) si la probabilité que la valeur de <span class="math inline">\(X\)</span> soit manquante ne dépend pas de la valeur de <span class="math inline">\(X\)</span> (qui n’est pas observée) une fois qu’on a contrôlé pour les autres variables.</li>
</ol>
<p>Il est possible par exemple que les femmes refusent plus souvent que les hommes de répondre à une question (et donc, le processus n’est pas MCAR). Si pour les femmes, la probabilité que <span class="math inline">\(X\)</span> est manquante ne dépend pas de la valeur de <span class="math inline">\(X\)</span> et que pour les hommes, la probabilité que <span class="math inline">\(X\)</span> est manquante ne dépend pas de la valeur de <span class="math inline">\(X\)</span>, alors le processus est MAR. Les probabilités d’avoir une valeur manquante sont différentes pour les hommes et les femmes mais cette probabilité ne dépend pas de la valeur de <span class="math inline">\(X\)</span> elle-même. L’hypothèse MAR est donc plus faible que l’hypothèse MCAR.</p>
<ol start="3" type="1">
<li>Les données manquantes de <span class="math inline">\(X\)</span> sont dites <strong>manquantes de façon non-aléatoire</strong> (MNAR, de l’anglais <em>missing not at random</em>) si la probabilité que la valeur de <span class="math inline">\(X\)</span> soit manquante dépend de la valeur de <span class="math inline">\(X\)</span> elle-même.</li>
</ol>
<p>Par exemple, les gens qui ont un revenu élevé pourraient avoir plus de réticences à répondre à une question sur leur revenu. La méthode de traitement que nous allons voir dans ce chapitre, l’imputation multiple, est très générale et est valide dans le cas MAR (et donc aussi dans le cas MCAR). Le cas MNAR est beaucoup plus difficile à traiter et ne sera pas considéré ici.</p>
</section>
<section id="méthodes-dimputation" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="méthodes-dimputation"><span class="header-section-number">7.2</span> Méthodes d’imputation</h2>
<section id="cas-complets" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="cas-complets"><span class="header-section-number">7.2.1</span> Cas complets</h3>
<p>La première idée naïve pour une analyse est de retirer les observations avec données manquantes pour conserver les cas complets (<em>listwise deletion</em>, ou <em>complete case analysis</em>).</p>
<p>Cette méthode consiste à garder seulement les observations qui n’ont aucune valeur manquante pour les variables utilisées dans l’analyse demandée. Dès qu’une variable est manquante, on enlève le sujet au complet. C’est la méthode utilisée par défaut dans la plupart des logiciels, dont <strong>R</strong>.</p>
<ul>
<li>Si le processus est MCAR, cette méthode est valide car l’échantillon utilisé est vraiment un sous-échantillon aléatoire de l’échantillon original. Par contre, ce n’est pas nécessairement la meilleure solution car on perd de la précision en utilisant moins d’observations.</li>
<li>Si le processus est seulement MAR ou MNAR, cette méthode produit généralement des estimations biaisées des paramètres.</li>
</ul>
<p>En général, l’approche des cas complet est la première étape d’une analyse afin d’obtenir des estimés initiaux que nous corrigerons pas d’autre méthode. Elle n’est vraiment utile que si la proportion d’observations manquantes est très faible et le processus est MCAR. Évidemment, la présence de valeurs manquantes mène à une diminution de la précision des estimateurs (caractérisée par une augmentation des erreurs-types) et à une plus faible puissance pour les tests d’hypothèse et donc ignorer l’information partielle (si seulement certaines valeurs des variables explicatives sont manquantes) est sous-optimal.</p>
</section>
<section id="imputation-simple" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="imputation-simple"><span class="header-section-number">7.2.2</span> Imputation simple</h3>
<p>La deuxième approche est l’<strong>imputation simple</strong>. L’idée ici est de ne pas enlever les observations avec des valeurs manquantes mais de remplacer ces valeurs par des valeurs raisonnables. Par exemple, on peut remplacer les valeurs manquantes d’une variable par la moyenne de cette variable dans notre échantillon. On peut aussi ajuster un modèle de régression avec cette variable comme variable dépendante et d’autres variables explicatives comme variables indépendantes et utiliser les valeurs prédites comme remplacement. Une fois que les valeurs manquantes ont été remplacées, on fait l’analyse avec toutes les observations.</p>
<p>Il existe d’autres façons d’imputer les valeurs manquantes mais le problème de toutes ces approches est que l’on ne tient pas compte du fait que des valeurs ont été remplacées et on fait comme si c’était de vraies observations. Cela va en général sous-évaluer la variabilité dans les données. Par conséquent, les écarts-type des paramètres estimés seront en général sous-estimés et l’inférence (tests et intervalles de confiance) ne sera pas valide. Cette approche n’est donc <strong>pas recommandée</strong>.</p>
<p>Une manière de tenter de reproduire correctement la variabilité dans les données consiste à ajouter un terme aléatoire dans l’imputation. C’est ce que fait la méthode suivante, qui possédera l’avantage de corriger automatiquement les écarts-type des paramètres estimés.</p>
</section>
<section id="imputation-multiple" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="imputation-multiple"><span class="header-section-number">7.2.3</span> Imputation multiple</h3>
<p>Cette méthode peut être appliquée dans à peu près n’importe quelle situation et permet d’ajuster les écarts-type des paramètres estimés. Elle peut être appliquée lorsque le processus est MAR (et donc aussi MCAR).</p>
<p>L’idée consiste à procéder à une imputation aléatoire, selon une certaine technique, pour obtenir un échantillon complet et à ajuster le modèle d’intérêt avec cet échantillon. On répète ce processus plusieurs fois et on combine les résultats obtenus.</p>
<p>L’estimation finale des paramètres du modèle est alors simplement la moyenne des estimations pour les différentes répétitions et on peut également obtenir une estimation des écarts-type des paramètres qui tient compte du processus d’imputation.</p>
<p>Plus précisément, supposons qu’on s’intéresse à un seul paramètre <span class="math inline">\(\theta\)</span> dans un modèle donné. Ce modèle pourrait être un modèle de régression linéaire, de régression logistique, etc. Le paramètre <span class="math inline">\(\theta\)</span> serait alors un des <span class="math inline">\(\boldsymbol{\beta}\)</span> du modèle.</p>
<p>Supposons qu’on procède à <span class="math inline">\(K\)</span> imputations, c’est-à-dire, qu’on construit <span class="math inline">\(K\)</span> ensemble de données complets à partir de l’ensemble de données initial contenant des valeurs manquantes. On estime alors les paramètres du modèle séparément pour chacun des ensembles de données imputés. Soit <span class="math inline">\(\widehat{\theta}_k\)</span>, l’estimé du paramètre <span class="math inline">\(\theta\)</span> pour l’échantillon <span class="math inline">\(k \in \{1, \ldots, K\}\)</span> et <span class="math inline">\(\widehat{\sigma}_k^2=\mathsf{Va}(\widehat{\theta}_k)\)</span> l’estimé de la variance de <span class="math inline">\(\widehat{\theta}_k\)</span> produite par le modèle estimé.</p>
<p>L’estimation finale de <span class="math inline">\(\theta\)</span>, dénotée <span class="math inline">\(\widehat{\theta}\)</span>, est obtenue tout simplement en faisant la moyenne des estimations de tous les modèles, c’est-à-dire, <span class="math display">\[\begin{align*}
\widehat{\theta} = \frac{\widehat{\theta}_1 + \cdots + \widehat{\theta}_K}{K}.
\end{align*}\]</span> Une estimation ajustée de la variance de <span class="math inline">\(\widehat{\theta}\)</span> est <span class="math display">\[\begin{align*}
\mathsf{Va}(\hat{\theta}) &amp;= W+ \frac{K+1}{K}B,
\\ W &amp;= \frac{1}{K} \sum_{k=1}^K \widehat{\sigma}^2_k = \frac{\widehat{\sigma}_1^2 + \cdots + \widehat{\sigma}_K^2}{K},\\
B &amp;= \frac{1}{K-1} \sum_{k=1}^K (\widehat{\theta}_k - \widehat{\theta})^2.
\end{align*}\]</span> Ainsi, le terme <span class="math inline">\(W\)</span> est la moyenne des variances et <span class="math inline">\(B\)</span> est la variance entre les imputations. Le terme <span class="math inline">\((1+1/K)B\)</span> est celui qui vient corriger le fait qu’on travaille avec des données imputées et non pas des vraies données en augmentant la variance estimée du paramètre.</p>
<p>C’est ici qu’on voit l’intérêt à procéder à de l’imputation multiple. Si on procédait à une seule imputation (même en ajoutant une part d’aléatoire pour essayer de reproduire la variabilité des données), on ne serait pas en mesure d’estimer la variance inter-groupe de l’estimateur. Notez que la formule présentée n’est valide que pour le cas unidimensionnel; l’estimation de la variance dans le cas multidimensionnel est différente (voir Little et Rubin, 2002).</p>
<p>La méthode d’imputation multiple possède l’avantage d’être applicable avec n’importe quel modèle sous-jacent. Une fois qu’on a des échantillons complets (imputés), on ajuste le modèle comme d’habitude. Mais une observation imputée ne remplacera jamais une vraie observation. Il faut donc faire tout ce qu’on peut pour limiter le plus possible les données manquantes.</p>
<p>Il faut utiliser son jugement. Par exemple, si la proportion d’observations perdues est petite (moins de 5%), ça ne vaut peut-être pas la peine de prendre des mesures particulières et on peut faire une analyse avec les données complètes seulement. S’il y a un doute, on peut faire une analyse avec les données complètes seulement et une autre avec imputations multiples afin de valider la première.</p>
<p>Si, à l’inverse, une variable secondaire cause à elle seule une grande proportion de valeurs manquantes, on peut alors considérer l’éliminer afin de récupérer des observations. Par exemple, si vous avez une proportion de 30% de valeurs manquantes en utilisant toutes vos variables et que cette proportion baisse à 3% lorsque vous éliminez quelques variables peu importantes pour votre étude (ou qui peuvent être remplacées par d’autres jouant à peu près le même rôle qui elles sont disponibles), alors vous pourriez considérer la possibilité de les éliminer. Il est donc nécessaire d’examiner la configuration des valeurs manquantes avant de faire quoi que ce soit.</p>
</section>
</section>
<section id="example-dapplication-de-limputation" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="example-dapplication-de-limputation"><span class="header-section-number">7.3</span> Example d’application de l’imputation</h2>
<p>On examine l’exemple de recommandations de l’association professionnelle des vachers de la section <span class="citation" data-cites="cowboy">@cowboy</span>.</p>
<p>Le but est d’examiner les effets des variables <span class="math inline">\(X_1\)</span> à <span class="math inline">\(X_6\)</span> sur les intentions d’achat; la base de données <code>manquantes</code> contient les observations. Il s’agit des mêmes données que celles du fichier <code>logit1</code> mais avec des valeurs manquantes.</p>
<div class="cell" data-layout-align="center" data-hash="07-donneesmanquantes_cache/html/tbl-missing1r_2ae45bea44da0ae69211ceaf9f846af6">
<div class="cell-output-display">
<div id="tbl-missing1r" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau 7.1:  Tableau des configurations des données manquantes. </caption>
 <thead>
  <tr>
   <th style="text-align:right;"> \(X_1\) </th>
   <th style="text-align:right;"> \(X_2\) </th>
   <th style="text-align:right;"> \(X_3\) </th>
   <th style="text-align:right;"> \(X_4\) </th>
   <th style="text-align:right;"> \(X_5\) </th>
   <th style="text-align:right;"> \(X_6\) </th>
   <th style="text-align:right;"> \(y\) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 35 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 33 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 46 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 32 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 38 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 36 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 35 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 39 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> . </td>
   <td style="text-align:right;"> 38 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Les points (<code>.</code>) indiquent des valeurs manquantes. Le premier sujet n’a pas de valeur manquante. Le deuxième a une valeur manquante pour <span class="math inline">\(X_1\)</span> (emploi) et <span class="math inline">\(X_4\)</span> (éducation), etc.</p>
<p>Une première façon de voir combien il y a de valeurs manquantes consiste à faire sortir les statistiques descriptives avec <code>summary</code>. Ainsi, il y 192 valeurs manquantes pour <span class="math inline">\(X_1\)</span>, 48 pour <span class="math inline">\(X_2\)</span> et 184 pour <span class="math inline">\(X_4\)</span>. Les autres variables n’ont pas de valeurs manquantes, incluant la variable dépendante <span class="math inline">\(Y\)</span>. La procédure unidimensionnelle nous permet seulement de voir combien il y a de valeurs manquantes variable par variable.</p>
<div class="cell" data-layout-align="center" data-hash="07-donneesmanquantes_cache/html/tbl-manquantes-univ_7f9a421f7fcfe87c65b71d9f9b1ae19f">
<div class="cell-output-display">
<div id="tbl-manquantes-univ" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;"><caption>Tableau 7.2:  Pourcentage de valeurs manquantes par variable. </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> x1 </th>
   <th style="text-align:left;"> x2 </th>
   <th style="text-align:left;"> x3 </th>
   <th style="text-align:left;"> x4 </th>
   <th style="text-align:left;"> x5 </th>
   <th style="text-align:left;"> x6 </th>
   <th style="text-align:left;"> y </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> nombre </td>
   <td style="text-align:left;"> 192 </td>
   <td style="text-align:left;"> 49 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 184 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> pourcentage </td>
   <td style="text-align:left;"> 0.384 </td>
   <td style="text-align:left;"> 0.098 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 0.368 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="07-donneesmanquantes_cache/html/manquantes-summary-uni_df24eed3fcac6894dfb5076ff40c1a27">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(manquantes, <span class="at">package =</span> <span class="st">'hecmulti'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(manquantes)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentage de valeurs manquantes</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(manquantes, <span class="dv">2</span>, <span class="cf">function</span>(x){<span class="fu">mean</span>(<span class="fu">is.na</span>(x))})</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Voir les configurations de valeurs manquantes</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(missing1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="07-donneesmanquantes_cache/html/fig-manquantes2_a3a35ee79a97f4c8761fbe2c049ed652">
<div class="cell-output-display">
<div id="fig-manquantes2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-donneesmanquantes_files/figure-html/fig-manquantes2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Figure 7.1: Configurations des valeurs manquantes pour la base de données <code>manquantes</code>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-manquantes2">Figure&nbsp;<span class="quarto-unresolved-ref">fig-manquantes2</span></a> donne une indication sur les différentes combinaisons de données complètes (cases bleues) et les observations manquantes (cases roses) avec leur fréquence. Les variables sont indiquées au dessus, les effectifs manquants en dessous, le nombre de cas de chaque combinaisons à gauche et le nombre de variables avec des valeurs manquantes à droite. Ainsi, il y a 180 sujets (36% de l’échantillon) avec aucune observation manquante. Il y en a 99 avec seulement <span class="math inline">\(X_4\)</span> manquante et ainsi de suite. On voit donc, par exemple, que pour 14 sujets, à la fois <span class="math inline">\(X_1\)</span> et <span class="math inline">\(X_2\)</span> sont manquantes.</p>
<p>La recommandation d’usage est d’imputer au moins le pourcentage de cas incomplet, ici 64% donc 64 imputations. Si la procédure est trop coûteuse en calcul, on peut diminuer le nombre d’imputations, mais il faut au minimum 10 réplications pour avoir une bonne idée de la variabilité.</p>
<p>On peut comparer l’inférence avec toutes les variables explicatives pour les données sans valeurs manquantes (<span class="math inline">\(n=500\)</span> observations), avec les cas complets uniquement (<span class="math inline">\(n=180\)</span> observations). Le <a href="#tbl-missing3r">Tableau&nbsp;<span class="quarto-unresolved-ref">tbl-missing3r</span></a> présente les estimations des paramètres du modèle de régression logistique s’il n’y avait pas eu de valeurs manquantes, avec les cas complets et les résultats de l’imputation multiple.</p>
<p>Si on ajuste un modèle à une base de données qui contient des valeurs manquantes, le comportement par défaut est de retirer les observations qui ont au moins une valeur manquante pour une des variables nécessaires à l’analyse (voir la sortie de <code>glm(y ~ ., data = manquantes)</code>). Il ne serait pas raisonnable de faire l’analyse avec seulement 180 observations et de laisser tomber les 320 autres. De plus, comme nous l’avons vu plus haut, ce n’est pas valide à moins que le processus ne soit MCAR. La partie du milieu du <a href="#tbl-missing3r">Tableau&nbsp;<span class="quarto-unresolved-ref">tbl-missing3r</span></a> présente les estimations obtenues. Plusieurs variables significatives à niveau <span class="math inline">\(\alpha=0.05\)</span> ne le sont plus (puisqu’il y a moins d’information quand on réduit le nombre d’observations). Il y a même pire: non seulement la variable <span class="math inline">\(\mathsf{I}(X_2=1)\)</span> est passée de significative à non significative, mais en plus l’estimé de son paramètre a changé de signe.</p>
<p>Nous allons donc faire l’analyse avec l’imputation multiple, en prenant la méthode d’imputation par défaut</p>
<div class="cell" data-layout-align="center" data-hash="07-donneesmanquantes_cache/html/manquante2_3110903696e2a1c7ef1cfe3102e0a221">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Imputation multiple avec équations enchaînées</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Intensif en calcul, réduire `m` si nécessaire</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>impdata <span class="ot">&lt;-</span> <span class="fu">mice</span>(<span class="at">data =</span> manquantes,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">m =</span> <span class="dv">50</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">seed =</span> <span class="dv">2021</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"pmm"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Chaque copie est disponible (1, ..., 50)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">complete</span>(impdata, <span class="at">action =</span> <span class="dv">1</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ajuste les modèles avec les données imputées</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>adj_im <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> impdata,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">expr =</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">'logit'</span>)))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># combinaison des résultats </span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">pool</span>(adj_im)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La procédure <code>mice</code> du paquet éponyme crée les copies complètes du jeu de données. On peut ensuite appliquer une procédure quelconque et combiner les estimations avec <code>pool</code>.</p>
<div class="cell" data-layout-align="center" data-hash="07-donneesmanquantes_cache/html/tbl-missing3r_be4a8871ca7baf338bd43847c27dd424">
<div class="cell-output-display">
<div id="tbl-missing3r" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Tableau 7.3:  Estimés, erreurs-type et valeurs-p des paramètres avec les 500 données complètes (gauche), avec les 180 cas complets (milieu) et avec l’imputation multiple (droite). </caption>
 <thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1"></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Données complètes</div></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Cas complets</div></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Imputation multiple</div></th>
</tr>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> \(\widehat{\boldsymbol{\beta}}\) </th>
   <th style="text-align:center;"> \(\mathrm{se}(\widehat{\boldsymbol{\beta}})\) </th>
   <th style="text-align:center;"> valeur-\(p\) </th>
   <th style="text-align:right;"> \(\widehat{\boldsymbol{\beta}}\) </th>
   <th style="text-align:center;"> \(\mathrm{se}(\widehat{\boldsymbol{\beta}})\) </th>
   <th style="text-align:center;"> valeur-\(p\) </th>
   <th style="text-align:right;"> \(\widehat{\boldsymbol{\beta}}\) </th>
   <th style="text-align:center;"> \(\mathrm{se}(\widehat{\boldsymbol{\beta}})\) </th>
   <th style="text-align:center;"> valeur-\(p\) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> cste </td>
   <td style="text-align:right;"> -6.89 </td>
   <td style="text-align:center;"> 1.02 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> -5.25 </td>
   <td style="text-align:center;"> 1.70 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> -6.57 </td>
   <td style="text-align:center;"> 1.04 </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_1=1\) </td>
   <td style="text-align:right;"> 0.36 </td>
   <td style="text-align:center;"> 0.48 </td>
   <td style="text-align:center;"> 0.46 </td>
   <td style="text-align:right;"> -0.09 </td>
   <td style="text-align:center;"> 0.85 </td>
   <td style="text-align:center;"> 0.92 </td>
   <td style="text-align:right;"> 0.55 </td>
   <td style="text-align:center;"> 0.54 </td>
   <td style="text-align:center;"> 0.31 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_1=2\) </td>
   <td style="text-align:right;"> -0.47 </td>
   <td style="text-align:center;"> 0.37 </td>
   <td style="text-align:center;"> 0.21 </td>
   <td style="text-align:right;"> -0.57 </td>
   <td style="text-align:center;"> 0.66 </td>
   <td style="text-align:center;"> 0.39 </td>
   <td style="text-align:right;"> -0.13 </td>
   <td style="text-align:center;"> 0.45 </td>
   <td style="text-align:center;"> 0.78 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_1=3\) </td>
   <td style="text-align:right;"> -0.31 </td>
   <td style="text-align:center;"> 0.35 </td>
   <td style="text-align:center;"> 0.37 </td>
   <td style="text-align:right;"> -0.47 </td>
   <td style="text-align:center;"> 0.66 </td>
   <td style="text-align:center;"> 0.47 </td>
   <td style="text-align:right;"> 0.07 </td>
   <td style="text-align:center;"> 0.44 </td>
   <td style="text-align:center;"> 0.87 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_1=4\) </td>
   <td style="text-align:right;"> -0.32 </td>
   <td style="text-align:center;"> 0.40 </td>
   <td style="text-align:center;"> 0.43 </td>
   <td style="text-align:right;"> -0.93 </td>
   <td style="text-align:center;"> 0.74 </td>
   <td style="text-align:center;"> 0.21 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:center;"> 0.48 </td>
   <td style="text-align:center;"> 0.93 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_2=1\) </td>
   <td style="text-align:right;"> 1.33 </td>
   <td style="text-align:center;"> 0.60 </td>
   <td style="text-align:center;"> 0.03 </td>
   <td style="text-align:right;"> -0.74 </td>
   <td style="text-align:center;"> 1.14 </td>
   <td style="text-align:center;"> 0.52 </td>
   <td style="text-align:right;"> 1.10 </td>
   <td style="text-align:center;"> 0.65 </td>
   <td style="text-align:center;"> 0.09 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_2=2\) </td>
   <td style="text-align:right;"> 1.15 </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> 0.02 </td>
   <td style="text-align:right;"> 0.46 </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> 0.61 </td>
   <td style="text-align:right;"> 1.03 </td>
   <td style="text-align:center;"> 0.55 </td>
   <td style="text-align:center;"> 0.06 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_2=3\) </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:center;"> 0.48 </td>
   <td style="text-align:center;"> 0.11 </td>
   <td style="text-align:right;"> -0.41 </td>
   <td style="text-align:center;"> 0.89 </td>
   <td style="text-align:center;"> 0.64 </td>
   <td style="text-align:right;"> 0.52 </td>
   <td style="text-align:center;"> 0.52 </td>
   <td style="text-align:center;"> 0.31 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_2=4\) </td>
   <td style="text-align:right;"> -1.11 </td>
   <td style="text-align:center;"> 0.54 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:right;"> -2.74 </td>
   <td style="text-align:center;"> 1.02 </td>
   <td style="text-align:center;"> 0.01 </td>
   <td style="text-align:right;"> -1.04 </td>
   <td style="text-align:center;"> 0.57 </td>
   <td style="text-align:center;"> 0.07 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_3\) </td>
   <td style="text-align:right;"> 1.35 </td>
   <td style="text-align:center;"> 0.26 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:center;"> 0.44 </td>
   <td style="text-align:center;"> 0.07 </td>
   <td style="text-align:right;"> 1.19 </td>
   <td style="text-align:center;"> 0.27 </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_4\) </td>
   <td style="text-align:right;"> 1.83 </td>
   <td style="text-align:center;"> 0.30 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> 2.25 </td>
   <td style="text-align:center;"> 0.58 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> 1.52 </td>
   <td style="text-align:center;"> 0.37 </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_5\) </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:center;"> 0.02 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:center;"> 0.03 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> 0.10 </td>
   <td style="text-align:center;"> 0.02 </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_6=1\) </td>
   <td style="text-align:right;"> 2.41 </td>
   <td style="text-align:center;"> 0.38 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> 2.23 </td>
   <td style="text-align:center;"> 0.66 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> 2.26 </td>
   <td style="text-align:center;"> 0.38 </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> \(x_6=2\) </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:center;"> 0.25 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:center;"> 0.44 </td>
   <td style="text-align:center;"> 0.06 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:center;"> 0.25 </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>On peut remarquer que la précision est systématiquement meilleure avec l’imputation multiple; les erreurs-type pour l’imputation multiple sont plus petits que celle du modèle qui retire les données incomplètes.</p>
<p>On voit que la variable <span class="math inline">\(X_3\)</span> (sexe) est significative avec l’imputation multiple. Son paramètre estimé est 1.19, comparativement à 1.349 s’il n’y avait pas eu de valeurs manquantes. La précision dans l’estimation avec l’imputation multiple est seulement un peu moins bonne (erreur-type de 0.27) que celle s’il n’y avait pas eu de manquantes (erreur type de 0.26). Le paramètre de <span class="math inline">\(\mathsf{I}(X_6=2)\)</span> redevient aussi significatif, alors qu’il ne l’était plus si on retirait les manquantes. Il est peu probable que les données soit <span class="math inline">\(\mathsf{MCAR}\)</span> et donc les résultats de l’analyse des cas complets seraient biaisés.</p>
</section>
<section id="valeurs-manquantes-dans-un-contexte-de-prédiction" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="valeurs-manquantes-dans-un-contexte-de-prédiction"><span class="header-section-number">7.4</span> Valeurs manquantes dans un contexte de prédiction</h2>
<p>Nous avons vu que l’imputation multiple permet de corriger les écarts-type des paramètres estimés afin d’obtenir une inférence valide. Mais cette fois-ci, le but n’est pas d’estimer un modèle afin de tester formellement certaines hypothèses, mais plutôt de développer un modèle pour obtenir des prédictions. Dans ce cas, l’imputation multiple peut aussi être utile.</p>
<p>Nous allons revenir une dernière fois sur l’exemple de ciblage de clients pour l’envoi d’un catalogue. Rappelez-vous qu’on a un échantillon d’apprentissage de 1000 clients pour lesquels la variable <span class="math inline">\(\texttt{yachat}\)</span> est disponible (est-ce que le client a acheté quelque chose lorsqu’on lui a envoyé un catalogue). Nous avons développé des modèles avec ces 1000 clients afin de décider à qui, parmi les 100 000 clients restants, envoyer le catalogue. Nous avions alors utilisé des données sans valeurs manquantes. Cette fois-ci, nous allons faire comme s’il y avait des valeurs manquantes pour les variables explicatives à la fois dans l’échantillon d’apprentissage mais aussi dans l’échantillon à prédire. Nous allons chercher à développer un modèle de régression logistique pour <span class="math inline">\(\mathsf{P}(\texttt{yachat}=1)\)</span>. Plusieurs approches sont possibles et il n’est pas clair à priori laquelle est la meilleure. Voici la description de deux approches.</p>
<p><strong>Approche 1: </strong></p>
<ol type="1">
<li>Obtenir <span class="math inline">\(K\)</span> ensembles de données complets par imputations multiples (simultanément pour les échantillons tests et d’apprentissage).</li>
<li>Pour chaque ensemble de données complet,
<ol type="a">
<li>Faire une sélection de variables</li>
<li>Obtenir les estimations de <span class="math inline">\(\mathsf{P}(\texttt{yachat}=1)\)</span></li>
</ol></li>
<li>Pour chaque observation dans les deux échantillons faire la moyenne des <span class="math inline">\(K\)</span> estimations de <span class="math inline">\(\mathsf{P}(\texttt{yachat}=1)\)</span> de manière à avoir une seule prédiction par observation de la probabilité d’achat.</li>
<li>Trouver le meilleur point de coupure avec les probabilités calculées en 3) pour l’échantillon d’apprentissage.</li>
<li>Assigner les observations de l’échantillon à prédire avec ce point de coupure en utilisant les probabilités calculées en 3) pour les données de l’échantillon test.</li>
</ol>
<p><strong>Approche 2:</strong></p>
<ol type="1">
<li>Obtenir <span class="math inline">\(K\)</span> ensembles de données complets par imputations multiples (simultanément pour les échantillons tests et d’apprentissage).</li>
<li>Pour chaque ensemble de données complet,
<ol type="a">
<li>Faire une sélection de variables</li>
<li>Trouver le meilleur point de coupure par validation-croisée</li>
<li>Obtenir les prédictions (<span class="math inline">\(0\)</span> ou <span class="math inline">\(1\)</span>) pour l’échantillon à scorer, avec ce point de coupure.</li>
</ol></li>
<li>Assigner l’observation à la classe majoritaire (celle qui a le plus de votes parmi zéro ou un pour les <span class="math inline">\(K\)</span> prédictions) pour chaque observation à prédire.</li>
</ol>
<p>Nous allons seulement utiliser une approximation de la première approche ici et ignorer les valeurs de <code>yachat</code> et <code>ymontant</code> lors de l’imputation car ces dernières sont manquantes dans l’échantillon test et on se trouverait imputer à partir de modèles différentes dans les deux échantillons (test et apprentissage). Il y a des valeurs manquantes dans chaque variable: par exemple, 99 valeurs manquantes pour <span class="math inline">\(X_1\)</span>. Globalement, seulement 201 des 1000 clients n’ont aucune valeur manquante sur les 10 variables. Il y a 164 configurations différentes de valeurs manquantes.</p>
<p>En utilisant l’approche 1 présentée plus haut, nous allons imputer simultanément les valeurs manquantes pour l’échantillon d’apprentissage et l’échantillon test à prédire avec <span class="math inline">\(K=5\)</span> échantillons imputés. La méthode de sélection de variables utilisée est la procédure séquentielle classique avec 0.05 comme critère d’entrée et de sortie. De plus, afin de simplifier le tout, le point de coupure a été fixé à 0.14 (celui que l’on avait obtenu dans le cas où il n’y a pas de valeurs manquantes) et non pas estimé par validation-croisée.</p>
<p>Il s’avère que le revenu net, sur les 100 000 clients restants, aurait été de 926 917$. S’il n’y avait pas eu de valeurs manquantes, la sélection basée sur une procédure séquentielle classique aurait généré un revenu net de 969 350$. Les données manquantes rendent plus difficile le développement du modèle. Mais on fait quand même encore beaucoup mieux que la stratégie de référence qui consiste à envoyer le catalogue aux 100 000 clients, qui aurait généré un revenu net de 601 112$.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-survie.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyse de survie</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Tous droits réservés (Denis Larocque, Léo Belzile)</div>
  </div>
</footer>



</body></html>